<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç  | Daaihang's Blog</title>
<meta name=keywords content><meta name=description content="
é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚
æ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**
å®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´
æ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚"><meta name=author content><link rel=canonical href=http://localhost:1313/docs/crypto/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/docs/crypto/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/docs/crypto/"><meta property="og:site_name" content="Daaihang's Blog"><meta property="og:title" content="ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç "><meta property="og:description" content=" é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚
æ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**
å®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´
æ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-06-21T18:54:10+08:00"><meta property="article:modified_time" content="2024-06-21T18:54:10+08:00"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç "><meta name=twitter:description content="
é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚
æ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**
å®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´
æ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"å¼€å‘","item":"http://localhost:1313/docs/"},{"@type":"ListItem","position":2,"name":"ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç ","item":"http://localhost:1313/docs/crypto/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç ","name":"ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç ","description":" é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚\næ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**\nå®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´\næ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚\n","keywords":[],"articleBody":" é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚\næ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**\nå®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´\næ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚\nå¦å¤–è¿˜æœ‰ğŸ‘‰ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒåŸç†ï¼Œè¿™é‡Œæœ‰å„ä¸ªå®éªŒçš„å®éªŒåŸç†ã€‚\nå…è´£å£°æ˜ï¼šå®éªŒä»£ç ä»…ä¾›å‚è€ƒï¼Œè¯·è‡ªè¡Œè®¾è®¡å®ç°ã€‚\nå®éªŒä¸€ å¯¹ç§°åŠ å¯† å¤å…¸å¯†ç Hillå¯†ç  éšæœºç”Ÿæˆä¸€ä¸ª2Ã—2å’Œä¸€ä¸ª3Ã—3çš„å¯é€†çš„å¯†é’¥çŸ©é˜µï¼ŒçŸ©é˜µå…ƒç´ å–è‡ªZ26ã€‚\næ±‚è¿™ä¸¤ä¸ªçŸ©é˜µçš„é€†çŸ©é˜µ åˆ†åˆ«ç”¨è¿™ä¸¤ä¸ªå¯†é’¥çŸ©é˜µåŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ â–º ä»£ç  1-1_Symmetric_Hill\rimport numpy as np from sympy import Matrix # å®šä¹‰å¯è§ ASCII å­—ç¬¦çš„èŒƒå›´ MIN_ASCII = 32 MAX_ASCII = 126 Z = MAX_ASCII - MIN_ASCII + 1 # å­—ç¬¦é›†å¤§å° # ç”Ÿæˆä¸€ä¸ªéšæœºçš„ n x n å¯é€†çŸ©é˜µï¼Œå…ƒç´ å–è‡ª Z def generate_invertible_matrix(n): while True: matrix = np.random.randint(0, Z, size=(n, n)) # æ£€æŸ¥çŸ©é˜µè¡Œåˆ—å¼ä¸ Z æ˜¯å¦äº’è´¨ï¼Œåªæœ‰äº’è´¨æ—¶çŸ©é˜µæ‰æ˜¯å¯é€†çš„ if np.gcd(int(round(np.linalg.det(matrix))), Z) == 1: return matrix # è®¡ç®—çŸ©é˜µåœ¨æ¨¡ Z ä¸‹çš„é€†çŸ©é˜µ def modular_inverse(matrix, mod): mat = Matrix(matrix) # ä½¿ç”¨ sympy åº“è®¡ç®—çŸ©é˜µçš„æ¨¡é€† inv_mat = mat.inv_mod(mod) return np.array(inv_mat).astype(int) # ç”Ÿæˆ 2x2 å’Œ 3x3 å¯é€†çŸ©é˜µ matrix_2x2 = generate_invertible_matrix(2) matrix_3x3 = generate_invertible_matrix(3) # è®¡ç®—çŸ©é˜µçš„é€†çŸ©é˜µ inverse_2x2 = modular_inverse(matrix_2x2, Z) inverse_3x3 = modular_inverse(matrix_3x3, Z) # å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨ def text_to_numbers(text): # å°†å­—ç¬¦çš„ ASCII ç å‡å» MIN_ASCII return [ord(char) - MIN_ASCII for char in text] # å°†æ•°å­—åˆ—è¡¨è½¬æ¢ä¸ºæ–‡æœ¬ def numbers_to_text(numbers): # å°†æ•°å­—åŠ ä¸Š MIN_ASCII è½¬æ¢å›å­—ç¬¦ return ''.join(chr(num + MIN_ASCII) for num in numbers) # Hill åŠ å¯†å‡½æ•° def hill_encrypt(message, key_matrix): n = key_matrix.shape[0] message_numbers = text_to_numbers(message) while len(message_numbers) % n != 0: message_numbers.append(0) # ä½¿ç”¨æœ€å°çš„å¯è§ ASCII å­—ç¬¦è¿›è¡Œå¡«å…… encrypted_numbers = [] for i in range(0, len(message_numbers), n): block = np.array(message_numbers[i:i + n]) # çŸ©é˜µä¹˜æ³•å¹¶å–æ¨¡ Z encrypted_block = np.dot(key_matrix, block) % Z encrypted_numbers.extend(encrypted_block) return numbers_to_text(encrypted_numbers) # Hill è§£å¯†å‡½æ•° def hill_decrypt(encrypted_message, inverse_key_matrix): n = inverse_key_matrix.shape[0] encrypted_numbers = text_to_numbers(encrypted_message) decrypted_numbers = [] for i in range(0, len(encrypted_numbers), n): block = np.array(encrypted_numbers[i:i + n]) # ä½¿ç”¨é€†çŸ©é˜µè¿›è¡ŒçŸ©é˜µä¹˜æ³•å¹¶å–æ¨¡ Z decrypted_block = np.dot(inverse_key_matrix, block) % Z decrypted_numbers.extend(decrypted_block) return numbers_to_text(decrypted_numbers).rstrip(chr(0)) # ç§»é™¤å¡«å…… # å®éªŒ â‘ : æ‰“å°ç”Ÿæˆçš„çŸ©é˜µåŠå…¶é€†çŸ©é˜µ print(\"å®éªŒ â‘ : ç”Ÿæˆçš„çŸ©é˜µåŠå…¶é€†çŸ©é˜µ\") print(\"2x2 çŸ©é˜µ:\") print(matrix_2x2) print(\"2x2 é€†çŸ©é˜µ:\") print(inverse_2x2) print(\"\\n3x3 çŸ©é˜µ:\") print(matrix_3x3) print(\"3x3 é€†çŸ©é˜µ:\") print(inverse_3x3) # å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯ message = \"26221013_Daaihang_Wong\" # ä»…ä¿ç•™æ¶ˆæ¯ä¸­çš„å¯è§å­—ç¬¦ filtered_message = ''.join(filter(lambda x: MIN_ASCII \u003c= ord(x) \u003c= MAX_ASCII, message)) encrypted_message_2x2 = hill_encrypt(filtered_message, matrix_2x2) decrypted_message_2x2 = hill_decrypt(encrypted_message_2x2, inverse_2x2) encrypted_message_3x3 = hill_encrypt(filtered_message, matrix_3x3) decrypted_message_3x3 = hill_decrypt(encrypted_message_3x3, inverse_3x3) # è¾“å‡ºç»“æœ print(\"\\nå®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†ç»“æœ\") print(\"åŸå§‹æ¶ˆæ¯:\", filtered_message) print(\"\\nä½¿ç”¨ 2x2 çŸ©é˜µ\") print(\"åŠ å¯†æ¶ˆæ¯:\", encrypted_message_2x2) print(\"è§£å¯†æ¶ˆæ¯:\", decrypted_message_2x2) print(\"\\nä½¿ç”¨ 3x3 çŸ©é˜µ\") print(\"åŠ å¯†æ¶ˆæ¯:\", encrypted_message_3x3) print(\"è§£å¯†æ¶ˆæ¯:\", decrypted_message_3x3) ç½®æ¢å¯†ç  éšæœºç”Ÿæˆä¸€ä¸ªç½®æ¢è¡¨ï¼ˆç½®æ¢è¡¨é•¿åº¦å¯è®¾ç½®ï¼‰\næ±‚é€†ç½®æ¢ ç”¨æ­¤ç½®æ¢è¡¨åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ â–º ä»£ç  1-2_Symmetric_Permutation\rimport random # å®šä¹‰å¯è§ ASCII å­—ç¬¦çš„èŒƒå›´ MIN_ASCII = 32 MAX_ASCII = 126 CHARS = [chr(i) for i in range(MIN_ASCII, MAX_ASCII + 1)] LENGTH = len(CHARS) # ç”Ÿæˆéšæœºç½®æ¢è¡¨ def generate_permutation_table(length): table = CHARS[:length] random.shuffle(table) # éšæœºæ‰“ä¹±å­—ç¬¦åˆ—è¡¨ï¼Œå½¢æˆç½®æ¢è¡¨ return table # ç”Ÿæˆé€†ç½®æ¢è¡¨ def generate_inverse_permutation_table(table): inverse_table = [''] * len(table) for i, char in enumerate(table): inverse_table[CHARS.index(char)] = CHARS[i] # æ‰¾åˆ°å­—ç¬¦åœ¨åŸå­—ç¬¦é›†ä¸­çš„ä½ç½®ï¼Œå¹¶åœ¨é€†ç½®æ¢è¡¨ä¸­è®°å½•ç›¸åº”çš„åŸå­—ç¬¦ return inverse_table # ç½®æ¢åŠ å¯†å‡½æ•° def permutation_encrypt(message, table): # ç”¨ç½®æ¢è¡¨æ›¿æ¢æ¶ˆæ¯ä¸­çš„æ¯ä¸ªå­—ç¬¦ return ''.join(table[CHARS.index(char)] if char in CHARS else char for char in message) # ç½®æ¢è§£å¯†å‡½æ•° def permutation_decrypt(encrypted_message, inverse_table): # ç”¨é€†ç½®æ¢è¡¨è¿˜åŸæ¶ˆæ¯ä¸­çš„æ¯ä¸ªå­—ç¬¦ return ''.join(inverse_table[CHARS.index(char)] if char in CHARS else char for char in encrypted_message) # å®éªŒ â‘ : æ‰“å°ç”Ÿæˆçš„ç½®æ¢è¡¨åŠå…¶é€†ç½®æ¢è¡¨ table = generate_permutation_table(LENGTH) inverse_table = generate_inverse_permutation_table(table) print(\"å®éªŒ â‘ : ç”Ÿæˆçš„ç½®æ¢è¡¨åŠå…¶é€†ç½®æ¢è¡¨\") print(\"ç½®æ¢è¡¨:\", ''.join(table)) print(\"é€†ç½®æ¢è¡¨:\", ''.join(inverse_table)) # å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯ message = \"26221013_Daaihang_Wong\" encrypted_message = permutation_encrypt(message, table) decrypted_message = permutation_decrypt(encrypted_message, inverse_table) # è¾“å‡ºç»“æœ print(\"\\nå®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†ç»“æœ\") print(\"åŸå§‹æ¶ˆæ¯:\", message) print(\"åŠ å¯†æ¶ˆæ¯:\", encrypted_message) print(\"è§£å¯†æ¶ˆæ¯:\", decrypted_message) å¯¹ç§°åŠ å¯†ç®—æ³•AESå’Œå·¥ä½œæ¨¡å¼ ç¼–å†™AESåŠ å¯†å’Œè§£å¯†ç®—æ³• åˆ†åˆ«ç»“åˆCBCå’ŒOFBå·¥ä½œæ¨¡å¼ï¼ŒåŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ æˆ‘ç»™å‡ºäº†4ç§æ–¹å¼å®ç°ã€‚ä¼˜å…ˆä½¿ç”¨ç¬¬4ä¸ªã€‚å…¶ä»–çš„æˆ–å¤šæˆ–å°‘ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„éåŸºç¡€å¯†ç åº“ï¼Œå¯èƒ½ä¸ç¬¦åˆå®éªŒè¦æ±‚ã€‚\nâ–º ä»£ç  - å®ç°ä¸€ 1-3_Symmetric_AES_1\rfrom cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes from cryptography.hazmat.primitives import padding from cryptography.hazmat.backends import default_backend import os # ç”Ÿæˆéšæœºå¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ def generate_key_iv(key_size): key = os.urandom(key_size // 8) iv = os.urandom(16) # IV å¤§å°åº”ä¸ºå—å¤§å°ï¼ˆ16 å­—èŠ‚ï¼‰ return key, iv # AES åŠ å¯†å‡½æ•° def aes_encrypt(message, key, iv, mode): # PKCS7å¡«å…… padder = padding.PKCS7(algorithms.AES.block_size).padder() padded_data = padder.update(message.encode()) + padder.finalize() # åˆ›å»ºAESåŠ å¯†å™¨ cipher = Cipher(algorithms.AES(key), mode(iv), backend=default_backend()) encryptor = cipher.encryptor() # åŠ å¯†æ•°æ® ciphertext = encryptor.update(padded_data) + encryptor.finalize() return ciphertext # AES è§£å¯†å‡½æ•° def aes_decrypt(ciphertext, key, iv, mode): # åˆ›å»ºAESè§£å¯†å™¨ cipher = Cipher(algorithms.AES(key), mode(iv), backend=default_backend()) decryptor = cipher.decryptor() # è§£å¯†æ•°æ® padded_data = decryptor.update(ciphertext) + decryptor.finalize() # å»é™¤PKCS7å¡«å…… unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder() decrypted_data = unpadder.update(padded_data) + unpadder.finalize() return decrypted_data.decode() # ä¸»å‡½æ•° def main(): # è®¾ç½®å¯†é’¥é•¿åº¦ï¼ˆ128, 192, æˆ– 256 ä½ï¼‰ key_size = 256 # ç”Ÿæˆå¯†é’¥å’Œ IV key, iv = generate_key_iv(key_size) # æ‰“å°å¯†é’¥å’Œ IV print(\"å®éªŒ â‘ : å¯†é’¥å’Œ IV\") print(\"å¯†é’¥:\", key.hex()) print(\"IV:\", iv.hex()) # å®šä¹‰æ¶ˆæ¯ message = \"26221013_Daaihang_Wong\" # å®éªŒ â‘¡: CBC æ¨¡å¼åŠ å¯†å’Œè§£å¯† print(\"\\nå®éªŒ â‘¡: CBC æ¨¡å¼\") ciphertext_cbc = aes_encrypt(message, key, iv, modes.CBC) print(\"CBC åŠ å¯†æ¶ˆæ¯:\", ciphertext_cbc.hex()) decrypted_message_cbc = aes_decrypt(ciphertext_cbc, key, iv, modes.CBC) print(\"CBC è§£å¯†æ¶ˆæ¯:\", decrypted_message_cbc) # å®éªŒ â‘¡: OFB æ¨¡å¼åŠ å¯†å’Œè§£å¯† print(\"\\nå®éªŒ â‘¡: OFB æ¨¡å¼\") ciphertext_ofb = aes_encrypt(message, key, iv, modes.OFB) print(\"OFB åŠ å¯†æ¶ˆæ¯:\", ciphertext_ofb.hex()) decrypted_message_ofb = aes_decrypt(ciphertext_ofb, key, iv, modes.OFB) print(\"OFB è§£å¯†æ¶ˆæ¯:\", decrypted_message_ofb) # è¿è¡Œä¸»å‡½æ•° if __name__ == \"__main__\": main() â–º ä»£ç  - å®ç°äºŒ 1-3_Symmetric_AES_2\rimport os from pyaes import pyaes def pad(data): padding_needed = 16 - len(data) % 16 return data + chr(padding_needed) * padding_needed def split_blocks(data, block_size=16): return [data[i:i + block_size] for i in range(0, len(data), block_size)] def encrypt_cbc(key, iv, data): aes = pyaes.AESModeOfOperationCBC(key, iv=iv) padded_data = pad(data) blocks = split_blocks(padded_data) ciphertext = b''.join(aes.encrypt(block) for block in blocks) return ciphertext def unpad(data): padding = ord(data[-1]) return data[:-padding] def decrypt_cbc(key, iv, ciphertext): aes = pyaes.AESModeOfOperationCBC(key, iv=iv) blocks = split_blocks(ciphertext) plaintext = ''.join(aes.decrypt(block).decode('utf-8') for block in blocks) return unpad(plaintext) def encrypt_ofb(key, iv, data): aes = pyaes.AESModeOfOperationOFB(key, iv=iv) return aes.encrypt(data) def decrypt_ofb(key, iv, ciphertext): aes = pyaes.AESModeOfOperationOFB(key, iv=iv) return aes.decrypt(ciphertext).decode() def main(): key = os.urandom(32) iv = os.urandom(16) print(repr(iv)) # Using CBC mode plaintext_cbc = \"26221013_Daaihang_Wong\" ciphertext_cbc = encrypt_cbc(key, iv, plaintext_cbc) print(repr(ciphertext_cbc)) decrypted_cbc = decrypt_cbc(key, iv, ciphertext_cbc) print(decrypted_cbc) print(decrypted_cbc == plaintext_cbc) # Using OFB mode plaintext_ofb = \"26221013_Daaihang_Wong\" ciphertext_ofb = encrypt_ofb(key, iv, plaintext_ofb) print(repr(ciphertext_ofb)) decrypted_ofb = decrypt_ofb(key, iv, ciphertext_ofb) print(decrypted_ofb) print(decrypted_ofb == plaintext_ofb) if __name__ == \"__main__\": main() â–º ä»£ç  - å®ç°ä¸‰ 1-3_Symmetric_AES_3\r# ä¸€ä¸ªç®€å•çš„ AES-128-ECBï¼Œå…¶ä¸­ 128 æŒ‡é‡‡ç”¨ 128 ä½å¯†é’¥å—ï¼Œ # ECB æ¨¡å¼ï¼Œä¸ºé•¿åº¦ä¸è¶³ 128 ä½çš„æ•°æ®å—å¡«å…… 0x00ã€‚ s_box = [ [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76], [0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0], [0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15], [0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75], [0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84], [0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf], [0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8], [0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2], [0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73], [0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb], [0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79], [0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08], [0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a], [0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e], [0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf], [0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16] ] s_box_inv = [ [0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb], [0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb], [0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e], [0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25], [0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92], [0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84], [0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06], [0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b], [0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73], [0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e], [0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b], [0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4], [0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f], [0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef], [0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61], [0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d] ] rc = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d] def sub_bytes(grid, inv=False): for i, v in enumerate(grid): if inv: # for decryption grid[i] = s_box_inv[v \u003e\u003e 4][v \u0026 0xf] else: grid[i] = s_box[v \u003e\u003e 4][v \u0026 0xf] def shift_rows(grid, inv=False): for i in range(4): if inv: # for decryption grid[i::4] = grid[i::4][-i:] + grid[i::4][:-i] else: grid[i::4] = grid[i::4][i:] + grid[i::4][:i] def mix_columns(grid): def mul_by_2(n): s = (n \u003c\u003c 1) \u0026 0xff if n \u0026 128: s ^= 0x1b return s def mul_by_3(n): return n ^ mul_by_2(n) def mix_column(c): return [ mul_by_2(c[0]) ^ mul_by_3(c[1]) ^ c[2] ^ c[3], # [2 3 1 1] c[0] ^ mul_by_2(c[1]) ^ mul_by_3(c[2]) ^ c[3], # [1 2 3 1] c[0] ^ c[1] ^ mul_by_2(c[2]) ^ mul_by_3(c[3]), # [1 1 2 3] mul_by_3(c[0]) ^ c[1] ^ c[2] ^ mul_by_2(c[3]), # [3 1 1 2] ] for i in range(0, 16, 4): grid[i:i + 4] = mix_column(grid[i:i + 4]) def key_expansion(grid): for i in range(10 * 4): r = grid[-4:] if i % 4 == 0: # å¯¹ä¸Šä¸€è½®æœ€å4å­—èŠ‚è‡ªå¾ªç¯ã€S-boxç½®æ¢ã€è½®å¸¸æ•°å¼‚æˆ–ï¼Œä»è€Œè®¡ç®—å‡ºå½“å‰æ–°ä¸€è½®æœ€å‰4å­—èŠ‚ for j, v in enumerate(r[1:] + r[:1]): r[j] = s_box[v \u003e\u003e 4][v \u0026 0xf] ^ (rc[i // 4] if j == 0 else 0) for j in range(4): grid.append(grid[-16] ^ r[j]) return grid def add_round_key(grid, round_key): for i in range(16): grid[i] ^= round_key[i] def encrypt(b, expanded_key): # First round add_round_key(b, expanded_key) for i in range(1, 10): sub_bytes(b) shift_rows(b) mix_columns(b) add_round_key(b, expanded_key[i * 16:]) # Final round sub_bytes(b) shift_rows(b) add_round_key(b, expanded_key[-16:]) return b def decrypt(b, expanded_key): # First round add_round_key(b, expanded_key[-16:]) for i in range(9, 0, -1): shift_rows(b, True) sub_bytes(b, True) add_round_key(b, expanded_key[i * 16:]) for _ in range(3): mix_columns(b) # Final round shift_rows(b, True) sub_bytes(b, True) add_round_key(b, expanded_key) return b def aes(typ, key, msg): expanded = key_expansion(bytearray(key)) # Pad the message to a multiple of 16 bytes b = bytearray(msg) if typ == 0: # only for encryption b = bytearray(msg + b'\\x00' * (16 - len(msg) % 16)) # Encrypt/decrypt the message for i in range(0, len(b), 16): if typ == 0: b[i:i + 16] = encrypt(b[i:i + 16], expanded) else: b[i:i + 16] = decrypt(b[i:i + 16], expanded) return bytes(b) if __name__ == '__main__': key = b\"Qw3rTyQw3rTyQw3r\" enc = aes(0, key, b'Daaihang_Wong_26221013') dec = aes(1, key, enc) print('åŠ å¯†ï¼š', enc) print('è§£å¯†ï¼š', dec) â–º ä»£ç  - å®ç°å›› 1-3_Symmetric_AES_4ï¼ˆæ¨èå‚è€ƒï¼‰\rimport os # AESå—å¤§å° BLOCK_SIZE = 16 # ç”Ÿæˆéšæœºå­—èŠ‚ def generate_random_bytes(length): return os.urandom(length) # å¡«å……å‡½æ•°ï¼šPKCS#7 def pad(data): pad_length = BLOCK_SIZE - len(data) % BLOCK_SIZE return data + bytes([pad_length] * pad_length) # å»å¡«å……å‡½æ•°ï¼šPKCS#7 def unpad(data): pad_length = data[-1] return data[:-pad_length] # å®šä¹‰Sç›’å’Œé€†Sç›’ s_box = [ 0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16, ] inv_s_box = [ 0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d, ] # å­—èŠ‚æ›¿æ¢ def sub_bytes(state): return bytes(s_box[b] for b in state) # å­—èŠ‚æ›¿æ¢çš„é€†æ“ä½œ def inv_sub_bytes(state): return bytes(inv_s_box[b] for b in state) # è¡Œç§»ä½ def shift_rows(state): return bytes([ state[0], state[5], state[10], state[15], state[4], state[9], state[14], state[3], state[8], state[13], state[2], state[7], state[12], state[1], state[6], state[11], ]) # è¡Œç§»ä½çš„é€†æ“ä½œ def inv_shift_rows(state): return bytes([ state[0], state[13], state[10], state[7], state[4], state[1], state[14], state[11], state[8], state[5], state[2], state[15], state[12], state[9], state[6], state[3], ]) # GF(2^8)ä¸­çš„ä¹˜æ³• def gmul(a, b): p = 0 for _ in range(8): if b \u0026 1: p ^= a hi_bit_set = a \u0026 0x80 a \u003c\u003c= 1 if hi_bit_set: a ^= 0x1b b \u003e\u003e= 1 return p \u0026 0xff # åˆ—æ··åˆ def mix_columns(state): mixed = bytearray(16) for i in range(4): mixed[i * 4 + 0] = gmul(state[i * 4 + 0], 2) ^ gmul(state[i * 4 + 1], 3) ^ state[i * 4 + 2] ^ state[i * 4 + 3] mixed[i * 4 + 1] = state[i * 4 + 0] ^ gmul(state[i * 4 + 1], 2) ^ gmul(state[i * 4 + 2], 3) ^ state[i * 4 + 3] mixed[i * 4 + 2] = state[i * 4 + 0] ^ state[i * 4 + 1] ^ gmul(state[i * 4 + 2], 2) ^ gmul(state[i * 4 + 3], 3) mixed[i * 4 + 3] = gmul(state[i * 4 + 0], 3) ^ state[i * 4 + 1] ^ state[i * 4 + 2] ^ gmul(state[i * 4 + 3], 2) return bytes(mixed) # åˆ—æ··åˆçš„é€†æ“ä½œ def inv_mix_columns(state): mixed = bytearray(16) for i in range(4): mixed[i * 4 + 0] = gmul(state[i * 4 + 0], 14) ^ gmul(state[i * 4 + 1], 11) ^ gmul(state[i * 4 + 2], 13) ^ gmul( state[i * 4 + 3], 9) mixed[i * 4 + 1] = gmul(state[i * 4 + 0], 9) ^ gmul(state[i * 4 + 1], 14) ^ gmul(state[i * 4 + 2], 11) ^ gmul( state[i * 4 + 3], 13) mixed[i * 4 + 2] = gmul(state[i * 4 + 0], 13) ^ gmul(state[i * 4 + 1], 9) ^ gmul(state[i * 4 + 2], 14) ^ gmul( state[i * 4 + 3], 11) mixed[i * 4 + 3] = gmul(state[i * 4 + 0], 11) ^ gmul(state[i * 4 + 1], 13) ^ gmul(state[i * 4 + 2], 9) ^ gmul( state[i * 4 + 3], 14) return bytes(mixed) # è½®å¯†é’¥åŠ  def add_round_key(state, round_key): return bytes(a ^ b for a, b in zip(state, round_key)) # AESå—åŠ å¯†å‡½æ•° def aes_encrypt_block(block, key): state = add_round_key(block, key) for _ in range(9): state = sub_bytes(state) state = shift_rows(state) state = mix_columns(state) state = add_round_key(state, key) state = sub_bytes(state) state = shift_rows(state) state = add_round_key(state, key) return state # AESå—è§£å¯†å‡½æ•° def aes_decrypt_block(block, key): state = add_round_key(block, key) state = inv_shift_rows(state) state = inv_sub_bytes(state) for _ in range(9): state = add_round_key(state, key) state = inv_mix_columns(state) state = inv_shift_rows(state) state = inv_sub_bytes(state) state = add_round_key(state, key) return state # CBCæ¨¡å¼åŠ å¯† def aes_cbc_encrypt(key, plaintext): iv = generate_random_bytes(BLOCK_SIZE) # ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ plaintext_padded = pad(plaintext.encode('utf-8')) ciphertext = iv previous_block = iv for i in range(0, len(plaintext_padded), BLOCK_SIZE): plaintext_block = plaintext_padded[i:i + BLOCK_SIZE] xor_block = bytes(a ^ b for a, b in zip(plaintext_block, previous_block)) encrypted_block = aes_encrypt_block(xor_block, key) ciphertext += encrypted_block previous_block = encrypted_block return ciphertext # CBCæ¨¡å¼è§£å¯† def aes_cbc_decrypt(key, ciphertext): iv = ciphertext[:BLOCK_SIZE] actual_ciphertext = ciphertext[BLOCK_SIZE:] previous_block = iv plaintext_padded = b'' for i in range(0, len(actual_ciphertext), BLOCK_SIZE): ciphertext_block = actual_ciphertext[i:i + BLOCK_SIZE] decrypted_block = aes_decrypt_block(ciphertext_block, key) plaintext_block = bytes(a ^ b for a, b in zip(decrypted_block, previous_block)) plaintext_padded += plaintext_block previous_block = ciphertext_block plaintext = unpad(plaintext_padded) return plaintext.decode('utf-8') # OFBæ¨¡å¼åŠ å¯† def aes_ofb_encrypt(key, plaintext): iv = generate_random_bytes(BLOCK_SIZE) # ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰ plaintext_bytes = plaintext.encode('utf-8') ciphertext = iv previous_block = iv for i in range(0, len(plaintext_bytes), BLOCK_SIZE): block = plaintext_bytes[i:i + BLOCK_SIZE] encrypted_block = aes_encrypt_block(previous_block, key) cipher_block = bytes(a ^ b for a, b in zip(block, encrypted_block)) ciphertext += cipher_block previous_block = encrypted_block return ciphertext # OFBæ¨¡å¼è§£å¯† def aes_ofb_decrypt(key, ciphertext): iv = ciphertext[:BLOCK_SIZE] actual_ciphertext = ciphertext[BLOCK_SIZE:] previous_block = iv plaintext_bytes = b'' for i in range(0, len(actual_ciphertext), BLOCK_SIZE): ciphertext_block = actual_ciphertext[i:i + BLOCK_SIZE] encrypted_block = aes_encrypt_block(previous_block, key) plaintext_block = bytes(a ^ b for a, b in zip(ciphertext_block, encrypted_block)) plaintext_bytes += plaintext_block previous_block = encrypted_block return plaintext_bytes.decode('utf-8') # ç”ŸæˆAESå¯†é’¥ def generate_aes_key(): return generate_random_bytes(BLOCK_SIZE) def main(): message = \"26221013_Daaihang_Wong\" # å­¦å·+å§“å print(f\"åŸå§‹æ¶ˆæ¯: {message}\") # ç”ŸæˆAESå¯†é’¥ aes_key = generate_aes_key() # CBCæ¨¡å¼ encrypted_message_cbc = aes_cbc_encrypt(aes_key, message) print(f\"CBCæ¨¡å¼åŠ å¯†åçš„æ¶ˆæ¯: {encrypted_message_cbc}\") decrypted_message_cbc = aes_cbc_decrypt(aes_key, encrypted_message_cbc) print(f\"CBCæ¨¡å¼è§£å¯†åçš„æ¶ˆæ¯: {decrypted_message_cbc}\") # OFBæ¨¡å¼ encrypted_message_ofb = aes_ofb_encrypt(aes_key, message) print(f\"OFBæ¨¡å¼åŠ å¯†åçš„æ¶ˆæ¯: {encrypted_message_ofb}\") decrypted_message_ofb = aes_ofb_decrypt(aes_key, encrypted_message_ofb) print(f\"OFBæ¨¡å¼è§£å¯†åçš„æ¶ˆæ¯: {decrypted_message_ofb}\") # æ£€æŸ¥è§£å¯†åçš„æ¶ˆæ¯æ˜¯å¦æ­£ç¡® assert message == decrypted_message_cbc, \"CBCæ¨¡å¼è§£å¯†å¤±è´¥ï¼\" assert message == decrypted_message_ofb, \"OFBæ¨¡å¼è§£å¯†å¤±è´¥ï¼\" print(\"CBCå’ŒOFBæ¨¡å¼è§£å¯†æˆåŠŸï¼\") if __name__ == \"__main__\": main() å®éªŒäºŒ éå¯¹ç§°åŠ å¯† å…¬é’¥åŠ å¯†ç®—æ³•RSA ç¼–å†™RSAå¯†ç ç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†ï¼‰ åˆ©ç”¨æ­¤ç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯† â–º ä»£ç  2-1_Asymmetric_RSA\rimport random from sympy import isprime, mod_inverse class RSAEncryption: def __init__(self, key_size=2048): self.key_size = key_size self.public_key, self.private_key = self.generate_keys() def generate_prime(self, n_bits): \"\"\" ç”Ÿæˆä¸€ä¸ªå…·æœ‰æŒ‡å®šä½æ•°çš„ç´ æ•° \"\"\" while True: num = random.getrandbits(n_bits) if isprime(num): return num def generate_keys(self): \"\"\" ç”ŸæˆRSAå…¬é’¥å’Œç§é’¥ \"\"\" # é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å¤§ç´ æ•° p å’Œ q p = self.generate_prime(self.key_size // 2) q = self.generate_prime(self.key_size // 2) # è®¡ç®— n = p * q n = p * q # è®¡ç®— Ï†(n) = (p-1)(q-1)ï¼Œå…¶ä¸­Ï†(n)ä¸ºnçš„æ¬§æ‹‰å‡½æ•° phi = (p - 1) * (q - 1) # é€‰æ‹©ä¸€ä¸ªæ•´æ•° eï¼Œä½¿å¾— 1 \u003c e \u003c Ï†(n) å¹¶ä¸” e ä¸ Ï†(n) äº’è´¨ e = 65537 # å¸¸ç”¨çš„ e å€¼ # è®¡ç®— d ä½¿å¾— d * e â‰¡ 1 (mod Ï†(n))ï¼Œå³ d æ˜¯ e æ¨¡ Ï†(n) çš„ä¹˜æ³•é€†å…ƒ d = mod_inverse(e, phi) # å…¬é’¥: (e, n) # ç§é’¥: (d, n) public_key = (e, n) private_key = (d, n) return public_key, private_key def encrypt(self, message): \"\"\" ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯ã€‚å°†æ¶ˆæ¯è½¬æ¢ä¸ºæ•´æ•° mï¼Œè®¡ç®—å¯†æ–‡ c = m^e mod nã€‚ \"\"\" e, n = self.public_key # å°†æ¶ˆæ¯è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºæ•´æ•° message_bytes = message.encode('utf-8') message_int = int.from_bytes(message_bytes, byteorder='big') # ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯ encrypted_message_int = pow(message_int, e, n) return encrypted_message_int def decrypt(self, encrypted_message_int): \"\"\" ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯ã€‚è®¡ç®—åŸæ–‡ m = c^d mod nï¼Œå°†æ•´æ•° m è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ \"\"\" d, n = self.private_key # ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯ decrypted_message_int = pow(encrypted_message_int, d, n) # å°†æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸² decrypted_message_bytes = decrypted_message_int.to_bytes((decrypted_message_int.bit_length() + 7) // 8, byteorder='big') return decrypted_message_bytes.decode('utf-8') # å®ä¾‹åŒ–RSAEncryptionç±» rsa_encryption = RSAEncryption() # å®šä¹‰è¦åŠ å¯†çš„æ¶ˆæ¯ student_info = \"26221013_Daaihang_Wong\" # åŠ å¯†æ¶ˆæ¯ encrypted_message = rsa_encryption.encrypt(student_info) print(f\"åŠ å¯†æ¶ˆæ¯ï¼š{encrypted_message}\") # è§£å¯†æ¶ˆæ¯ decrypted_message = rsa_encryption.decrypt(encrypted_message) print(f\"è§£å¯†æ¶ˆæ¯ï¼š{decrypted_message}\") # éªŒè¯è§£å¯†æ˜¯å¦æ­£ç¡® if student_info == decrypted_message: print(\"è§£å¯†æˆåŠŸï¼Œæ¶ˆæ¯æ­£ç¡®\") else: print(\"è§£å¯†å¤±è´¥ï¼Œæ¶ˆæ¯ä¸æ­£ç¡®\") å…¬é’¥åŠ å¯†ç®—æ³•ElGamal ç¼–å†™ElGamalåŠ å¯†ç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ï¼‰ åˆ©ç”¨æ­¤ç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯† â–º ä»£ç  2-2_Asymmetric_ElGamal\rfrom sympy import mod_inverse, isprime, randprime from random import randint class ElGamal: def __init__(self, key_size=2048): self.key_size = key_size # ç”Ÿæˆä¸€ä¸ªå¤§ç´ æ•° p self.p = self.generate_large_prime() # ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•° gï¼Œæ»¡è¶³ 2 \u003c= g \u003c= p-1 self.g = randint(2, self.p - 1) # ç”Ÿæˆç§é’¥ xï¼Œæ»¡è¶³ 1 \u003c= x \u003c= p-2 self.x = randint(1, self.p - 2) # è®¡ç®—å…¬é’¥ h = g^x mod p self.h = pow(self.g, self.x, self.p) def generate_large_prime(self): \"\"\"ç”Ÿæˆä¸€ä¸ªå¤§ç´ æ•°\"\"\" while True: # åœ¨æŒ‡å®šèŒƒå›´å†…ç”Ÿæˆä¸€ä¸ªéšæœºç´ æ•° prime_candidate = randprime(2 ** (self.key_size - 1), 2 ** self.key_size) if isprime(prime_candidate): return prime_candidate def encrypt(self, message): \"\"\" ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯ æ­¥éª¤ï¼š 1. ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•° yï¼Œæ»¡è¶³ 1 \u003c= y \u003c= p-2 2. è®¡ç®— c1 = g^y mod p 3. è®¡ç®— s = h^y mod p 4. å°†æ¶ˆæ¯è½¬æ¢ä¸ºæ•´æ•° m 5. è®¡ç®— c2 = (m * s) mod p è¿”å›å¯†æ–‡å¯¹ (c1, c2) \"\"\" y = randint(1, self.p - 2) c1 = pow(self.g, y, self.p) s = pow(self.h, y, self.p) m = int.from_bytes(message.encode('utf-8'), 'big') c2 = (m * s) % self.p return c1, c2 def decrypt(self, ciphertext): \"\"\" ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯ æ­¥éª¤ï¼š 1. æå–å¯†æ–‡å¯¹ (c1, c2) 2. è®¡ç®— s = c1^x mod p 3. è®¡ç®— s çš„ä¹˜æ³•é€†å…ƒ s_inv = s^-1 mod p 4. è®¡ç®— m = (c2 * s_inv) mod p 5. å°†æ•´æ•° m è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸² \"\"\" c1, c2 = ciphertext s = pow(c1, self.x, self.p) s_inv = mod_inverse(s, self.p) m = (c2 * s_inv) % self.p message = m.to_bytes((m.bit_length() + 7) // 8, 'big').decode('utf-8') return message # å®ä¾‹åŒ–ElGamalç±» elgamal = ElGamal() # å®šä¹‰è¦åŠ å¯†çš„æ¶ˆæ¯ student_info = \"26221013_Daaihang_Wong\" # åŠ å¯†æ¶ˆæ¯ encrypted_message = elgamal.encrypt(student_info) print(f\"åŠ å¯†æ¶ˆæ¯ï¼š{encrypted_message}\") # è§£å¯†æ¶ˆæ¯ decrypted_message = elgamal.decrypt(encrypted_message) print(f\"è§£å¯†æ¶ˆæ¯ï¼š{decrypted_message}\") # éªŒè¯è§£å¯†æ˜¯å¦æ­£ç¡® if student_info == decrypted_message: print(\"è§£å¯†æˆåŠŸï¼Œæ¶ˆæ¯æ­£ç¡®\") else: print(\"è§£å¯†å¤±è´¥ï¼Œæ¶ˆæ¯ä¸æ­£ç¡®\") æ··åˆåŠ å¯†ï¼ˆç”µå­ä¿¡å°ï¼‰ åŸºäºå·²ç¼–å†™çš„AESå’ŒRSAï¼ˆæˆ–ElGamalï¼‰å¯†ç ç®—æ³•ï¼Œå®ç°æ··åˆåŠ å¯† åˆ©ç”¨æ··åˆç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯† â–º ä»£ç \r# todo: è¿˜æ²¡å®ç°ï¼Œå…ˆç­‰ç€å§ï¼Œå¤ªä¹…äº†å°±åœ¨è¯„è®ºåŒºæ»´æ»´æˆ‘ã€‚ å®éªŒä¸‰ è®¤è¯æŠ€æœ¯ æ³¨ï¼šè¿‡ç¨‹ä¸­å¯ä»¥åˆ©ç”¨å¯†ç åº“ä¸­çš„Hashç®—æ³•ï¼ˆå¦‚SHA2ï¼ŒSM3ï¼ŒSHA3ç­‰ï¼‰\næ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ ç¼–å†™åŸºäºHashç®—æ³•çš„æ¶ˆæ¯è®¤è¯ç  åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œå®Œæ•´æ€§å’ŒçœŸå®æ€§è®¤è¯ â–º ä»£ç  3-1_Certification_MAC\rimport hashlib def xor_bytes(a, b): \"\"\"å¯¹ä¸¤ä¸ªå­—èŠ‚åºåˆ—è¿›è¡ŒæŒ‰ä½å¼‚æˆ–æ“ä½œ\"\"\" return bytes(x ^ y for x, y in zip(a, b)) def hmac_hash(key, message, hash_func=hashlib.sha256): \"\"\" å®ç° HMAC ç®—æ³• 1. å¦‚æœå¯†é’¥é•¿åº¦å¤§äºå“ˆå¸Œå—å¤§å°ï¼Œåˆ™å¯¹å¯†é’¥è¿›è¡Œå“ˆå¸Œå¤„ç† 2. å¦‚æœå¯†é’¥é•¿åº¦å°äºå“ˆå¸Œå—å¤§å°ï¼Œåˆ™åœ¨å¯†é’¥æœ«å°¾è¡¥é›¶è‡³å—å¤§å° 3. ç”Ÿæˆå†…å±‚å’Œå¤–å±‚å¡«å……å¯†é’¥ 4. ä½¿ç”¨å¡«å……åçš„å¯†é’¥å’Œæ¶ˆæ¯è¿›è¡Œä¸¤æ¬¡å“ˆå¸Œè®¡ç®— \"\"\" block_size = hash_func().block_size # å¦‚æœå¯†é’¥é•¿åº¦å¤§äºå—å¤§å°ï¼Œåˆ™å¯¹å¯†é’¥è¿›è¡Œå“ˆå¸Œå¤„ç† if len(key) \u003e block_size: key = hash_func(key).digest() # å¦‚æœå¯†é’¥é•¿åº¦å°äºå—å¤§å°ï¼Œåˆ™åœ¨å¯†é’¥æœ«å°¾è¡¥é›¶è‡³å—å¤§å° if len(key) \u003c block_size: key = key.ljust(block_size, b'\\0') # ç”Ÿæˆå†…å±‚å’Œå¤–å±‚å¡«å……å¯†é’¥ o_key_pad = xor_bytes(key, b'\\x5c' * block_size) i_key_pad = xor_bytes(key, b'\\x36' * block_size) # å†…å±‚å“ˆå¸Œ inner_hash = hash_func(i_key_pad + message).digest() # å¤–å±‚å“ˆå¸Œ final_hash = hash_func(o_key_pad + inner_hash).hexdigest() return final_hash def generate_mac(key, message, hash_func=hashlib.sha256): \"\"\" ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ ä½¿ç”¨ç»™å®šçš„å¯†é’¥å’Œæ¶ˆæ¯ç”Ÿæˆ HMAC \"\"\" message_bytes = message.encode('utf-8') return hmac_hash(key, message_bytes, hash_func) def verify_mac(key, message, mac_to_verify, hash_func=hashlib.sha256): \"\"\" éªŒè¯æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ æ¯”è¾ƒç”Ÿæˆçš„ MAC å’Œæä¾›çš„ MAC æ˜¯å¦ç›¸åŒ \"\"\" generated_mac = generate_mac(key, message, hash_func) return compare_digest(generated_mac, mac_to_verify) def compare_digest(a, b): \"\"\"æ¯”è¾ƒä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œé˜²æ­¢æ—¶é—´æ”»å‡»\"\"\" if len(a) != len(b): return False result = 0 for x, y in zip(a, b): result |= ord(x) ^ ord(y) return result == 0 # æ¶ˆæ¯ message = \"26221013_Daaihang_Wong\" # ä½¿ç”¨çš„å¯†é’¥ key = b'Qw3rTyQw3rTy' # ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç  mac = generate_mac(key, message) print(f\"æ¶ˆæ¯: {message}\") print(f\"ç”Ÿæˆçš„MAC: {mac}\") # éªŒè¯æ¶ˆæ¯è®¤è¯ç  is_valid = verify_mac(key, message, mac) print(f\"MACéªŒè¯ç»“æœ: {'æœ‰æ•ˆ' if is_valid else 'æ— æ•ˆ'}\") # æ¨¡æ‹Ÿç¯¡æ”¹æ¶ˆæ¯åçš„MACéªŒè¯ tampered_message = \"26221013_D@a1han9_W0ng\" tampered_mac = generate_mac(key, tampered_message) # ç¯¡æ”¹åçš„æ¶ˆæ¯çš„MAC is_valid_tampered = verify_mac(key, tampered_message, mac) print(f\"ç¯¡æ”¹åçš„æ¶ˆæ¯ ä¸ åŸæ¶ˆæ¯çš„MAC éªŒè¯çš„ç»“æœ: {'æœ‰æ•ˆ' if is_valid_tampered else 'æ— æ•ˆ'}\") RSAæ•°å­—ç­¾åç®—æ³• ç¼–å†™RSAç­¾åç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ï¼‰ åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œç­¾åï¼›å¹¶åœ¨æ¥æ”¶æ–¹è¿›è¡ŒéªŒè¯ â–º ä»£ç  3-2_Certification_RSA\r# RSAæ•°å­—ç­¾åç®—æ³•ï¼ˆåˆ©ç”¨å¯†ç åº“ä¸­çš„Hashç®—æ³•ï¼‰ from cryptography.hazmat.primitives.asymmetric import rsa, padding from cryptography.hazmat.primitives import hashes, serialization def generate_rsa_key_pair(): private_key = rsa.generate_private_key( public_exponent=65537, key_size=2048 ) public_key = private_key.public_key() return private_key, public_key def sign_message(private_key, message, hash_algorithm): signature = private_key.sign( message.encode(), padding.PSS( mgf=padding.MGF1(hash_algorithm), salt_length=padding.PSS.MAX_LENGTH ), hash_algorithm ) return signature def verify_signature(public_key, message, signature, hash_algorithm): try: public_key.verify( signature, message.encode(), padding.PSS( mgf=padding.MGF1(hash_algorithm), salt_length=padding.PSS.MAX_LENGTH ), hash_algorithm ) return True except Exception as e: return False # ç”Ÿæˆå¯†é’¥å¯¹ private_key, public_key = generate_rsa_key_pair() # æ¶ˆæ¯ message = \"26221013_Daaihang_Wong\" # ä½¿ç”¨çš„å“ˆå¸Œç®—æ³• hash_algorithm = hashes.SHA256() # ç”Ÿæˆç­¾å signature = sign_message(private_key, message, hash_algorithm) print(f\"æ¶ˆæ¯: {message}\") print(f\"ç­¾å: {signature.hex()}\") # éªŒè¯ç­¾å is_valid = verify_signature(public_key, message, signature, hash_algorithm) print(f\"ç­¾åéªŒè¯ç»“æœ: {'æœ‰æ•ˆ' if is_valid else 'æ— æ•ˆ'}\") # æ¨¡æ‹Ÿç¯¡æ”¹æ¶ˆæ¯åçš„ç­¾åéªŒè¯ tampered_message = \"26221013_D@a1han9_W0ng\" is_valid_tampered = verify_signature(public_key, tampered_message, signature, hash_algorithm) print(f\"ç¯¡æ”¹åæ¶ˆæ¯çš„ç­¾åéªŒè¯ç»“æœ: {'æœ‰æ•ˆ' if is_valid_tampered else 'æ— æ•ˆ'}\") ElGamalæ•°å­—ç­¾åç®—æ³• ç¼–å†™ElGamalç­¾åç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ï¼‰ åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œç­¾åï¼›å¹¶åœ¨æ¥æ”¶æ–¹è¿›è¡ŒéªŒè¯ â–º ä»£ç  3-3_Certification_ElGamal\rimport hashlib import random from math import gcd from sympy import mod_inverse, randprime, isprime # ç¡®ä¿ç”Ÿæˆå…ƒæ˜¯æ¨¡pçš„ä¸€ä¸ªåŸæ ¹ def find_primitive_root(p): \"\"\" æ‰¾åˆ°æ¨¡ p çš„ä¸€ä¸ªåŸæ ¹ã€‚ å‚æ•°ï¼š p -- æ¨¡æ•°ï¼Œåº”ä¸ºç´ æ•° è¿”å›ï¼š g -- æ¨¡ p çš„ä¸€ä¸ªåŸæ ¹ \"\"\" if not isprime(p): raise ValueError(\"p must be a prime number\") phi = p - 1 prime_factors = set() n = phi i = 2 while i * i \u003c= n: if n % i == 0: prime_factors.add(i) while n % i == 0: n //= i i += 1 if n \u003e 1: prime_factors.add(n) for g in range(2, p): if all(pow(g, phi // factor, p) != 1 for factor in prime_factors): return g return None # ElGamalç­¾åç®—æ³•ç±» class ElGamalSignature: def __init__(self, p=None, g=None, x=None, bits=256): \"\"\" åˆå§‹åŒ– ElGamal ç­¾åç®—æ³•å¯¹è±¡ã€‚ å‚æ•°ï¼š p -- å¤§ç´ æ•°ï¼Œæ¨¡æ•° g -- æ¨¡ p çš„åŸæ ¹ x -- ç§é’¥ bits -- ç´ æ•° p çš„ä½æ•°ï¼Œé»˜è®¤ä¸º 256 å¦‚æœæœªæä¾› pã€gã€xï¼Œåˆ™éšæœºç”Ÿæˆã€‚ \"\"\" if p is None or g is None or x is None: self.p = randprime(2 ** (bits - 1), 2 ** bits) self.g = find_primitive_root(self.p) self.x = random.randint(1, self.p - 2) else: self.p = p self.g = g self.x = x self.y = pow(self.g, self.x, self.p) # ç­¾åå‡½æ•° def sign(self, message): \"\"\" å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚ å‚æ•°ï¼š message -- è¦ç­¾åçš„æ¶ˆæ¯ è¿”å›ï¼š (r, s) -- ç­¾åç»“æœ \"\"\" h = hashlib.sha256(message.encode()).digest() h_int = int.from_bytes(h, byteorder='big') while True: k = random.randint(1, self.p - 2) if gcd(k, self.p - 1) == 1: # ç¡®ä¿ k å’Œ p-1 äº’è´¨ break r = pow(self.g, k, self.p) k_inv = mod_inverse(k, self.p - 1) s = (h_int - self.x * r) * k_inv % (self.p - 1) return (r, s) # éªŒè¯å‡½æ•° def verify(self, message, signature): \"\"\" éªŒè¯æ¶ˆæ¯çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚ å‚æ•°ï¼š message -- åŸå§‹æ¶ˆæ¯ signature -- ç­¾åå…ƒç»„ (r, s) è¿”å›ï¼š valid -- ç­¾åæ˜¯å¦æœ‰æ•ˆï¼ŒTrue æˆ– False \"\"\" r, s = signature if not (0 \u003c r \u003c self.p and 0 \u003c s \u003c self.p - 1): # æ£€æŸ¥ r å’Œ s çš„èŒƒå›´ return False h = hashlib.sha256(message.encode()).digest() h_int = int.from_bytes(h, byteorder='big') v1 = pow(self.y, r, self.p) * pow(r, s, self.p) % self.p v2 = pow(self.g, h_int, self.p) return v1 == v2 # æµ‹è¯•ä»£ç  if __name__ == '__main__': # å¤§ç´ æ•°å’Œç”Ÿæˆå…ƒ p = 97380703184954711490740892696023412334547368592870793188226395165275008037663 g = 2 # ä½¿ç”¨find_primitive_rootæ‰¾å‡ºçš„åŸæ ¹ï¼Œè‹¥å·²çŸ¥åˆ™ç›´æ¥èµ‹å€¼ x = 123456789 # ç§é’¥ # åˆå§‹åŒ–ElGamalç­¾åå¯¹è±¡ elgamal = ElGamalSignature(p, g, x) # æ¶ˆæ¯ student_info = \"26221013_Daaihang_Wong\" # ç­¾å signature = elgamal.sign(student_info) print(\"ç­¾åï¼š\", signature) # éªŒè¯ if elgamal.verify(student_info, signature): print(\"ç­¾åæœ‰æ•ˆ\") else: print(\"ç­¾åæ— æ•ˆ\") å®éªŒå››ï¼šå¯†é’¥ç®¡ç† DHå¯†é’¥äº¤æ¢åè®® DHå¯†é’¥äº¤æ¢åè®®ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†ï¼‰ åŒæ–¹åˆ©ç”¨æ­¤åè®®ç”Ÿæˆçš„å¯†é’¥ï¼Œç»“åˆå·²ç¼–å†™çš„AESç®—æ³•æ¥åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯† â–º ä»£ç  4-1_Key_Management_DH\rfrom cryptography.hazmat.primitives import serialization from cryptography.hazmat.primitives.asymmetric import x25519 from cryptography.hazmat.primitives.kdf.hkdf import HKDF from cryptography.hazmat.primitives import hashes from cryptography.hazmat.backends import default_backend from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes import os # å‡½æ•°ï¼šæ‰§è¡ŒDiffie-Hellmanå¯†é’¥äº¤æ¢ def diffie_hellman(): # ç”ŸæˆAliceçš„ç§é’¥å’Œå…¬é’¥ alice_private_key = x25519.X25519PrivateKey.generate() alice_public_key = alice_private_key.public_key() # ç”ŸæˆBobçš„ç§é’¥å’Œå…¬é’¥ bob_private_key = x25519.X25519PrivateKey.generate() bob_public_key = bob_private_key.public_key() # Aliceè®¡ç®—å…±äº«å¯†é’¥ alice_shared_key = alice_private_key.exchange(bob_public_key) # Bobè®¡ç®—å…±äº«å¯†é’¥ bob_shared_key = bob_private_key.exchange(alice_public_key) # ç¡®ä¿åŒæ–¹è®¡ç®—å¾—åˆ°çš„å…±äº«å¯†é’¥ç›¸åŒ assert alice_shared_key == bob_shared_key return alice_shared_key # å‡½æ•°ï¼šä½¿ç”¨AESåŠ å¯†æ¶ˆæ¯ def encrypt_message(message, key): backend = default_backend() iv = os.urandom(16) # ç”ŸæˆéšæœºIV cipher = Cipher(algorithms.AES(key), modes.CFB(iv), backend=backend) encryptor = cipher.encryptor() ciphertext = encryptor.update(message) + encryptor.finalize() return (iv, ciphertext) # å‡½æ•°ï¼šä½¿ç”¨AESè§£å¯†æ¶ˆæ¯ def decrypt_message(ciphertext, key, iv): backend = default_backend() cipher = Cipher(algorithms.AES(key), modes.CFB(iv), backend=backend) decryptor = cipher.decryptor() plaintext = decryptor.update(ciphertext) + decryptor.finalize() return plaintext # ä¸»å‡½æ•°ï¼šæ¼”ç¤ºè¿‡ç¨‹ def main(): # æ‰§è¡ŒDiffie-Hellmanå¯†é’¥äº¤æ¢ shared_key = diffie_hellman() print(f\"å…±äº«å¯†é’¥ (Hex): {shared_key.hex()}\") # ä½¿ç”¨HKDFä»å…±äº«å¯†é’¥æ´¾ç”ŸAESå¯†é’¥ derived_key = HKDF( algorithm=hashes.SHA256(), length=32, # 256ä½å¯†é’¥é•¿åº¦ salt=None, info=b'Qw3rTyQw3rTyQw3rTy', backend=default_backend() ).derive(shared_key) # åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯ message = b\"26221013_Daaihang_Wong\" print(f\"åŸå§‹æ¶ˆæ¯: {message.decode()}\") # åŠ å¯†æ¶ˆæ¯ iv, ciphertext = encrypt_message(message, derived_key) print(f\"åŠ å¯†åçš„æ¶ˆæ¯ (Hex): {ciphertext.hex()}\") # è§£å¯†æ¶ˆæ¯ decrypted_message = decrypt_message(ciphertext, derived_key, iv) print(f\"è§£å¯†åçš„æ¶ˆæ¯: {decrypted_message.decode()}\") if __name__ == \"__main__\": main() Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ ç¼–å†™ä¸€ä¸ª(n, t) Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆï¼ˆåŒ…å«ç§˜å¯†çš„åˆ†ç‰‡å’ŒåŸºäºLagrangeæ’å€¼æ–¹æ³•æ¢å¤ç§˜å¯†ï¼‰ å®ä¾‹åŒ–(n, t) =(5, 3)ï¼Œè€Œç§˜å¯†ä¿¡æ¯ä¸ºä½ çš„â€œå­¦å·+å§“åâ€ï¼Œæ¼”ç¤ºç§˜å¯†åˆ†ç‰‡å’Œæ¢å¤ç§˜å¯†çš„è¿‡ç¨‹ã€‚ â–º ä»£ç  4-2_Key_Management_Shamir\rimport random from sympy import nextprime def generate_shares(secret, n, t, prime): \"\"\" ä½¿ç”¨Shamirçš„ç§˜å¯†å…±äº«æ–¹æ¡ˆç”Ÿæˆnä¸ªåˆ†äº«ï¼Œé˜ˆå€¼ä¸ºtã€‚ å‚æ•°ï¼š - secret: è¦å…±äº«çš„ç§˜å¯†ï¼ˆä»¥æ•°å€¼å½¢å¼ï¼‰ã€‚ - n: è¦ç”Ÿæˆçš„åˆ†äº«æ€»æ•°ã€‚ - t: æ¢å¤ç§˜å¯†æ‰€éœ€çš„åˆ†äº«é˜ˆå€¼ã€‚ - prime: æœ‰é™åŸŸç´ æ•°ï¼Œç”¨äºè®¡ç®—ã€‚ è¿”å›ï¼š - ä¸€ä¸ªåŒ…å«åˆ†äº«çš„å…ƒç»„åˆ—è¡¨ (x, y)ã€‚ \"\"\" coefficients = [secret] + [random.randrange(prime) for _ in range(t - 1)] def polynomial(x): return sum([coeff * pow(x, i, prime) % prime for i, coeff in enumerate(coefficients)]) % prime shares = [] for i in range(1, n + 1): x = i y = polynomial(x) shares.append((x, y)) return shares def recover_secret(shares, prime): \"\"\" ä½¿ç”¨Shamirçš„ç§˜å¯†å…±äº«æ–¹æ¡ˆæ¢å¤ç§˜å¯†ï¼Œç»™å®šè¶³å¤Ÿæ•°é‡çš„åˆ†äº«ã€‚ å‚æ•°ï¼š - shares: ä¸€ä¸ªåˆ†äº«çš„å…ƒç»„åˆ—è¡¨ (x, y)ã€‚ - prime: æœ‰é™åŸŸç´ æ•°ï¼Œç”¨äºè®¡ç®—ã€‚ è¿”å›ï¼š - æ¢å¤çš„ç§˜å¯†ï¼ˆä»¥æ•°å€¼å½¢å¼ï¼‰ã€‚ \"\"\" def lagrange_interpolation(x, shares): total = 0 n = len(shares) for i in range(n): xi, yi = shares[i] term = yi for j in range(n): if i != j: xj, _ = shares[j] term = term * (x - xj) * pow(xi - xj, -1, prime) % prime total = (total + term) % prime return total return lagrange_interpolation(0, shares) # ç¤ºä¾‹ï¼šä½¿ç”¨å­¦å·å’Œå§“åä½œä¸ºç§˜å¯† secret = \"26221013_Daaihang_Wong\" secret_numeric = int.from_bytes(secret.encode(), \"big\") # è½¬æ¢ä¸ºæ•°å€¼å½¢å¼ n = 5 # æ€»åˆ†äº«æ•° t = 3 # æ¢å¤ç§˜å¯†æ‰€éœ€çš„åˆ†äº«é˜ˆå€¼ # é€‰æ‹©ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç´ æ•°ä½œä¸ºæœ‰é™åŸŸçš„æ¨¡æ•° prime = nextprime(secret_numeric) # ç”Ÿæˆåˆ†äº« shares = generate_shares(secret_numeric, n, t, prime) print(\"åˆ†äº«ï¼š\") for share in shares: print(share) # é€‰æ‹©ä»»æ„ t ä¸ªåˆ†äº«æ¥æ¢å¤ç§˜å¯† selected_shares = random.sample(shares, t) # æ¢å¤ç§˜å¯† recovered_numeric = recover_secret(selected_shares, prime) # å°†æ•°å€¼å½¢å¼çš„ç§˜å¯†è½¬æ¢ä¸ºå­—èŠ‚æ•°æ® recovered_secret_bytes = recovered_numeric.to_bytes((recovered_numeric.bit_length() + 7) // 8, \"big\") # æ¯”è¾ƒæ¢å¤çš„ç§˜å¯†ä¸åŸå§‹ç§˜å¯† if recovered_secret_bytes == secret.encode(): print(\"\\næˆåŠŸæ¢å¤ç§˜å¯†ï¼š\", secret) else: print(\"\\næ¢å¤çš„ç§˜å¯†ä¸åŸå§‹ç§˜å¯†ä¸åŒ¹é…\") ","wordCount":"9342","inLanguage":"zh","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-06-21T18:54:10+08:00","dateModified":"2024-06-21T18:54:10+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/docs/crypto/"},"publisher":{"@type":"Organization","name":"Daaihang's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Daaihang's Blog (Alt + H)"><img src=http://localhost:1313/favicon.svg alt aria-label=logo height=35>Daaihang's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/daily/ title=ğŸˆæ—¥å¸¸><span>ğŸˆæ—¥å¸¸</span></a></li><li><a href=http://localhost:1313/docs/ title=ğŸ§‘â€ğŸ’»å¼€å‘><span>ğŸ§‘â€ğŸ’»å¼€å‘</span></a></li><li><a href=http://localhost:1313/tags/ title=ğŸ·ï¸æ ‡ç­¾><span>ğŸ·ï¸æ ‡ç­¾</span></a></li><li><a href=http://localhost:1313/categories/ title=ğŸ“Œåˆ†ç±»><span>ğŸ“Œåˆ†ç±»</span></a></li><li><a href=http://localhost:1313/search/ title=ğŸ”æœç´¢><span>ğŸ”æœç´¢</span></a></li><li><a href=http://localhost:1313/friend/ title=ğŸ§‘â€ğŸ¤â€ğŸ§‘æœ‹å‹><span>ğŸ§‘â€ğŸ¤â€ğŸ§‘æœ‹å‹</span></a></li><li><a href=http://localhost:1313/about/ title=ğŸ«°å…³äº><span>ğŸ«°å…³äº</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/docs/>å¼€å‘</a></div><h1 class=post-title>ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒä»£ç </h1><div class=post-meta>2024-06-21Â·9342 å­—&nbsp;|&nbsp;<a href=https://github.com/daaihang/myWebsite/tree/main/content/docs/crypto.md rel="noopener noreferrer" target=_blank>æºä»£ç </a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e5%ae%9e%e9%aa%8c%e4%b8%80-%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label="å®éªŒä¸€ å¯¹ç§°åŠ å¯†">å®éªŒä¸€ å¯¹ç§°åŠ å¯†</a><ul><li><a href=#%e5%8f%a4%e5%85%b8%e5%af%86%e7%a0%81hill%e5%af%86%e7%a0%81 aria-label=å¤å…¸å¯†ç Hillå¯†ç >å¤å…¸å¯†ç Hillå¯†ç </a></li><li><a href=#%e7%bd%ae%e6%8d%a2%e5%af%86%e7%a0%81 aria-label=ç½®æ¢å¯†ç >ç½®æ¢å¯†ç </a></li><li><a href=#%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95aes%e5%92%8c%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f aria-label=å¯¹ç§°åŠ å¯†ç®—æ³•AESå’Œå·¥ä½œæ¨¡å¼>å¯¹ç§°åŠ å¯†ç®—æ³•AESå’Œå·¥ä½œæ¨¡å¼</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e4%ba%8c-%e9%9d%9e%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label="å®éªŒäºŒ éå¯¹ç§°åŠ å¯†">å®éªŒäºŒ éå¯¹ç§°åŠ å¯†</a><ul><li><a href=#%e5%85%ac%e9%92%a5%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95rsa aria-label=å…¬é’¥åŠ å¯†ç®—æ³•RSA>å…¬é’¥åŠ å¯†ç®—æ³•RSA</a></li><li><a href=#%e5%85%ac%e9%92%a5%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95elgamal aria-label=å…¬é’¥åŠ å¯†ç®—æ³•ElGamal>å…¬é’¥åŠ å¯†ç®—æ³•ElGamal</a></li><li><a href=#%e6%b7%b7%e5%90%88%e5%8a%a0%e5%af%86%e7%94%b5%e5%ad%90%e4%bf%a1%e5%b0%81 aria-label=æ··åˆåŠ å¯†ï¼ˆç”µå­ä¿¡å°ï¼‰>æ··åˆåŠ å¯†ï¼ˆç”µå­ä¿¡å°ï¼‰</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e4%b8%89-%e8%ae%a4%e8%af%81%e6%8a%80%e6%9c%af aria-label="å®éªŒä¸‰ è®¤è¯æŠ€æœ¯">å®éªŒä¸‰ è®¤è¯æŠ€æœ¯</a><ul><li><a href=#%e6%b6%88%e6%81%af%e8%ae%a4%e8%af%81%e7%a0%81mac aria-label=æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰>æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰</a></li><li><a href=#rsa%e6%95%b0%e5%ad%97%e7%ad%be%e5%90%8d%e7%ae%97%e6%b3%95 aria-label=RSAæ•°å­—ç­¾åç®—æ³•>RSAæ•°å­—ç­¾åç®—æ³•</a></li><li><a href=#elgamal%e6%95%b0%e5%ad%97%e7%ad%be%e5%90%8d%e7%ae%97%e6%b3%95 aria-label=ElGamalæ•°å­—ç­¾åç®—æ³•>ElGamalæ•°å­—ç­¾åç®—æ³•</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e5%9b%9b%e5%af%86%e9%92%a5%e7%ae%a1%e7%90%86 aria-label=å®éªŒå››ï¼šå¯†é’¥ç®¡ç†>å®éªŒå››ï¼šå¯†é’¥ç®¡ç†</a><ul><li><a href=#dh%e5%af%86%e9%92%a5%e4%ba%a4%e6%8d%a2%e5%8d%8f%e8%ae%ae aria-label=DHå¯†é’¥äº¤æ¢åè®®>DHå¯†é’¥äº¤æ¢åè®®</a></li><li><a href=#shamir%e7%a7%98%e5%af%86%e5%85%b1%e4%ba%ab%e6%96%b9%e6%a1%88 aria-label=Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ>Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>é€ ç¦ä¸‹ä¸€å±Šï¼Œäººäººæœ‰è´£ã€‚</p></blockquote><p>æ‰€å±å®éªŒï¼šè¥¿å®‰é‚®ç”µå¤§å­¦ - ç½‘ç»œç©ºé—´å®‰å…¨å­¦é™¢ - å¯†ç å­¦åŸºç¡€ - è¯¾ç¨‹è®¾è®¡å®éªŒ**</p><p><strong>å®éªŒæ—¶é—´ï¼š2024å¹´ä¸ŠåŠå¹´</strong></p><p>æ–‡ä¸­æ‰€ç”¨ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨ pip è‡ªè¡Œå®‰è£…ã€‚</p><p>å¦å¤–è¿˜æœ‰ğŸ‘‰<a href=./crypto-experimental-principles><strong>ä¿¡æ¯å®‰å…¨å¯†ç å­¦åŸºç¡€ - å®éªŒåŸç†</strong></a>ï¼Œè¿™é‡Œæœ‰å„ä¸ªå®éªŒçš„å®éªŒåŸç†ã€‚</p><p><em>å…è´£å£°æ˜ï¼šå®éªŒä»£ç ä»…ä¾›å‚è€ƒï¼Œè¯·è‡ªè¡Œè®¾è®¡å®ç°ã€‚</em></p><h2 id=å®éªŒä¸€-å¯¹ç§°åŠ å¯†>å®éªŒä¸€ å¯¹ç§°åŠ å¯†<a hidden class=anchor aria-hidden=true href=#å®éªŒä¸€-å¯¹ç§°åŠ å¯†>#</a></h2><h3 id=å¤å…¸å¯†ç hillå¯†ç >å¤å…¸å¯†ç Hillå¯†ç <a hidden class=anchor aria-hidden=true href=#å¤å…¸å¯†ç hillå¯†ç >#</a></h3><p>éšæœºç”Ÿæˆä¸€ä¸ª2Ã—2å’Œä¸€ä¸ª3Ã—3çš„å¯é€†çš„å¯†é’¥çŸ©é˜µï¼ŒçŸ©é˜µå…ƒç´ å–è‡ªZ26ã€‚</p><ol><li>æ±‚è¿™ä¸¤ä¸ªçŸ©é˜µçš„é€†çŸ©é˜µ</li><li>åˆ†åˆ«ç”¨è¿™ä¸¤ä¸ªå¯†é’¥çŸ©é˜µåŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  1-1_Symmetric_Hill</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>Matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®šä¹‰å¯è§ ASCII å­—ç¬¦çš„èŒƒå›´</span>
</span></span><span class=line><span class=cl><span class=n>MIN_ASCII</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=n>MAX_ASCII</span> <span class=o>=</span> <span class=mi>126</span>
</span></span><span class=line><span class=cl><span class=n>Z</span> <span class=o>=</span> <span class=n>MAX_ASCII</span> <span class=o>-</span> <span class=n>MIN_ASCII</span> <span class=o>+</span> <span class=mi>1</span>  <span class=c1># å­—ç¬¦é›†å¤§å°</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆä¸€ä¸ªéšæœºçš„ n x n å¯é€†çŸ©é˜µï¼Œå…ƒç´ å–è‡ª Z</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_invertible_matrix</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>matrix</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># æ£€æŸ¥çŸ©é˜µè¡Œåˆ—å¼ä¸ Z æ˜¯å¦äº’è´¨ï¼Œåªæœ‰äº’è´¨æ—¶çŸ©é˜µæ‰æ˜¯å¯é€†çš„</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>gcd</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>det</span><span class=p>(</span><span class=n>matrix</span><span class=p>))),</span> <span class=n>Z</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è®¡ç®—çŸ©é˜µåœ¨æ¨¡ Z ä¸‹çš„é€†çŸ©é˜µ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>modular_inverse</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mat</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>matrix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨ sympy åº“è®¡ç®—çŸ©é˜µçš„æ¨¡é€†</span>
</span></span><span class=line><span class=cl>    <span class=n>inv_mat</span> <span class=o>=</span> <span class=n>mat</span><span class=o>.</span><span class=n>inv_mod</span><span class=p>(</span><span class=n>mod</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>inv_mat</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆ 2x2 å’Œ 3x3 å¯é€†çŸ©é˜µ</span>
</span></span><span class=line><span class=cl><span class=n>matrix_2x2</span> <span class=o>=</span> <span class=n>generate_invertible_matrix</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>matrix_3x3</span> <span class=o>=</span> <span class=n>generate_invertible_matrix</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è®¡ç®—çŸ©é˜µçš„é€†çŸ©é˜µ</span>
</span></span><span class=line><span class=cl><span class=n>inverse_2x2</span> <span class=o>=</span> <span class=n>modular_inverse</span><span class=p>(</span><span class=n>matrix_2x2</span><span class=p>,</span> <span class=n>Z</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>inverse_3x3</span> <span class=o>=</span> <span class=n>modular_inverse</span><span class=p>(</span><span class=n>matrix_3x3</span><span class=p>,</span> <span class=n>Z</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æ–‡æœ¬è½¬æ¢ä¸ºæ•°å­—åˆ—è¡¨</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>text_to_numbers</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># å°†å­—ç¬¦çš„ ASCII ç å‡å» MIN_ASCII</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=o>-</span> <span class=n>MIN_ASCII</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>text</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æ•°å­—åˆ—è¡¨è½¬æ¢ä¸ºæ–‡æœ¬</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>numbers_to_text</span><span class=p>(</span><span class=n>numbers</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># å°†æ•°å­—åŠ ä¸Š MIN_ASCII è½¬æ¢å›å­—ç¬¦</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>num</span> <span class=o>+</span> <span class=n>MIN_ASCII</span><span class=p>)</span> <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hill åŠ å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hill_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key_matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>key_matrix</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>message_numbers</span> <span class=o>=</span> <span class=n>text_to_numbers</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>message_numbers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># ä½¿ç”¨æœ€å°çš„å¯è§ ASCII å­—ç¬¦è¿›è¡Œå¡«å……</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_numbers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>),</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>n</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># çŸ©é˜µä¹˜æ³•å¹¶å–æ¨¡ Z</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>key_matrix</span><span class=p>,</span> <span class=n>block</span><span class=p>)</span> <span class=o>%</span> <span class=n>Z</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_numbers</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>encrypted_block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>numbers_to_text</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hill è§£å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_key_matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>inverse_key_matrix</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_numbers</span> <span class=o>=</span> <span class=n>text_to_numbers</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_numbers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>),</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>n</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨é€†çŸ©é˜µè¿›è¡ŒçŸ©é˜µä¹˜æ³•å¹¶å–æ¨¡ Z</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>inverse_key_matrix</span><span class=p>,</span> <span class=n>block</span><span class=p>)</span> <span class=o>%</span> <span class=n>Z</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_numbers</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>decrypted_block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>numbers_to_text</span><span class=p>(</span><span class=n>decrypted_numbers</span><span class=p>)</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>  <span class=c1># ç§»é™¤å¡«å……</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®éªŒ â‘ : æ‰“å°ç”Ÿæˆçš„çŸ©é˜µåŠå…¶é€†çŸ©é˜µ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å®éªŒ â‘ : ç”Ÿæˆçš„çŸ©é˜µåŠå…¶é€†çŸ©é˜µ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2x2 çŸ©é˜µ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>matrix_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2x2 é€†çŸ©é˜µ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inverse_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>3x3 çŸ©é˜µ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>matrix_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;3x3 é€†çŸ©é˜µ:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inverse_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä»…ä¿ç•™æ¶ˆæ¯ä¸­çš„å¯è§å­—ç¬¦</span>
</span></span><span class=line><span class=cl><span class=n>filtered_message</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>MIN_ASCII</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>MAX_ASCII</span><span class=p>,</span> <span class=n>message</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encrypted_message_2x2</span> <span class=o>=</span> <span class=n>hill_encrypt</span><span class=p>(</span><span class=n>filtered_message</span><span class=p>,</span> <span class=n>matrix_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message_2x2</span> <span class=o>=</span> <span class=n>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message_2x2</span><span class=p>,</span> <span class=n>inverse_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encrypted_message_3x3</span> <span class=o>=</span> <span class=n>hill_encrypt</span><span class=p>(</span><span class=n>filtered_message</span><span class=p>,</span> <span class=n>matrix_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message_3x3</span> <span class=o>=</span> <span class=n>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message_3x3</span><span class=p>,</span> <span class=n>inverse_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºç»“æœ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†ç»“æœ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸå§‹æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>filtered_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ 2x2 çŸ©é˜µ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŠ å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>encrypted_message_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>ä½¿ç”¨ 3x3 çŸ©é˜µ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŠ å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>encrypted_message_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_3x3</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=ç½®æ¢å¯†ç >ç½®æ¢å¯†ç <a hidden class=anchor aria-hidden=true href=#ç½®æ¢å¯†ç >#</a></h3><p>éšæœºç”Ÿæˆä¸€ä¸ªç½®æ¢è¡¨ï¼ˆç½®æ¢è¡¨é•¿åº¦å¯è®¾ç½®ï¼‰</p><ol><li>æ±‚é€†ç½®æ¢</li><li>ç”¨æ­¤ç½®æ¢è¡¨åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  1-2_Symmetric_Permutation</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®šä¹‰å¯è§ ASCII å­—ç¬¦çš„èŒƒå›´</span>
</span></span><span class=line><span class=cl><span class=n>MIN_ASCII</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=n>MAX_ASCII</span> <span class=o>=</span> <span class=mi>126</span>
</span></span><span class=line><span class=cl><span class=n>CHARS</span> <span class=o>=</span> <span class=p>[</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>MIN_ASCII</span><span class=p>,</span> <span class=n>MAX_ASCII</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>LENGTH</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>CHARS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆéšæœºç½®æ¢è¡¨</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_permutation_table</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>table</span> <span class=o>=</span> <span class=n>CHARS</span><span class=p>[:</span><span class=n>length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>  <span class=c1># éšæœºæ‰“ä¹±å­—ç¬¦åˆ—è¡¨ï¼Œå½¢æˆç½®æ¢è¡¨</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>table</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆé€†ç½®æ¢è¡¨</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_inverse_permutation_table</span><span class=p>(</span><span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>inverse_table</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>inverse_table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=o>=</span> <span class=n>CHARS</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>  <span class=c1># æ‰¾åˆ°å­—ç¬¦åœ¨åŸå­—ç¬¦é›†ä¸­çš„ä½ç½®ï¼Œå¹¶åœ¨é€†ç½®æ¢è¡¨ä¸­è®°å½•ç›¸åº”çš„åŸå­—ç¬¦</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>inverse_table</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç½®æ¢åŠ å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>permutation_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ç”¨ç½®æ¢è¡¨æ›¿æ¢æ¶ˆæ¯ä¸­çš„æ¯ä¸ªå­—ç¬¦</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=k>if</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>CHARS</span> <span class=k>else</span> <span class=n>char</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç½®æ¢è§£å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>permutation_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># ç”¨é€†ç½®æ¢è¡¨è¿˜åŸæ¶ˆæ¯ä¸­çš„æ¯ä¸ªå­—ç¬¦</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>inverse_table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=k>if</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>CHARS</span> <span class=k>else</span> <span class=n>char</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®éªŒ â‘ : æ‰“å°ç”Ÿæˆçš„ç½®æ¢è¡¨åŠå…¶é€†ç½®æ¢è¡¨</span>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>generate_permutation_table</span><span class=p>(</span><span class=n>LENGTH</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>inverse_table</span> <span class=o>=</span> <span class=n>generate_inverse_permutation_table</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å®éªŒ â‘ : ç”Ÿæˆçš„ç½®æ¢è¡¨åŠå…¶é€†ç½®æ¢è¡¨&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç½®æ¢è¡¨:&#34;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;é€†ç½®æ¢è¡¨:&#34;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>inverse_table</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>permutation_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>permutation_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¾“å‡ºç»“æœ</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å®éªŒ â‘¡: åŠ å¯†å’Œè§£å¯†ç»“æœ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŸå§‹æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åŠ å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>decrypted_message</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=å¯¹ç§°åŠ å¯†ç®—æ³•aeså’Œå·¥ä½œæ¨¡å¼>å¯¹ç§°åŠ å¯†ç®—æ³•AESå’Œå·¥ä½œæ¨¡å¼<a hidden class=anchor aria-hidden=true href=#å¯¹ç§°åŠ å¯†ç®—æ³•aeså’Œå·¥ä½œæ¨¡å¼>#</a></h3><ol><li>ç¼–å†™AESåŠ å¯†å’Œè§£å¯†ç®—æ³•</li><li>åˆ†åˆ«ç»“åˆCBCå’ŒOFBå·¥ä½œæ¨¡å¼ï¼ŒåŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒæ˜¯å¦æ­£ç¡®è§£å¯†äº†ï¼Ÿ</li></ol><p><strong>æˆ‘ç»™å‡ºäº†4ç§æ–¹å¼å®ç°ã€‚ä¼˜å…ˆä½¿ç”¨ç¬¬4ä¸ªã€‚å…¶ä»–çš„æˆ–å¤šæˆ–å°‘ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„éåŸºç¡€å¯†ç åº“ï¼Œå¯èƒ½ä¸ç¬¦åˆå®éªŒè¦æ±‚ã€‚</strong></p><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  - å®ç°ä¸€ 1-3_Symmetric_AES_1</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.ciphers</span> <span class=kn>import</span> <span class=n>Cipher</span><span class=p>,</span> <span class=n>algorithms</span><span class=p>,</span> <span class=n>modes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.backends</span> <span class=kn>import</span> <span class=n>default_backend</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆéšæœºå¯†é’¥å’Œåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_key_iv</span><span class=p>(</span><span class=n>key_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>  <span class=c1># IV å¤§å°åº”ä¸ºå—å¤§å°ï¼ˆ16 å­—èŠ‚ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES åŠ å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># PKCS7å¡«å……</span>
</span></span><span class=line><span class=cl>    <span class=n>padder</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>PKCS7</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span><span class=o>.</span><span class=n>padder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>padder</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span> <span class=o>+</span> <span class=n>padder</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ›å»ºAESåŠ å¯†å™¨</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>mode</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>encryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åŠ å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span> <span class=o>+</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES è§£å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># åˆ›å»ºAESè§£å¯†å™¨</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>mode</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>decryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># è§£å¯†æ•°æ®</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>+</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å»é™¤PKCS7å¡«å……</span>
</span></span><span class=line><span class=cl>    <span class=n>unpadder</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>PKCS7</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span><span class=o>.</span><span class=n>unpadder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_data</span> <span class=o>=</span> <span class=n>unpadder</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span> <span class=o>+</span> <span class=n>unpadder</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted_data</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸»å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># è®¾ç½®å¯†é’¥é•¿åº¦ï¼ˆ128, 192, æˆ– 256 ä½ï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>key_size</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç”Ÿæˆå¯†é’¥å’Œ IV</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>,</span> <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_key_iv</span><span class=p>(</span><span class=n>key_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ‰“å°å¯†é’¥å’Œ IV</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å®éªŒ â‘ : å¯†é’¥å’Œ IV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;å¯†é’¥:&#34;</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;IV:&#34;</span><span class=p>,</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å®šä¹‰æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å®éªŒ â‘¡: CBC æ¨¡å¼åŠ å¯†å’Œè§£å¯†</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å®éªŒ â‘¡: CBC æ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_cbc</span> <span class=o>=</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>CBC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBC åŠ å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>ciphertext_cbc</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext_cbc</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>CBC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBC è§£å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å®éªŒ â‘¡: OFB æ¨¡å¼åŠ å¯†å’Œè§£å¯†</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>å®éªŒ â‘¡: OFB æ¨¡å¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_ofb</span> <span class=o>=</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>OFB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;OFB åŠ å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>ciphertext_ofb</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext_ofb</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>OFB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;OFB è§£å¯†æ¶ˆæ¯:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¿è¡Œä¸»å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  - å®ç°äºŒ 1-3_Symmetric_AES_2</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyaes</span> <span class=kn>import</span> <span class=n>pyaes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_needed</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>padding_needed</span><span class=p>)</span> <span class=o>*</span> <span class=n>padding_needed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>split_blocks</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>block_size</span><span class=o>=</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>block_size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>block_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationCBC</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>blocks</span> <span class=o>=</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>aes</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>block</span><span class=p>)</span> <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=n>padding</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationCBC</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>blocks</span> <span class=o>=</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>aes</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>block</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationOFB</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationOFB</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>iv</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Using CBC mode</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_cbc</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_cbc</span> <span class=o>=</span> <span class=n>encrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>plaintext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>ciphertext_cbc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_cbc</span> <span class=o>=</span> <span class=n>decrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_cbc</span> <span class=o>==</span> <span class=n>plaintext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Using OFB mode</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_ofb</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_ofb</span> <span class=o>=</span> <span class=n>encrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>plaintext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>ciphertext_ofb</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_ofb</span> <span class=o>=</span> <span class=n>decrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_ofb</span> <span class=o>==</span> <span class=n>plaintext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  - å®ç°ä¸‰ 1-3_Symmetric_AES_3</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ä¸€ä¸ªç®€å•çš„ AES-128-ECBï¼Œå…¶ä¸­ 128 æŒ‡é‡‡ç”¨ 128 ä½å¯†é’¥å—ï¼Œ</span>
</span></span><span class=line><span class=cl><span class=c1># ECB æ¨¡å¼ï¼Œä¸ºé•¿åº¦ä¸è¶³ 128 ä½çš„æ•°æ®å—å¡«å…… 0x00ã€‚</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box_inv</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rc</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>inv</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>inv</span><span class=p>:</span>  <span class=c1># for decryption</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box_inv</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>inv</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>inv</span><span class=p>:</span>  <span class=c1># for decryption</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][</span><span class=o>-</span><span class=n>i</span><span class=p>:]</span> <span class=o>+</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][:</span><span class=o>-</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][</span><span class=n>i</span><span class=p>:]</span> <span class=o>+</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][:</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mul_by_2</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>n</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>n</span> <span class=o>&amp;</span> <span class=mi>128</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>^=</span> <span class=mh>0x1b</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mul_by_3</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>n</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mix_column</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># [2 3 1 1]</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># [1 2 3 1]</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>]),</span>  <span class=c1># [1 1 2 3]</span>
</span></span><span class=line><span class=cl>            <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>]),</span>  <span class=c1># [3 1 1 2]</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>mix_column</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>key_expansion</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span> <span class=o>*</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># å¯¹ä¸Šä¸€è½®æœ€å4å­—èŠ‚è‡ªå¾ªç¯ã€S-boxç½®æ¢ã€è½®å¸¸æ•°å¼‚æˆ–ï¼Œä»è€Œè®¡ç®—å‡ºå½“å‰æ–°ä¸€è½®æœ€å‰4å­—èŠ‚</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>+</span> <span class=n>r</span><span class=p>[:</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span> <span class=o>^</span> <span class=p>(</span><span class=n>rc</span><span class=p>[</span><span class=n>i</span> <span class=o>//</span> <span class=mi>4</span><span class=p>]</span> <span class=k>if</span> <span class=n>j</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span> <span class=o>^</span> <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>grid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>round_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=n>round_key</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># First round</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_columns</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Final round</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># First round</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>mix_columns</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Final round</span>
</span></span><span class=line><span class=cl>    <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes</span><span class=p>(</span><span class=n>typ</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>expanded</span> <span class=o>=</span> <span class=n>key_expansion</span><span class=p>(</span><span class=nb>bytearray</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Pad the message to a multiple of 16 bytes</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># only for encryption</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>msg</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mi>16</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Encrypt/decrypt the message</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>],</span> <span class=n>expanded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>],</span> <span class=n>expanded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Qw3rTyQw3rTyQw3r&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>enc</span> <span class=o>=</span> <span class=n>aes</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;Daaihang_Wong_26221013&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>aes</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;åŠ å¯†ï¼š&#39;</span><span class=p>,</span> <span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;è§£å¯†ï¼š&#39;</span><span class=p>,</span> <span class=n>dec</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  - å®ç°å›› 1-3_Symmetric_AES_4ï¼ˆæ¨èå‚è€ƒï¼‰</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AESå—å¤§å°</span>
</span></span><span class=line><span class=cl><span class=n>BLOCK_SIZE</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆéšæœºå­—èŠ‚</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_random_bytes</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¡«å……å‡½æ•°ï¼šPKCS#7</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pad_length</span> <span class=o>=</span> <span class=n>BLOCK_SIZE</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>%</span> <span class=n>BLOCK_SIZE</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>pad_length</span><span class=p>]</span> <span class=o>*</span> <span class=n>pad_length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å»å¡«å……å‡½æ•°ï¼šPKCS#7</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pad_length</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=n>pad_length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®šä¹‰Sç›’å’Œé€†Sç›’</span>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inv_s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å­—èŠ‚æ›¿æ¢</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å­—èŠ‚æ›¿æ¢çš„é€†æ“ä½œ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>inv_s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¡Œç§»ä½</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>12</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è¡Œç§»ä½çš„é€†æ“ä½œ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>12</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># GF(2^8)ä¸­çš„ä¹˜æ³•</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gmul</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>b</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span> <span class=o>^=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>        <span class=n>hi_bit_set</span> <span class=o>=</span> <span class=n>a</span> <span class=o>&amp;</span> <span class=mh>0x80</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>&lt;&lt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hi_bit_set</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span> <span class=o>^=</span> <span class=mh>0x1b</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—æ··åˆ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mixed</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>mixed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ—æ··åˆçš„é€†æ“ä½œ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mixed</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>mixed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è½®å¯†é’¥åŠ </span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>round_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>round_key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AESå—åŠ å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_encrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AESå—è§£å¯†å‡½æ•°</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_decrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CBCæ¨¡å¼åŠ å¯†</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>  <span class=c1># ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext_padded</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=n>plaintext_padded</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>xor_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>plaintext_block</span><span class=p>,</span> <span class=n>previous_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>xor_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CBCæ¨¡å¼è§£å¯†</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=n>BLOCK_SIZE</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_padded</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>actual_ciphertext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_block</span> <span class=o>=</span> <span class=n>aes_decrypt_block</span><span class=p>(</span><span class=n>ciphertext_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>decrypted_block</span><span class=p>,</span> <span class=n>previous_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_padded</span> <span class=o>+=</span> <span class=n>plaintext_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext_padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OFBæ¨¡å¼åŠ å¯†</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ofb_encrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>  <span class=c1># ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡ï¼ˆIVï¼‰</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_bytes</span> <span class=o>=</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext_bytes</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>plaintext_bytes</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>previous_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>encrypted_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>cipher_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OFBæ¨¡å¼è§£å¯†</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ofb_decrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=n>BLOCK_SIZE</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>actual_ciphertext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>previous_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ciphertext_block</span><span class=p>,</span> <span class=n>encrypted_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_bytes</span> <span class=o>+=</span> <span class=n>plaintext_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”ŸæˆAESå¯†é’¥</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_aes_key</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>  <span class=c1># å­¦å·+å§“å</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹æ¶ˆæ¯: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç”ŸæˆAESå¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key</span> <span class=o>=</span> <span class=n>generate_aes_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># CBCæ¨¡å¼</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;CBCæ¨¡å¼åŠ å¯†åçš„æ¶ˆæ¯: </span><span class=si>{</span><span class=n>encrypted_message_cbc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_cbc_decrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>encrypted_message_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;CBCæ¨¡å¼è§£å¯†åçš„æ¶ˆæ¯: </span><span class=si>{</span><span class=n>decrypted_message_cbc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># OFBæ¨¡å¼</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_ofb_encrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;OFBæ¨¡å¼åŠ å¯†åçš„æ¶ˆæ¯: </span><span class=si>{</span><span class=n>encrypted_message_ofb</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_ofb_decrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>encrypted_message_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;OFBæ¨¡å¼è§£å¯†åçš„æ¶ˆæ¯: </span><span class=si>{</span><span class=n>decrypted_message_ofb</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ£€æŸ¥è§£å¯†åçš„æ¶ˆæ¯æ˜¯å¦æ­£ç¡®</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>message</span> <span class=o>==</span> <span class=n>decrypted_message_cbc</span><span class=p>,</span> <span class=s2>&#34;CBCæ¨¡å¼è§£å¯†å¤±è´¥ï¼&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>message</span> <span class=o>==</span> <span class=n>decrypted_message_ofb</span><span class=p>,</span> <span class=s2>&#34;OFBæ¨¡å¼è§£å¯†å¤±è´¥ï¼&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBCå’ŒOFBæ¨¡å¼è§£å¯†æˆåŠŸï¼&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=å®éªŒäºŒ-éå¯¹ç§°åŠ å¯†>å®éªŒäºŒ éå¯¹ç§°åŠ å¯†<a hidden class=anchor aria-hidden=true href=#å®éªŒäºŒ-éå¯¹ç§°åŠ å¯†>#</a></h2><h3 id=å…¬é’¥åŠ å¯†ç®—æ³•rsa>å…¬é’¥åŠ å¯†ç®—æ³•RSA<a hidden class=anchor aria-hidden=true href=#å…¬é’¥åŠ å¯†ç®—æ³•rsa>#</a></h3><ol><li>ç¼–å†™RSAå¯†ç ç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†ï¼‰</li><li>åˆ©ç”¨æ­¤ç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯†</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  2-1_Asymmetric_RSA</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>isprime</span><span class=p>,</span> <span class=n>mod_inverse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RSAEncryption</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>=</span> <span class=n>key_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>public_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_keys</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_bits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”Ÿæˆä¸€ä¸ªå…·æœ‰æŒ‡å®šä½æ•°çš„ç´ æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>num</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>n_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>isprime</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_keys</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ç”ŸæˆRSAå…¬é’¥å’Œç§é’¥
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„å¤§ç´ æ•° p å’Œ q</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®— n = p * q</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®— Ï†(n) = (p-1)(q-1)ï¼Œå…¶ä¸­Ï†(n)ä¸ºnçš„æ¬§æ‹‰å‡½æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># é€‰æ‹©ä¸€ä¸ªæ•´æ•° eï¼Œä½¿å¾— 1 &lt; e &lt; Ï†(n) å¹¶ä¸” e ä¸ Ï†(n) äº’è´¨</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>  <span class=c1># å¸¸ç”¨çš„ e å€¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®— d ä½¿å¾— d * e â‰¡ 1 (mod Ï†(n))ï¼Œå³ d æ˜¯ e æ¨¡ Ï†(n) çš„ä¹˜æ³•é€†å…ƒ</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># å…¬é’¥: (e, n)</span>
</span></span><span class=line><span class=cl>        <span class=c1># ç§é’¥: (d, n)</span>
</span></span><span class=line><span class=cl>        <span class=n>public_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>private_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>private_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯ã€‚å°†æ¶ˆæ¯è½¬æ¢ä¸ºæ•´æ•° mï¼Œè®¡ç®—å¯†æ–‡ c = m^e mod nã€‚
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>public_key</span>
</span></span><span class=line><span class=cl>        <span class=c1># å°†æ¶ˆæ¯è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºæ•´æ•°</span>
</span></span><span class=line><span class=cl>        <span class=n>message_bytes</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>message_bytes</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_message_int</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>message_int</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>encrypted_message_int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>encrypted_message_int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯ã€‚è®¡ç®—åŸæ–‡ m = c^d mod nï¼Œå°†æ•´æ•° m è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span>
</span></span><span class=line><span class=cl>        <span class=c1># ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_message_int</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>encrypted_message_int</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># å°†æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_message_bytes</span> <span class=o>=</span> <span class=n>decrypted_message_int</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>decrypted_message_int</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                 <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted_message_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®ä¾‹åŒ–RSAEncryptionç±»</span>
</span></span><span class=line><span class=cl><span class=n>rsa_encryption</span> <span class=o>=</span> <span class=n>RSAEncryption</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®šä¹‰è¦åŠ å¯†çš„æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åŠ å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>rsa_encryption</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŠ å¯†æ¶ˆæ¯ï¼š</span><span class=si>{</span><span class=n>encrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>rsa_encryption</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è§£å¯†æ¶ˆæ¯ï¼š</span><span class=si>{</span><span class=n>decrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯è§£å¯†æ˜¯å¦æ­£ç¡®</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>student_info</span> <span class=o>==</span> <span class=n>decrypted_message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†æˆåŠŸï¼Œæ¶ˆæ¯æ­£ç¡®&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†å¤±è´¥ï¼Œæ¶ˆæ¯ä¸æ­£ç¡®&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=å…¬é’¥åŠ å¯†ç®—æ³•elgamal>å…¬é’¥åŠ å¯†ç®—æ³•ElGamal<a hidden class=anchor aria-hidden=true href=#å…¬é’¥åŠ å¯†ç®—æ³•elgamal>#</a></h3><ol><li>ç¼–å†™ElGamalåŠ å¯†ç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†è¿‡ç¨‹ï¼‰</li><li>åˆ©ç”¨æ­¤ç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯†</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  2-2_Asymmetric_ElGamal</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>mod_inverse</span><span class=p>,</span> <span class=n>isprime</span><span class=p>,</span> <span class=n>randprime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ElGamal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>=</span> <span class=n>key_size</span>
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆä¸€ä¸ªå¤§ç´ æ•° p</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_large_prime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•° gï¼Œæ»¡è¶³ 2 &lt;= g &lt;= p-1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># ç”Ÿæˆç§é’¥ xï¼Œæ»¡è¶³ 1 &lt;= x &lt;= p-2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># è®¡ç®—å…¬é’¥ h = g^x mod p</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>h</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_large_prime</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;ç”Ÿæˆä¸€ä¸ªå¤§ç´ æ•°&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># åœ¨æŒ‡å®šèŒƒå›´å†…ç”Ÿæˆä¸€ä¸ªéšæœºç´ æ•°</span>
</span></span><span class=line><span class=cl>            <span class=n>prime_candidate</span> <span class=o>=</span> <span class=n>randprime</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>2</span> <span class=o>**</span> <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>isprime</span><span class=p>(</span><span class=n>prime_candidate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>prime_candidate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä½¿ç”¨å…¬é’¥åŠ å¯†æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=s2>        æ­¥éª¤ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        1. ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•° yï¼Œæ»¡è¶³ 1 &lt;= y &lt;= p-2
</span></span></span><span class=line><span class=cl><span class=s2>        2. è®¡ç®— c1 = g^y mod p
</span></span></span><span class=line><span class=cl><span class=s2>        3. è®¡ç®— s = h^y mod p
</span></span></span><span class=line><span class=cl><span class=s2>        4. å°†æ¶ˆæ¯è½¬æ¢ä¸ºæ•´æ•° m
</span></span></span><span class=line><span class=cl><span class=s2>        5. è®¡ç®— c2 = (m * s) mod p
</span></span></span><span class=line><span class=cl><span class=s2>        è¿”å›å¯†æ–‡å¯¹ (c1, c2)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>h</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c2</span> <span class=o>=</span> <span class=p>(</span><span class=n>m</span> <span class=o>*</span> <span class=n>s</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        ä½¿ç”¨ç§é’¥è§£å¯†æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=s2>        æ­¥éª¤ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        1. æå–å¯†æ–‡å¯¹ (c1, c2)
</span></span></span><span class=line><span class=cl><span class=s2>        2. è®¡ç®— s = c1^x mod p
</span></span></span><span class=line><span class=cl><span class=s2>        3. è®¡ç®— s çš„ä¹˜æ³•é€†å…ƒ s_inv = s^-1 mod p
</span></span></span><span class=line><span class=cl><span class=s2>        4. è®¡ç®— m = (c2 * s_inv) mod p
</span></span></span><span class=line><span class=cl><span class=s2>        5. å°†æ•´æ•° m è½¬æ¢ä¸ºå­—èŠ‚ï¼Œå†è½¬æ¢ä¸ºå­—ç¬¦ä¸²
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s_inv</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=p>(</span><span class=n>c2</span> <span class=o>*</span> <span class=n>s_inv</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>m</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®ä¾‹åŒ–ElGamalç±»</span>
</span></span><span class=line><span class=cl><span class=n>elgamal</span> <span class=o>=</span> <span class=n>ElGamal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®šä¹‰è¦åŠ å¯†çš„æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åŠ å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŠ å¯†æ¶ˆæ¯ï¼š</span><span class=si>{</span><span class=n>encrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è§£å¯†æ¶ˆæ¯ï¼š</span><span class=si>{</span><span class=n>decrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯è§£å¯†æ˜¯å¦æ­£ç¡®</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>student_info</span> <span class=o>==</span> <span class=n>decrypted_message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†æˆåŠŸï¼Œæ¶ˆæ¯æ­£ç¡®&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;è§£å¯†å¤±è´¥ï¼Œæ¶ˆæ¯ä¸æ­£ç¡®&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=æ··åˆåŠ å¯†ç”µå­ä¿¡å°>æ··åˆåŠ å¯†ï¼ˆç”µå­ä¿¡å°ï¼‰<a hidden class=anchor aria-hidden=true href=#æ··åˆåŠ å¯†ç”µå­ä¿¡å°>#</a></h3><ol><li>åŸºäºå·²ç¼–å†™çš„AESå’ŒRSAï¼ˆæˆ–ElGamalï¼‰å¯†ç ç®—æ³•ï¼Œå®ç°æ··åˆåŠ å¯†</li><li>åˆ©ç”¨æ··åˆç®—æ³•åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯†</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç </strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># todo: è¿˜æ²¡å®ç°ï¼Œå…ˆç­‰ç€å§ï¼Œå¤ªä¹…äº†å°±åœ¨è¯„è®ºåŒºæ»´æ»´æˆ‘ã€‚</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=å®éªŒä¸‰-è®¤è¯æŠ€æœ¯>å®éªŒä¸‰ è®¤è¯æŠ€æœ¯<a hidden class=anchor aria-hidden=true href=#å®éªŒä¸‰-è®¤è¯æŠ€æœ¯>#</a></h2><blockquote><p>æ³¨ï¼šè¿‡ç¨‹ä¸­å¯ä»¥åˆ©ç”¨å¯†ç åº“ä¸­çš„Hashç®—æ³•ï¼ˆå¦‚SHA2ï¼ŒSM3ï¼ŒSHA3ç­‰ï¼‰</p></blockquote><h3 id=æ¶ˆæ¯è®¤è¯ç mac>æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰<a hidden class=anchor aria-hidden=true href=#æ¶ˆæ¯è®¤è¯ç mac>#</a></h3><ol><li>ç¼–å†™åŸºäºHashç®—æ³•çš„æ¶ˆæ¯è®¤è¯ç </li><li>åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œå®Œæ•´æ€§å’ŒçœŸå®æ€§è®¤è¯</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  3-1_Certification_MAC</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;å¯¹ä¸¤ä¸ªå­—èŠ‚åºåˆ—è¿›è¡ŒæŒ‰ä½å¼‚æˆ–æ“ä½œ&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>x</span> <span class=o>^</span> <span class=n>y</span> <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hmac_hash</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    å®ç° HMAC ç®—æ³•
</span></span></span><span class=line><span class=cl><span class=s2>    1. å¦‚æœå¯†é’¥é•¿åº¦å¤§äºå“ˆå¸Œå—å¤§å°ï¼Œåˆ™å¯¹å¯†é’¥è¿›è¡Œå“ˆå¸Œå¤„ç†
</span></span></span><span class=line><span class=cl><span class=s2>    2. å¦‚æœå¯†é’¥é•¿åº¦å°äºå“ˆå¸Œå—å¤§å°ï¼Œåˆ™åœ¨å¯†é’¥æœ«å°¾è¡¥é›¶è‡³å—å¤§å°
</span></span></span><span class=line><span class=cl><span class=s2>    3. ç”Ÿæˆå†…å±‚å’Œå¤–å±‚å¡«å……å¯†é’¥
</span></span></span><span class=line><span class=cl><span class=s2>    4. ä½¿ç”¨å¡«å……åçš„å¯†é’¥å’Œæ¶ˆæ¯è¿›è¡Œä¸¤æ¬¡å“ˆå¸Œè®¡ç®—
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>block_size</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>()</span><span class=o>.</span><span class=n>block_size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å¦‚æœå¯†é’¥é•¿åº¦å¤§äºå—å¤§å°ï¼Œåˆ™å¯¹å¯†é’¥è¿›è¡Œå“ˆå¸Œå¤„ç†</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>block_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å¦‚æœå¯†é’¥é•¿åº¦å°äºå—å¤§å°ï¼Œåˆ™åœ¨å¯†é’¥æœ«å°¾è¡¥é›¶è‡³å—å¤§å°</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>block_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=n>block_size</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç”Ÿæˆå†…å±‚å’Œå¤–å±‚å¡«å……å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>o_key_pad</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x5c</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i_key_pad</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x36</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># å†…å±‚å“ˆå¸Œ</span>
</span></span><span class=line><span class=cl>    <span class=n>inner_hash</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>i_key_pad</span> <span class=o>+</span> <span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¤–å±‚å“ˆå¸Œ</span>
</span></span><span class=line><span class=cl>    <span class=n>final_hash</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>o_key_pad</span> <span class=o>+</span> <span class=n>inner_hash</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>final_hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>    ä½¿ç”¨ç»™å®šçš„å¯†é’¥å’Œæ¶ˆæ¯ç”Ÿæˆ HMAC
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>message_bytes</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hmac_hash</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message_bytes</span><span class=p>,</span> <span class=n>hash_func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>mac_to_verify</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    éªŒè¯æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰
</span></span></span><span class=line><span class=cl><span class=s2>    æ¯”è¾ƒç”Ÿæˆçš„ MAC å’Œæä¾›çš„ MAC æ˜¯å¦ç›¸åŒ
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>generated_mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>compare_digest</span><span class=p>(</span><span class=n>generated_mac</span><span class=p>,</span> <span class=n>mac_to_verify</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compare_digest</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;æ¯”è¾ƒä¸¤ä¸ªå“ˆå¸Œå€¼ï¼Œé˜²æ­¢æ—¶é—´æ”»å‡»&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>|=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨çš„å¯†é’¥</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;Qw3rTyQw3rTy&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç </span>
</span></span><span class=line><span class=cl><span class=n>mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ¶ˆæ¯: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç”Ÿæˆçš„MAC: </span><span class=si>{</span><span class=n>mac</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯æ¶ˆæ¯è®¤è¯ç </span>
</span></span><span class=line><span class=cl><span class=n>is_valid</span> <span class=o>=</span> <span class=n>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;MACéªŒè¯ç»“æœ: </span><span class=si>{</span><span class=s1>&#39;æœ‰æ•ˆ&#39;</span> <span class=k>if</span> <span class=n>is_valid</span> <span class=k>else</span> <span class=s1>&#39;æ— æ•ˆ&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¨¡æ‹Ÿç¯¡æ”¹æ¶ˆæ¯åçš„MACéªŒè¯</span>
</span></span><span class=line><span class=cl><span class=n>tampered_message</span> <span class=o>=</span> <span class=s2>&#34;26221013_D@a1han9_W0ng&#34;</span>
</span></span><span class=line><span class=cl><span class=n>tampered_mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>)</span> <span class=c1># ç¯¡æ”¹åçš„æ¶ˆæ¯çš„MAC</span>
</span></span><span class=line><span class=cl><span class=n>is_valid_tampered</span> <span class=o>=</span> <span class=n>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>,</span> <span class=n>mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç¯¡æ”¹åçš„æ¶ˆæ¯ ä¸ åŸæ¶ˆæ¯çš„MAC éªŒè¯çš„ç»“æœ: </span><span class=si>{</span><span class=s1>&#39;æœ‰æ•ˆ&#39;</span> <span class=k>if</span> <span class=n>is_valid_tampered</span> <span class=k>else</span> <span class=s1>&#39;æ— æ•ˆ&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=rsaæ•°å­—ç­¾åç®—æ³•>RSAæ•°å­—ç­¾åç®—æ³•<a hidden class=anchor aria-hidden=true href=#rsaæ•°å­—ç­¾åç®—æ³•>#</a></h3><ol><li>ç¼–å†™RSAç­¾åç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ï¼‰</li><li>åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œç­¾åï¼›å¹¶åœ¨æ¥æ”¶æ–¹è¿›è¡ŒéªŒè¯</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  3-2_Certification_RSA</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RSAæ•°å­—ç­¾åç®—æ³•ï¼ˆåˆ©ç”¨å¯†ç åº“ä¸­çš„Hashç®—æ³•ï¼‰</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.asymmetric</span> <span class=kn>import</span> <span class=n>rsa</span><span class=p>,</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>hashes</span><span class=p>,</span> <span class=n>serialization</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_rsa_key_pair</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>generate_private_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>public_exponent</span><span class=o>=</span><span class=mi>65537</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>private_key</span><span class=p>,</span> <span class=n>public_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sign_message</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>private_key</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>mgf</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>MGF1</span><span class=p>(</span><span class=n>hash_algorithm</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>salt_length</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=o>.</span><span class=n>MAX_LENGTH</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_algorithm</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>signature</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>public_key</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>signature</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>mgf</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>MGF1</span><span class=p>(</span><span class=n>hash_algorithm</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>salt_length</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=o>.</span><span class=n>MAX_LENGTH</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>hash_algorithm</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆå¯†é’¥å¯¹</span>
</span></span><span class=line><span class=cl><span class=n>private_key</span><span class=p>,</span> <span class=n>public_key</span> <span class=o>=</span> <span class=n>generate_rsa_key_pair</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•</span>
</span></span><span class=line><span class=cl><span class=n>hash_algorithm</span> <span class=o>=</span> <span class=n>hashes</span><span class=o>.</span><span class=n>SHA256</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆç­¾å</span>
</span></span><span class=line><span class=cl><span class=n>signature</span> <span class=o>=</span> <span class=n>sign_message</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;æ¶ˆæ¯: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç­¾å: </span><span class=si>{</span><span class=n>signature</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># éªŒè¯ç­¾å</span>
</span></span><span class=line><span class=cl><span class=n>is_valid</span> <span class=o>=</span> <span class=n>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç­¾åéªŒè¯ç»“æœ: </span><span class=si>{</span><span class=s1>&#39;æœ‰æ•ˆ&#39;</span> <span class=k>if</span> <span class=n>is_valid</span> <span class=k>else</span> <span class=s1>&#39;æ— æ•ˆ&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¨¡æ‹Ÿç¯¡æ”¹æ¶ˆæ¯åçš„ç­¾åéªŒè¯</span>
</span></span><span class=line><span class=cl><span class=n>tampered_message</span> <span class=o>=</span> <span class=s2>&#34;26221013_D@a1han9_W0ng&#34;</span>
</span></span><span class=line><span class=cl><span class=n>is_valid_tampered</span> <span class=o>=</span> <span class=n>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;ç¯¡æ”¹åæ¶ˆæ¯çš„ç­¾åéªŒè¯ç»“æœ: </span><span class=si>{</span><span class=s1>&#39;æœ‰æ•ˆ&#39;</span> <span class=k>if</span> <span class=n>is_valid_tampered</span> <span class=k>else</span> <span class=s1>&#39;æ— æ•ˆ&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=elgamalæ•°å­—ç­¾åç®—æ³•>ElGamalæ•°å­—ç­¾åç®—æ³•<a hidden class=anchor aria-hidden=true href=#elgamalæ•°å­—ç­¾åç®—æ³•>#</a></h3><ol><li>ç¼–å†™ElGamalç­¾åç®—æ³•ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ï¼‰</li><li>åˆ©ç”¨æ­¤ç®—æ³•å¯¹æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰è¿›è¡Œç­¾åï¼›å¹¶åœ¨æ¥æ”¶æ–¹è¿›è¡ŒéªŒè¯</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  3-3_Certification_ElGamal</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>gcd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>mod_inverse</span><span class=p>,</span> <span class=n>randprime</span><span class=p>,</span> <span class=n>isprime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¡®ä¿ç”Ÿæˆå…ƒæ˜¯æ¨¡pçš„ä¸€ä¸ªåŸæ ¹</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_primitive_root</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    æ‰¾åˆ°æ¨¡ p çš„ä¸€ä¸ªåŸæ ¹ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    p -- æ¨¡æ•°ï¼Œåº”ä¸ºç´ æ•°
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    g -- æ¨¡ p çš„ä¸€ä¸ªåŸæ ¹
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>isprime</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;p must be a prime number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>phi</span> <span class=o>=</span> <span class=n>p</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>prime_factors</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>phi</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>*</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>prime_factors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>n</span> <span class=o>//=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>n</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>prime_factors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>g</span><span class=p>,</span> <span class=n>phi</span> <span class=o>//</span> <span class=n>factor</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>factor</span> <span class=ow>in</span> <span class=n>prime_factors</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ElGamalç­¾åç®—æ³•ç±»</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ElGamalSignature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>p</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>g</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>bits</span><span class=o>=</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        åˆå§‹åŒ– ElGamal ç­¾åç®—æ³•å¯¹è±¡ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        p -- å¤§ç´ æ•°ï¼Œæ¨¡æ•°
</span></span></span><span class=line><span class=cl><span class=s2>        g -- æ¨¡ p çš„åŸæ ¹
</span></span></span><span class=line><span class=cl><span class=s2>        x -- ç§é’¥
</span></span></span><span class=line><span class=cl><span class=s2>        bits -- ç´ æ•° p çš„ä½æ•°ï¼Œé»˜è®¤ä¸º 256
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        å¦‚æœæœªæä¾› pã€gã€xï¼Œåˆ™éšæœºç”Ÿæˆã€‚
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>g</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>randprime</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=n>bits</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>2</span> <span class=o>**</span> <span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>find_primitive_root</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç­¾åå‡½æ•°</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        message -- è¦ç­¾åçš„æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        è¿”å›ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        (r, s) -- ç­¾åç»“æœ
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>h_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>k</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>gcd</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>  <span class=c1># ç¡®ä¿ k å’Œ p-1 äº’è´¨</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>k_inv</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>h_int</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>r</span><span class=p>)</span> <span class=o>*</span> <span class=n>k_inv</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># éªŒè¯å‡½æ•°</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>verify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        éªŒè¯æ¶ˆæ¯çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        message -- åŸå§‹æ¶ˆæ¯
</span></span></span><span class=line><span class=cl><span class=s2>        signature -- ç­¾åå…ƒç»„ (r, s)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        è¿”å›ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>        valid -- ç­¾åæ˜¯å¦æœ‰æ•ˆï¼ŒTrue æˆ– False
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>signature</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>  <span class=c1># æ£€æŸ¥ r å’Œ s çš„èŒƒå›´</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>h_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>h_int</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>v1</span> <span class=o>==</span> <span class=n>v2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æµ‹è¯•ä»£ç </span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># å¤§ç´ æ•°å’Œç”Ÿæˆå…ƒ</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>97380703184954711490740892696023412334547368592870793188226395165275008037663</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=mi>2</span>  <span class=c1># ä½¿ç”¨find_primitive_rootæ‰¾å‡ºçš„åŸæ ¹ï¼Œè‹¥å·²çŸ¥åˆ™ç›´æ¥èµ‹å€¼</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>123456789</span>  <span class=c1># ç§é’¥</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åˆå§‹åŒ–ElGamalç­¾åå¯¹è±¡</span>
</span></span><span class=line><span class=cl>    <span class=n>elgamal</span> <span class=o>=</span> <span class=n>ElGamalSignature</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç­¾å</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç­¾åï¼š&#34;</span><span class=p>,</span> <span class=n>signature</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># éªŒè¯</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>student_info</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç­¾åæœ‰æ•ˆ&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;ç­¾åæ— æ•ˆ&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=å®éªŒå››å¯†é’¥ç®¡ç†>å®éªŒå››ï¼šå¯†é’¥ç®¡ç†<a hidden class=anchor aria-hidden=true href=#å®éªŒå››å¯†é’¥ç®¡ç†>#</a></h2><h3 id=dhå¯†é’¥äº¤æ¢åè®®>DHå¯†é’¥äº¤æ¢åè®®<a hidden class=anchor aria-hidden=true href=#dhå¯†é’¥äº¤æ¢åè®®>#</a></h3><ol><li>DHå¯†é’¥äº¤æ¢åè®®ï¼ˆåŒ…å«å¯†é’¥ç”Ÿæˆã€åŠ å¯†å’Œè§£å¯†ï¼‰</li><li>åŒæ–¹åˆ©ç”¨æ­¤åè®®ç”Ÿæˆçš„å¯†é’¥ï¼Œç»“åˆå·²ç¼–å†™çš„AESç®—æ³•æ¥åŠ å¯†æ¶ˆæ¯ï¼ˆå­¦å·+å§“åï¼‰ï¼Œå¾—å¯†æ–‡ï¼›è§£å¯†å¯†æ–‡ï¼Œæ£€éªŒèƒ½å¦æ­£ç¡®è§£å¯†</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  4-1_Key_Management_DH</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>serialization</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.asymmetric</span> <span class=kn>import</span> <span class=n>x25519</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.kdf.hkdf</span> <span class=kn>import</span> <span class=n>HKDF</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>hashes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.backends</span> <span class=kn>import</span> <span class=n>default_backend</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.ciphers</span> <span class=kn>import</span> <span class=n>Cipher</span><span class=p>,</span> <span class=n>algorithms</span><span class=p>,</span> <span class=n>modes</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‡½æ•°ï¼šæ‰§è¡ŒDiffie-Hellmanå¯†é’¥äº¤æ¢</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>diffie_hellman</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># ç”ŸæˆAliceçš„ç§é’¥å’Œå…¬é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_private_key</span> <span class=o>=</span> <span class=n>x25519</span><span class=o>.</span><span class=n>X25519PrivateKey</span><span class=o>.</span><span class=n>generate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_public_key</span> <span class=o>=</span> <span class=n>alice_private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç”ŸæˆBobçš„ç§é’¥å’Œå…¬é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_private_key</span> <span class=o>=</span> <span class=n>x25519</span><span class=o>.</span><span class=n>X25519PrivateKey</span><span class=o>.</span><span class=n>generate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_public_key</span> <span class=o>=</span> <span class=n>bob_private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Aliceè®¡ç®—å…±äº«å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_shared_key</span> <span class=o>=</span> <span class=n>alice_private_key</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span><span class=n>bob_public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Bobè®¡ç®—å…±äº«å¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_shared_key</span> <span class=o>=</span> <span class=n>bob_private_key</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span><span class=n>alice_public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ç¡®ä¿åŒæ–¹è®¡ç®—å¾—åˆ°çš„å…±äº«å¯†é’¥ç›¸åŒ</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>alice_shared_key</span> <span class=o>==</span> <span class=n>bob_shared_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>alice_shared_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‡½æ•°ï¼šä½¿ç”¨AESåŠ å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span> <span class=o>=</span> <span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>  <span class=c1># ç”ŸæˆéšæœºIV</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>modes</span><span class=o>.</span><span class=n>CFB</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>backend</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>+</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å‡½æ•°ï¼šä½¿ç”¨AESè§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_message</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span> <span class=o>=</span> <span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>modes</span><span class=o>.</span><span class=n>CFB</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>backend</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>+</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸»å‡½æ•°ï¼šæ¼”ç¤ºè¿‡ç¨‹</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># æ‰§è¡ŒDiffie-Hellmanå¯†é’¥äº¤æ¢</span>
</span></span><span class=line><span class=cl>    <span class=n>shared_key</span> <span class=o>=</span> <span class=n>diffie_hellman</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;å…±äº«å¯†é’¥ (Hex): </span><span class=si>{</span><span class=n>shared_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨HKDFä»å…±äº«å¯†é’¥æ´¾ç”ŸAESå¯†é’¥</span>
</span></span><span class=line><span class=cl>    <span class=n>derived_key</span> <span class=o>=</span> <span class=n>HKDF</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>algorithm</span><span class=o>=</span><span class=n>hashes</span><span class=o>.</span><span class=n>SHA256</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>length</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>  <span class=c1># 256ä½å¯†é’¥é•¿åº¦</span>
</span></span><span class=line><span class=cl>        <span class=n>salt</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;Qw3rTyQw3rTyQw3rTy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>derive</span><span class=p>(</span><span class=n>shared_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åŠ å¯†å’Œè§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŸå§‹æ¶ˆæ¯: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># åŠ å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>derived_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;åŠ å¯†åçš„æ¶ˆæ¯ (Hex): </span><span class=si>{</span><span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># è§£å¯†æ¶ˆæ¯</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>decrypt_message</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>derived_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;è§£å¯†åçš„æ¶ˆæ¯: </span><span class=si>{</span><span class=n>decrypted_message</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ>Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ<a hidden class=anchor aria-hidden=true href=#shamirç§˜å¯†å…±äº«æ–¹æ¡ˆ>#</a></h3><ol><li>ç¼–å†™ä¸€ä¸ª(n, t) Shamirç§˜å¯†å…±äº«æ–¹æ¡ˆï¼ˆåŒ…å«ç§˜å¯†çš„åˆ†ç‰‡å’ŒåŸºäºLagrangeæ’å€¼æ–¹æ³•æ¢å¤ç§˜å¯†ï¼‰</li><li>å®ä¾‹åŒ–(n, t) =(5, 3)ï¼Œè€Œç§˜å¯†ä¿¡æ¯ä¸ºä½ çš„â€œå­¦å·+å§“åâ€ï¼Œæ¼”ç¤ºç§˜å¯†åˆ†ç‰‡å’Œæ¢å¤ç§˜å¯†çš„è¿‡ç¨‹ã€‚</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>â–º</span> <strong>ä»£ç  4-2_Key_Management_Shamir</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>nextprime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_shares</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>prime</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ä½¿ç”¨Shamirçš„ç§˜å¯†å…±äº«æ–¹æ¡ˆç”Ÿæˆnä¸ªåˆ†äº«ï¼Œé˜ˆå€¼ä¸ºtã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    - secret: è¦å…±äº«çš„ç§˜å¯†ï¼ˆä»¥æ•°å€¼å½¢å¼ï¼‰ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    - n: è¦ç”Ÿæˆçš„åˆ†äº«æ€»æ•°ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    - t: æ¢å¤ç§˜å¯†æ‰€éœ€çš„åˆ†äº«é˜ˆå€¼ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    - prime: æœ‰é™åŸŸç´ æ•°ï¼Œç”¨äºè®¡ç®—ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    - ä¸€ä¸ªåŒ…å«åˆ†äº«çš„å…ƒç»„åˆ—è¡¨ (x, y)ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>coefficients</span> <span class=o>=</span> <span class=p>[</span><span class=n>secret</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=n>random</span><span class=o>.</span><span class=n>randrange</span><span class=p>(</span><span class=n>prime</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>t</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>polynomial</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>sum</span><span class=p>([</span><span class=n>coeff</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>coeff</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>coefficients</span><span class=p>)])</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>shares</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>polynomial</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shares</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>shares</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>recover_secret</span><span class=p>(</span><span class=n>shares</span><span class=p>,</span> <span class=n>prime</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    ä½¿ç”¨Shamirçš„ç§˜å¯†å…±äº«æ–¹æ¡ˆæ¢å¤ç§˜å¯†ï¼Œç»™å®šè¶³å¤Ÿæ•°é‡çš„åˆ†äº«ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    å‚æ•°ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    - shares: ä¸€ä¸ªåˆ†äº«çš„å…ƒç»„åˆ—è¡¨ (x, y)ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    - prime: æœ‰é™åŸŸç´ æ•°ï¼Œç”¨äºè®¡ç®—ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    è¿”å›ï¼š
</span></span></span><span class=line><span class=cl><span class=s2>    - æ¢å¤çš„ç§˜å¯†ï¼ˆä»¥æ•°å€¼å½¢å¼ï¼‰ã€‚
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>lagrange_interpolation</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>shares</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>shares</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>xi</span><span class=p>,</span> <span class=n>yi</span> <span class=o>=</span> <span class=n>shares</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>term</span> <span class=o>=</span> <span class=n>yi</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=n>j</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>xj</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>shares</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>term</span> <span class=o>=</span> <span class=n>term</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>xj</span><span class=p>)</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>xi</span> <span class=o>-</span> <span class=n>xj</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>            <span class=n>total</span> <span class=o>=</span> <span class=p>(</span><span class=n>total</span> <span class=o>+</span> <span class=n>term</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>total</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lagrange_interpolation</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>shares</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç¤ºä¾‹ï¼šä½¿ç”¨å­¦å·å’Œå§“åä½œä¸ºç§˜å¯†</span>
</span></span><span class=line><span class=cl><span class=n>secret</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl><span class=n>secret_numeric</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>secret</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>  <span class=c1># è½¬æ¢ä¸ºæ•°å€¼å½¢å¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># æ€»åˆ†äº«æ•°</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=mi>3</span>  <span class=c1># æ¢å¤ç§˜å¯†æ‰€éœ€çš„åˆ†äº«é˜ˆå€¼</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€‰æ‹©ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç´ æ•°ä½œä¸ºæœ‰é™åŸŸçš„æ¨¡æ•°</span>
</span></span><span class=line><span class=cl><span class=n>prime</span> <span class=o>=</span> <span class=n>nextprime</span><span class=p>(</span><span class=n>secret_numeric</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆåˆ†äº«</span>
</span></span><span class=line><span class=cl><span class=n>shares</span> <span class=o>=</span> <span class=n>generate_shares</span><span class=p>(</span><span class=n>secret_numeric</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;åˆ†äº«ï¼š&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>share</span> <span class=ow>in</span> <span class=n>shares</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>share</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é€‰æ‹©ä»»æ„ t ä¸ªåˆ†äº«æ¥æ¢å¤ç§˜å¯†</span>
</span></span><span class=line><span class=cl><span class=n>selected_shares</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>shares</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¢å¤ç§˜å¯†</span>
</span></span><span class=line><span class=cl><span class=n>recovered_numeric</span> <span class=o>=</span> <span class=n>recover_secret</span><span class=p>(</span><span class=n>selected_shares</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å°†æ•°å€¼å½¢å¼çš„ç§˜å¯†è½¬æ¢ä¸ºå­—èŠ‚æ•°æ®</span>
</span></span><span class=line><span class=cl><span class=n>recovered_secret_bytes</span> <span class=o>=</span> <span class=n>recovered_numeric</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>recovered_numeric</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ¯”è¾ƒæ¢å¤çš„ç§˜å¯†ä¸åŸå§‹ç§˜å¯†</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>recovered_secret_bytes</span> <span class=o>==</span> <span class=n>secret</span><span class=o>.</span><span class=n>encode</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æˆåŠŸæ¢å¤ç§˜å¯†ï¼š&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>æ¢å¤çš„ç§˜å¯†ä¸åŸå§‹ç§˜å¯†ä¸åŒ¹é…&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/docs/short-code/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Short Code Hugo çŸ­ä»£ç </span>
</a><a class=next href=http://localhost:1313/docs/license-app/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>License App</span></a></nav></footer></article></main><footer class=footer><span>Â© <a href=https://wdh.hk>Daaihang Wong</a> <a href="https://icp.gov.moe/?keyword=20252019">èŒICPå¤‡20252019å·</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/sherlcok314159/MyPaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.min.js",function(){pangu.spacingPage()})</script><script>(function(){var e,t,n,s=document.getElementsByTagName("code");for(n=0;n<s.length;){if(t=s[n],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(e=t.textContent,/^\$[^$]/.test(e)&&/[^$]\$$/.test(e)&&(e=e.replace(/^\$/,"\\(").replace(/\$$/,"\\)"),t.textContent=e),/^\\\((.|\s)+\\\)$/.test(e)||/^\\\[(.|\s)+\\\]$/.test(e)||/^\$(.|\s)+\$$/.test(e)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(e))){t.outerHTML=t.innerHTML;continue}n++}})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function s(){t.innerHTML="Done",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>