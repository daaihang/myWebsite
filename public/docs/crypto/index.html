<!doctype html><html lang=zh dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>信息安全密码学基础 - 实验代码 | Daaihang's Blog</title>
<meta name=keywords content><meta name=description content="
造福下一届，人人有责。
所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**
实验时间：2024年上半年
文中所用第三方库使用 pip 自行安装。"><meta name=author content><link rel=canonical href=http://localhost:1313/docs/crypto/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=http://localhost:1313/docs/crypto/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/docs/crypto/"><meta property="og:site_name" content="Daaihang's Blog"><meta property="og:title" content="信息安全密码学基础 - 实验代码"><meta property="og:description" content=" 造福下一届，人人有责。
所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**
实验时间：2024年上半年
文中所用第三方库使用 pip 自行安装。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2024-06-21T18:54:10+08:00"><meta property="article:modified_time" content="2024-06-21T18:54:10+08:00"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="信息安全密码学基础 - 实验代码"><meta name=twitter:description content="
造福下一届，人人有责。
所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**
实验时间：2024年上半年
文中所用第三方库使用 pip 自行安装。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"开发","item":"http://localhost:1313/docs/"},{"@type":"ListItem","position":2,"name":"信息安全密码学基础 - 实验代码","item":"http://localhost:1313/docs/crypto/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"信息安全密码学基础 - 实验代码","name":"信息安全密码学基础 - 实验代码","description":" 造福下一届，人人有责。\n所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**\n实验时间：2024年上半年\n文中所用第三方库使用 pip 自行安装。\n","keywords":[],"articleBody":" 造福下一届，人人有责。\n所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**\n实验时间：2024年上半年\n文中所用第三方库使用 pip 自行安装。\n另外还有👉信息安全密码学基础 - 实验原理，这里有各个实验的实验原理。\n免责声明：实验代码仅供参考，请自行设计实现。\n实验一 对称加密 古典密码Hill密码 随机生成一个2×2和一个3×3的可逆的密钥矩阵，矩阵元素取自Z26。\n求这两个矩阵的逆矩阵 分别用这两个密钥矩阵加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？ ► 代码 1-1_Symmetric_Hill\rimport numpy as np from sympy import Matrix # 定义可见 ASCII 字符的范围 MIN_ASCII = 32 MAX_ASCII = 126 Z = MAX_ASCII - MIN_ASCII + 1 # 字符集大小 # 生成一个随机的 n x n 可逆矩阵，元素取自 Z def generate_invertible_matrix(n): while True: matrix = np.random.randint(0, Z, size=(n, n)) # 检查矩阵行列式与 Z 是否互质，只有互质时矩阵才是可逆的 if np.gcd(int(round(np.linalg.det(matrix))), Z) == 1: return matrix # 计算矩阵在模 Z 下的逆矩阵 def modular_inverse(matrix, mod): mat = Matrix(matrix) # 使用 sympy 库计算矩阵的模逆 inv_mat = mat.inv_mod(mod) return np.array(inv_mat).astype(int) # 生成 2x2 和 3x3 可逆矩阵 matrix_2x2 = generate_invertible_matrix(2) matrix_3x3 = generate_invertible_matrix(3) # 计算矩阵的逆矩阵 inverse_2x2 = modular_inverse(matrix_2x2, Z) inverse_3x3 = modular_inverse(matrix_3x3, Z) # 将文本转换为数字列表 def text_to_numbers(text): # 将字符的 ASCII 码减去 MIN_ASCII return [ord(char) - MIN_ASCII for char in text] # 将数字列表转换为文本 def numbers_to_text(numbers): # 将数字加上 MIN_ASCII 转换回字符 return ''.join(chr(num + MIN_ASCII) for num in numbers) # Hill 加密函数 def hill_encrypt(message, key_matrix): n = key_matrix.shape[0] message_numbers = text_to_numbers(message) while len(message_numbers) % n != 0: message_numbers.append(0) # 使用最小的可见 ASCII 字符进行填充 encrypted_numbers = [] for i in range(0, len(message_numbers), n): block = np.array(message_numbers[i:i + n]) # 矩阵乘法并取模 Z encrypted_block = np.dot(key_matrix, block) % Z encrypted_numbers.extend(encrypted_block) return numbers_to_text(encrypted_numbers) # Hill 解密函数 def hill_decrypt(encrypted_message, inverse_key_matrix): n = inverse_key_matrix.shape[0] encrypted_numbers = text_to_numbers(encrypted_message) decrypted_numbers = [] for i in range(0, len(encrypted_numbers), n): block = np.array(encrypted_numbers[i:i + n]) # 使用逆矩阵进行矩阵乘法并取模 Z decrypted_block = np.dot(inverse_key_matrix, block) % Z decrypted_numbers.extend(decrypted_block) return numbers_to_text(decrypted_numbers).rstrip(chr(0)) # 移除填充 # 实验 ①: 打印生成的矩阵及其逆矩阵 print(\"实验 ①: 生成的矩阵及其逆矩阵\") print(\"2x2 矩阵:\") print(matrix_2x2) print(\"2x2 逆矩阵:\") print(inverse_2x2) print(\"\\n3x3 矩阵:\") print(matrix_3x3) print(\"3x3 逆矩阵:\") print(inverse_3x3) # 实验 ②: 加密和解密消息 message = \"26221013_Daaihang_Wong\" # 仅保留消息中的可见字符 filtered_message = ''.join(filter(lambda x: MIN_ASCII \u003c= ord(x) \u003c= MAX_ASCII, message)) encrypted_message_2x2 = hill_encrypt(filtered_message, matrix_2x2) decrypted_message_2x2 = hill_decrypt(encrypted_message_2x2, inverse_2x2) encrypted_message_3x3 = hill_encrypt(filtered_message, matrix_3x3) decrypted_message_3x3 = hill_decrypt(encrypted_message_3x3, inverse_3x3) # 输出结果 print(\"\\n实验 ②: 加密和解密结果\") print(\"原始消息:\", filtered_message) print(\"\\n使用 2x2 矩阵\") print(\"加密消息:\", encrypted_message_2x2) print(\"解密消息:\", decrypted_message_2x2) print(\"\\n使用 3x3 矩阵\") print(\"加密消息:\", encrypted_message_3x3) print(\"解密消息:\", decrypted_message_3x3) 置换密码 随机生成一个置换表（置换表长度可设置）\n求逆置换 用此置换表加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？ ► 代码 1-2_Symmetric_Permutation\rimport random # 定义可见 ASCII 字符的范围 MIN_ASCII = 32 MAX_ASCII = 126 CHARS = [chr(i) for i in range(MIN_ASCII, MAX_ASCII + 1)] LENGTH = len(CHARS) # 生成随机置换表 def generate_permutation_table(length): table = CHARS[:length] random.shuffle(table) # 随机打乱字符列表，形成置换表 return table # 生成逆置换表 def generate_inverse_permutation_table(table): inverse_table = [''] * len(table) for i, char in enumerate(table): inverse_table[CHARS.index(char)] = CHARS[i] # 找到字符在原字符集中的位置，并在逆置换表中记录相应的原字符 return inverse_table # 置换加密函数 def permutation_encrypt(message, table): # 用置换表替换消息中的每个字符 return ''.join(table[CHARS.index(char)] if char in CHARS else char for char in message) # 置换解密函数 def permutation_decrypt(encrypted_message, inverse_table): # 用逆置换表还原消息中的每个字符 return ''.join(inverse_table[CHARS.index(char)] if char in CHARS else char for char in encrypted_message) # 实验 ①: 打印生成的置换表及其逆置换表 table = generate_permutation_table(LENGTH) inverse_table = generate_inverse_permutation_table(table) print(\"实验 ①: 生成的置换表及其逆置换表\") print(\"置换表:\", ''.join(table)) print(\"逆置换表:\", ''.join(inverse_table)) # 实验 ②: 加密和解密消息 message = \"26221013_Daaihang_Wong\" encrypted_message = permutation_encrypt(message, table) decrypted_message = permutation_decrypt(encrypted_message, inverse_table) # 输出结果 print(\"\\n实验 ②: 加密和解密结果\") print(\"原始消息:\", message) print(\"加密消息:\", encrypted_message) print(\"解密消息:\", decrypted_message) 对称加密算法AES和工作模式 编写AES加密和解密算法 分别结合CBC和OFB工作模式，加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？ 我给出了4种方式实现。优先使用第4个。其他的或多或少使用第三方的非基础密码库，可能不符合实验要求。\n► 代码 - 实现一 1-3_Symmetric_AES_1\rfrom cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes from cryptography.hazmat.primitives import padding from cryptography.hazmat.backends import default_backend import os # 生成随机密钥和初始化向量（IV） def generate_key_iv(key_size): key = os.urandom(key_size // 8) iv = os.urandom(16) # IV 大小应为块大小（16 字节） return key, iv # AES 加密函数 def aes_encrypt(message, key, iv, mode): # PKCS7填充 padder = padding.PKCS7(algorithms.AES.block_size).padder() padded_data = padder.update(message.encode()) + padder.finalize() # 创建AES加密器 cipher = Cipher(algorithms.AES(key), mode(iv), backend=default_backend()) encryptor = cipher.encryptor() # 加密数据 ciphertext = encryptor.update(padded_data) + encryptor.finalize() return ciphertext # AES 解密函数 def aes_decrypt(ciphertext, key, iv, mode): # 创建AES解密器 cipher = Cipher(algorithms.AES(key), mode(iv), backend=default_backend()) decryptor = cipher.decryptor() # 解密数据 padded_data = decryptor.update(ciphertext) + decryptor.finalize() # 去除PKCS7填充 unpadder = padding.PKCS7(algorithms.AES.block_size).unpadder() decrypted_data = unpadder.update(padded_data) + unpadder.finalize() return decrypted_data.decode() # 主函数 def main(): # 设置密钥长度（128, 192, 或 256 位） key_size = 256 # 生成密钥和 IV key, iv = generate_key_iv(key_size) # 打印密钥和 IV print(\"实验 ①: 密钥和 IV\") print(\"密钥:\", key.hex()) print(\"IV:\", iv.hex()) # 定义消息 message = \"26221013_Daaihang_Wong\" # 实验 ②: CBC 模式加密和解密 print(\"\\n实验 ②: CBC 模式\") ciphertext_cbc = aes_encrypt(message, key, iv, modes.CBC) print(\"CBC 加密消息:\", ciphertext_cbc.hex()) decrypted_message_cbc = aes_decrypt(ciphertext_cbc, key, iv, modes.CBC) print(\"CBC 解密消息:\", decrypted_message_cbc) # 实验 ②: OFB 模式加密和解密 print(\"\\n实验 ②: OFB 模式\") ciphertext_ofb = aes_encrypt(message, key, iv, modes.OFB) print(\"OFB 加密消息:\", ciphertext_ofb.hex()) decrypted_message_ofb = aes_decrypt(ciphertext_ofb, key, iv, modes.OFB) print(\"OFB 解密消息:\", decrypted_message_ofb) # 运行主函数 if __name__ == \"__main__\": main() ► 代码 - 实现二 1-3_Symmetric_AES_2\rimport os from pyaes import pyaes def pad(data): padding_needed = 16 - len(data) % 16 return data + chr(padding_needed) * padding_needed def split_blocks(data, block_size=16): return [data[i:i + block_size] for i in range(0, len(data), block_size)] def encrypt_cbc(key, iv, data): aes = pyaes.AESModeOfOperationCBC(key, iv=iv) padded_data = pad(data) blocks = split_blocks(padded_data) ciphertext = b''.join(aes.encrypt(block) for block in blocks) return ciphertext def unpad(data): padding = ord(data[-1]) return data[:-padding] def decrypt_cbc(key, iv, ciphertext): aes = pyaes.AESModeOfOperationCBC(key, iv=iv) blocks = split_blocks(ciphertext) plaintext = ''.join(aes.decrypt(block).decode('utf-8') for block in blocks) return unpad(plaintext) def encrypt_ofb(key, iv, data): aes = pyaes.AESModeOfOperationOFB(key, iv=iv) return aes.encrypt(data) def decrypt_ofb(key, iv, ciphertext): aes = pyaes.AESModeOfOperationOFB(key, iv=iv) return aes.decrypt(ciphertext).decode() def main(): key = os.urandom(32) iv = os.urandom(16) print(repr(iv)) # Using CBC mode plaintext_cbc = \"26221013_Daaihang_Wong\" ciphertext_cbc = encrypt_cbc(key, iv, plaintext_cbc) print(repr(ciphertext_cbc)) decrypted_cbc = decrypt_cbc(key, iv, ciphertext_cbc) print(decrypted_cbc) print(decrypted_cbc == plaintext_cbc) # Using OFB mode plaintext_ofb = \"26221013_Daaihang_Wong\" ciphertext_ofb = encrypt_ofb(key, iv, plaintext_ofb) print(repr(ciphertext_ofb)) decrypted_ofb = decrypt_ofb(key, iv, ciphertext_ofb) print(decrypted_ofb) print(decrypted_ofb == plaintext_ofb) if __name__ == \"__main__\": main() ► 代码 - 实现三 1-3_Symmetric_AES_3\r# 一个简单的 AES-128-ECB，其中 128 指采用 128 位密钥块， # ECB 模式，为长度不足 128 位的数据块填充 0x00。 s_box = [ [0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76], [0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0], [0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15], [0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75], [0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84], [0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf], [0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8], [0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2], [0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73], [0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb], [0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79], [0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08], [0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a], [0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e], [0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf], [0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16] ] s_box_inv = [ [0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb], [0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb], [0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e], [0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25], [0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92], [0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84], [0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06], [0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b], [0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73], [0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e], [0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b], [0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4], [0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f], [0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef], [0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61], [0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d] ] rc = [0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1b, 0x36, 0x6c, 0xd8, 0xab, 0x4d] def sub_bytes(grid, inv=False): for i, v in enumerate(grid): if inv: # for decryption grid[i] = s_box_inv[v \u003e\u003e 4][v \u0026 0xf] else: grid[i] = s_box[v \u003e\u003e 4][v \u0026 0xf] def shift_rows(grid, inv=False): for i in range(4): if inv: # for decryption grid[i::4] = grid[i::4][-i:] + grid[i::4][:-i] else: grid[i::4] = grid[i::4][i:] + grid[i::4][:i] def mix_columns(grid): def mul_by_2(n): s = (n \u003c\u003c 1) \u0026 0xff if n \u0026 128: s ^= 0x1b return s def mul_by_3(n): return n ^ mul_by_2(n) def mix_column(c): return [ mul_by_2(c[0]) ^ mul_by_3(c[1]) ^ c[2] ^ c[3], # [2 3 1 1] c[0] ^ mul_by_2(c[1]) ^ mul_by_3(c[2]) ^ c[3], # [1 2 3 1] c[0] ^ c[1] ^ mul_by_2(c[2]) ^ mul_by_3(c[3]), # [1 1 2 3] mul_by_3(c[0]) ^ c[1] ^ c[2] ^ mul_by_2(c[3]), # [3 1 1 2] ] for i in range(0, 16, 4): grid[i:i + 4] = mix_column(grid[i:i + 4]) def key_expansion(grid): for i in range(10 * 4): r = grid[-4:] if i % 4 == 0: # 对上一轮最后4字节自循环、S-box置换、轮常数异或，从而计算出当前新一轮最前4字节 for j, v in enumerate(r[1:] + r[:1]): r[j] = s_box[v \u003e\u003e 4][v \u0026 0xf] ^ (rc[i // 4] if j == 0 else 0) for j in range(4): grid.append(grid[-16] ^ r[j]) return grid def add_round_key(grid, round_key): for i in range(16): grid[i] ^= round_key[i] def encrypt(b, expanded_key): # First round add_round_key(b, expanded_key) for i in range(1, 10): sub_bytes(b) shift_rows(b) mix_columns(b) add_round_key(b, expanded_key[i * 16:]) # Final round sub_bytes(b) shift_rows(b) add_round_key(b, expanded_key[-16:]) return b def decrypt(b, expanded_key): # First round add_round_key(b, expanded_key[-16:]) for i in range(9, 0, -1): shift_rows(b, True) sub_bytes(b, True) add_round_key(b, expanded_key[i * 16:]) for _ in range(3): mix_columns(b) # Final round shift_rows(b, True) sub_bytes(b, True) add_round_key(b, expanded_key) return b def aes(typ, key, msg): expanded = key_expansion(bytearray(key)) # Pad the message to a multiple of 16 bytes b = bytearray(msg) if typ == 0: # only for encryption b = bytearray(msg + b'\\x00' * (16 - len(msg) % 16)) # Encrypt/decrypt the message for i in range(0, len(b), 16): if typ == 0: b[i:i + 16] = encrypt(b[i:i + 16], expanded) else: b[i:i + 16] = decrypt(b[i:i + 16], expanded) return bytes(b) if __name__ == '__main__': key = b\"Qw3rTyQw3rTyQw3r\" enc = aes(0, key, b'Daaihang_Wong_26221013') dec = aes(1, key, enc) print('加密：', enc) print('解密：', dec) ► 代码 - 实现四 1-3_Symmetric_AES_4（推荐参考）\rimport os # AES块大小 BLOCK_SIZE = 16 # 生成随机字节 def generate_random_bytes(length): return os.urandom(length) # 填充函数：PKCS#7 def pad(data): pad_length = BLOCK_SIZE - len(data) % BLOCK_SIZE return data + bytes([pad_length] * pad_length) # 去填充函数：PKCS#7 def unpad(data): pad_length = data[-1] return data[:-pad_length] # 定义S盒和逆S盒 s_box = [ 0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5, 0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76, 0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0, 0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0, 0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc, 0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15, 0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a, 0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75, 0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0, 0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84, 0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b, 0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf, 0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85, 0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8, 0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5, 0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2, 0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17, 0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73, 0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88, 0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb, 0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c, 0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79, 0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9, 0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08, 0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6, 0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a, 0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e, 0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e, 0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94, 0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf, 0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68, 0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16, ] inv_s_box = [ 0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38, 0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb, 0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87, 0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb, 0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d, 0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e, 0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2, 0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25, 0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16, 0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92, 0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda, 0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84, 0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a, 0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06, 0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02, 0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b, 0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea, 0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73, 0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85, 0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e, 0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89, 0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b, 0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20, 0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4, 0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31, 0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f, 0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d, 0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef, 0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0, 0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61, 0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26, 0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d, ] # 字节替换 def sub_bytes(state): return bytes(s_box[b] for b in state) # 字节替换的逆操作 def inv_sub_bytes(state): return bytes(inv_s_box[b] for b in state) # 行移位 def shift_rows(state): return bytes([ state[0], state[5], state[10], state[15], state[4], state[9], state[14], state[3], state[8], state[13], state[2], state[7], state[12], state[1], state[6], state[11], ]) # 行移位的逆操作 def inv_shift_rows(state): return bytes([ state[0], state[13], state[10], state[7], state[4], state[1], state[14], state[11], state[8], state[5], state[2], state[15], state[12], state[9], state[6], state[3], ]) # GF(2^8)中的乘法 def gmul(a, b): p = 0 for _ in range(8): if b \u0026 1: p ^= a hi_bit_set = a \u0026 0x80 a \u003c\u003c= 1 if hi_bit_set: a ^= 0x1b b \u003e\u003e= 1 return p \u0026 0xff # 列混合 def mix_columns(state): mixed = bytearray(16) for i in range(4): mixed[i * 4 + 0] = gmul(state[i * 4 + 0], 2) ^ gmul(state[i * 4 + 1], 3) ^ state[i * 4 + 2] ^ state[i * 4 + 3] mixed[i * 4 + 1] = state[i * 4 + 0] ^ gmul(state[i * 4 + 1], 2) ^ gmul(state[i * 4 + 2], 3) ^ state[i * 4 + 3] mixed[i * 4 + 2] = state[i * 4 + 0] ^ state[i * 4 + 1] ^ gmul(state[i * 4 + 2], 2) ^ gmul(state[i * 4 + 3], 3) mixed[i * 4 + 3] = gmul(state[i * 4 + 0], 3) ^ state[i * 4 + 1] ^ state[i * 4 + 2] ^ gmul(state[i * 4 + 3], 2) return bytes(mixed) # 列混合的逆操作 def inv_mix_columns(state): mixed = bytearray(16) for i in range(4): mixed[i * 4 + 0] = gmul(state[i * 4 + 0], 14) ^ gmul(state[i * 4 + 1], 11) ^ gmul(state[i * 4 + 2], 13) ^ gmul( state[i * 4 + 3], 9) mixed[i * 4 + 1] = gmul(state[i * 4 + 0], 9) ^ gmul(state[i * 4 + 1], 14) ^ gmul(state[i * 4 + 2], 11) ^ gmul( state[i * 4 + 3], 13) mixed[i * 4 + 2] = gmul(state[i * 4 + 0], 13) ^ gmul(state[i * 4 + 1], 9) ^ gmul(state[i * 4 + 2], 14) ^ gmul( state[i * 4 + 3], 11) mixed[i * 4 + 3] = gmul(state[i * 4 + 0], 11) ^ gmul(state[i * 4 + 1], 13) ^ gmul(state[i * 4 + 2], 9) ^ gmul( state[i * 4 + 3], 14) return bytes(mixed) # 轮密钥加 def add_round_key(state, round_key): return bytes(a ^ b for a, b in zip(state, round_key)) # AES块加密函数 def aes_encrypt_block(block, key): state = add_round_key(block, key) for _ in range(9): state = sub_bytes(state) state = shift_rows(state) state = mix_columns(state) state = add_round_key(state, key) state = sub_bytes(state) state = shift_rows(state) state = add_round_key(state, key) return state # AES块解密函数 def aes_decrypt_block(block, key): state = add_round_key(block, key) state = inv_shift_rows(state) state = inv_sub_bytes(state) for _ in range(9): state = add_round_key(state, key) state = inv_mix_columns(state) state = inv_shift_rows(state) state = inv_sub_bytes(state) state = add_round_key(state, key) return state # CBC模式加密 def aes_cbc_encrypt(key, plaintext): iv = generate_random_bytes(BLOCK_SIZE) # 生成随机初始化向量（IV） plaintext_padded = pad(plaintext.encode('utf-8')) ciphertext = iv previous_block = iv for i in range(0, len(plaintext_padded), BLOCK_SIZE): plaintext_block = plaintext_padded[i:i + BLOCK_SIZE] xor_block = bytes(a ^ b for a, b in zip(plaintext_block, previous_block)) encrypted_block = aes_encrypt_block(xor_block, key) ciphertext += encrypted_block previous_block = encrypted_block return ciphertext # CBC模式解密 def aes_cbc_decrypt(key, ciphertext): iv = ciphertext[:BLOCK_SIZE] actual_ciphertext = ciphertext[BLOCK_SIZE:] previous_block = iv plaintext_padded = b'' for i in range(0, len(actual_ciphertext), BLOCK_SIZE): ciphertext_block = actual_ciphertext[i:i + BLOCK_SIZE] decrypted_block = aes_decrypt_block(ciphertext_block, key) plaintext_block = bytes(a ^ b for a, b in zip(decrypted_block, previous_block)) plaintext_padded += plaintext_block previous_block = ciphertext_block plaintext = unpad(plaintext_padded) return plaintext.decode('utf-8') # OFB模式加密 def aes_ofb_encrypt(key, plaintext): iv = generate_random_bytes(BLOCK_SIZE) # 生成随机初始化向量（IV） plaintext_bytes = plaintext.encode('utf-8') ciphertext = iv previous_block = iv for i in range(0, len(plaintext_bytes), BLOCK_SIZE): block = plaintext_bytes[i:i + BLOCK_SIZE] encrypted_block = aes_encrypt_block(previous_block, key) cipher_block = bytes(a ^ b for a, b in zip(block, encrypted_block)) ciphertext += cipher_block previous_block = encrypted_block return ciphertext # OFB模式解密 def aes_ofb_decrypt(key, ciphertext): iv = ciphertext[:BLOCK_SIZE] actual_ciphertext = ciphertext[BLOCK_SIZE:] previous_block = iv plaintext_bytes = b'' for i in range(0, len(actual_ciphertext), BLOCK_SIZE): ciphertext_block = actual_ciphertext[i:i + BLOCK_SIZE] encrypted_block = aes_encrypt_block(previous_block, key) plaintext_block = bytes(a ^ b for a, b in zip(ciphertext_block, encrypted_block)) plaintext_bytes += plaintext_block previous_block = encrypted_block return plaintext_bytes.decode('utf-8') # 生成AES密钥 def generate_aes_key(): return generate_random_bytes(BLOCK_SIZE) def main(): message = \"26221013_Daaihang_Wong\" # 学号+姓名 print(f\"原始消息: {message}\") # 生成AES密钥 aes_key = generate_aes_key() # CBC模式 encrypted_message_cbc = aes_cbc_encrypt(aes_key, message) print(f\"CBC模式加密后的消息: {encrypted_message_cbc}\") decrypted_message_cbc = aes_cbc_decrypt(aes_key, encrypted_message_cbc) print(f\"CBC模式解密后的消息: {decrypted_message_cbc}\") # OFB模式 encrypted_message_ofb = aes_ofb_encrypt(aes_key, message) print(f\"OFB模式加密后的消息: {encrypted_message_ofb}\") decrypted_message_ofb = aes_ofb_decrypt(aes_key, encrypted_message_ofb) print(f\"OFB模式解密后的消息: {decrypted_message_ofb}\") # 检查解密后的消息是否正确 assert message == decrypted_message_cbc, \"CBC模式解密失败！\" assert message == decrypted_message_ofb, \"OFB模式解密失败！\" print(\"CBC和OFB模式解密成功！\") if __name__ == \"__main__\": main() 实验二 非对称加密 公钥加密算法RSA 编写RSA密码算法（包含密钥生成、加密和解密） 利用此算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密 ► 代码 2-1_Asymmetric_RSA\rimport random from sympy import isprime, mod_inverse class RSAEncryption: def __init__(self, key_size=2048): self.key_size = key_size self.public_key, self.private_key = self.generate_keys() def generate_prime(self, n_bits): \"\"\" 生成一个具有指定位数的素数 \"\"\" while True: num = random.getrandbits(n_bits) if isprime(num): return num def generate_keys(self): \"\"\" 生成RSA公钥和私钥 \"\"\" # 选择两个不同的大素数 p 和 q p = self.generate_prime(self.key_size // 2) q = self.generate_prime(self.key_size // 2) # 计算 n = p * q n = p * q # 计算 φ(n) = (p-1)(q-1)，其中φ(n)为n的欧拉函数 phi = (p - 1) * (q - 1) # 选择一个整数 e，使得 1 \u003c e \u003c φ(n) 并且 e 与 φ(n) 互质 e = 65537 # 常用的 e 值 # 计算 d 使得 d * e ≡ 1 (mod φ(n))，即 d 是 e 模 φ(n) 的乘法逆元 d = mod_inverse(e, phi) # 公钥: (e, n) # 私钥: (d, n) public_key = (e, n) private_key = (d, n) return public_key, private_key def encrypt(self, message): \"\"\" 使用公钥加密消息。将消息转换为整数 m，计算密文 c = m^e mod n。 \"\"\" e, n = self.public_key # 将消息转换为字节，再转换为整数 message_bytes = message.encode('utf-8') message_int = int.from_bytes(message_bytes, byteorder='big') # 使用公钥加密消息 encrypted_message_int = pow(message_int, e, n) return encrypted_message_int def decrypt(self, encrypted_message_int): \"\"\" 使用私钥解密消息。计算原文 m = c^d mod n，将整数 m 转换为字节，再转换为字符串。 \"\"\" d, n = self.private_key # 使用私钥解密消息 decrypted_message_int = pow(encrypted_message_int, d, n) # 将整数转换为字节，再转换为字符串 decrypted_message_bytes = decrypted_message_int.to_bytes((decrypted_message_int.bit_length() + 7) // 8, byteorder='big') return decrypted_message_bytes.decode('utf-8') # 实例化RSAEncryption类 rsa_encryption = RSAEncryption() # 定义要加密的消息 student_info = \"26221013_Daaihang_Wong\" # 加密消息 encrypted_message = rsa_encryption.encrypt(student_info) print(f\"加密消息：{encrypted_message}\") # 解密消息 decrypted_message = rsa_encryption.decrypt(encrypted_message) print(f\"解密消息：{decrypted_message}\") # 验证解密是否正确 if student_info == decrypted_message: print(\"解密成功，消息正确\") else: print(\"解密失败，消息不正确\") 公钥加密算法ElGamal 编写ElGamal加密算法（包含密钥生成、加密和解密过程） 利用此算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密 ► 代码 2-2_Asymmetric_ElGamal\rfrom sympy import mod_inverse, isprime, randprime from random import randint class ElGamal: def __init__(self, key_size=2048): self.key_size = key_size # 生成一个大素数 p self.p = self.generate_large_prime() # 生成一个随机整数 g，满足 2 \u003c= g \u003c= p-1 self.g = randint(2, self.p - 1) # 生成私钥 x，满足 1 \u003c= x \u003c= p-2 self.x = randint(1, self.p - 2) # 计算公钥 h = g^x mod p self.h = pow(self.g, self.x, self.p) def generate_large_prime(self): \"\"\"生成一个大素数\"\"\" while True: # 在指定范围内生成一个随机素数 prime_candidate = randprime(2 ** (self.key_size - 1), 2 ** self.key_size) if isprime(prime_candidate): return prime_candidate def encrypt(self, message): \"\"\" 使用公钥加密消息 步骤： 1. 生成一个随机整数 y，满足 1 \u003c= y \u003c= p-2 2. 计算 c1 = g^y mod p 3. 计算 s = h^y mod p 4. 将消息转换为整数 m 5. 计算 c2 = (m * s) mod p 返回密文对 (c1, c2) \"\"\" y = randint(1, self.p - 2) c1 = pow(self.g, y, self.p) s = pow(self.h, y, self.p) m = int.from_bytes(message.encode('utf-8'), 'big') c2 = (m * s) % self.p return c1, c2 def decrypt(self, ciphertext): \"\"\" 使用私钥解密消息 步骤： 1. 提取密文对 (c1, c2) 2. 计算 s = c1^x mod p 3. 计算 s 的乘法逆元 s_inv = s^-1 mod p 4. 计算 m = (c2 * s_inv) mod p 5. 将整数 m 转换为字节，再转换为字符串 \"\"\" c1, c2 = ciphertext s = pow(c1, self.x, self.p) s_inv = mod_inverse(s, self.p) m = (c2 * s_inv) % self.p message = m.to_bytes((m.bit_length() + 7) // 8, 'big').decode('utf-8') return message # 实例化ElGamal类 elgamal = ElGamal() # 定义要加密的消息 student_info = \"26221013_Daaihang_Wong\" # 加密消息 encrypted_message = elgamal.encrypt(student_info) print(f\"加密消息：{encrypted_message}\") # 解密消息 decrypted_message = elgamal.decrypt(encrypted_message) print(f\"解密消息：{decrypted_message}\") # 验证解密是否正确 if student_info == decrypted_message: print(\"解密成功，消息正确\") else: print(\"解密失败，消息不正确\") 混合加密（电子信封） 基于已编写的AES和RSA（或ElGamal）密码算法，实现混合加密 利用混合算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密 ► 代码\r# todo: 还没实现，先等着吧，太久了就在评论区滴滴我。 实验三 认证技术 注：过程中可以利用密码库中的Hash算法（如SHA2，SM3，SHA3等）\n消息认证码（MAC） 编写基于Hash算法的消息认证码 利用此算法对消息（学号+姓名）进行完整性和真实性认证 ► 代码 3-1_Certification_MAC\rimport hashlib def xor_bytes(a, b): \"\"\"对两个字节序列进行按位异或操作\"\"\" return bytes(x ^ y for x, y in zip(a, b)) def hmac_hash(key, message, hash_func=hashlib.sha256): \"\"\" 实现 HMAC 算法 1. 如果密钥长度大于哈希块大小，则对密钥进行哈希处理 2. 如果密钥长度小于哈希块大小，则在密钥末尾补零至块大小 3. 生成内层和外层填充密钥 4. 使用填充后的密钥和消息进行两次哈希计算 \"\"\" block_size = hash_func().block_size # 如果密钥长度大于块大小，则对密钥进行哈希处理 if len(key) \u003e block_size: key = hash_func(key).digest() # 如果密钥长度小于块大小，则在密钥末尾补零至块大小 if len(key) \u003c block_size: key = key.ljust(block_size, b'\\0') # 生成内层和外层填充密钥 o_key_pad = xor_bytes(key, b'\\x5c' * block_size) i_key_pad = xor_bytes(key, b'\\x36' * block_size) # 内层哈希 inner_hash = hash_func(i_key_pad + message).digest() # 外层哈希 final_hash = hash_func(o_key_pad + inner_hash).hexdigest() return final_hash def generate_mac(key, message, hash_func=hashlib.sha256): \"\"\" 生成消息认证码（MAC） 使用给定的密钥和消息生成 HMAC \"\"\" message_bytes = message.encode('utf-8') return hmac_hash(key, message_bytes, hash_func) def verify_mac(key, message, mac_to_verify, hash_func=hashlib.sha256): \"\"\" 验证消息认证码（MAC） 比较生成的 MAC 和提供的 MAC 是否相同 \"\"\" generated_mac = generate_mac(key, message, hash_func) return compare_digest(generated_mac, mac_to_verify) def compare_digest(a, b): \"\"\"比较两个哈希值，防止时间攻击\"\"\" if len(a) != len(b): return False result = 0 for x, y in zip(a, b): result |= ord(x) ^ ord(y) return result == 0 # 消息 message = \"26221013_Daaihang_Wong\" # 使用的密钥 key = b'Qw3rTyQw3rTy' # 生成消息认证码 mac = generate_mac(key, message) print(f\"消息: {message}\") print(f\"生成的MAC: {mac}\") # 验证消息认证码 is_valid = verify_mac(key, message, mac) print(f\"MAC验证结果: {'有效' if is_valid else '无效'}\") # 模拟篡改消息后的MAC验证 tampered_message = \"26221013_D@a1han9_W0ng\" tampered_mac = generate_mac(key, tampered_message) # 篡改后的消息的MAC is_valid_tampered = verify_mac(key, tampered_message, mac) print(f\"篡改后的消息 与 原消息的MAC 验证的结果: {'有效' if is_valid_tampered else '无效'}\") RSA数字签名算法 编写RSA签名算法（包含密钥生成、签名和验证过程） 利用此算法对消息（学号+姓名）进行签名；并在接收方进行验证 ► 代码 3-2_Certification_RSA\r# RSA数字签名算法（利用密码库中的Hash算法） from cryptography.hazmat.primitives.asymmetric import rsa, padding from cryptography.hazmat.primitives import hashes, serialization def generate_rsa_key_pair(): private_key = rsa.generate_private_key( public_exponent=65537, key_size=2048 ) public_key = private_key.public_key() return private_key, public_key def sign_message(private_key, message, hash_algorithm): signature = private_key.sign( message.encode(), padding.PSS( mgf=padding.MGF1(hash_algorithm), salt_length=padding.PSS.MAX_LENGTH ), hash_algorithm ) return signature def verify_signature(public_key, message, signature, hash_algorithm): try: public_key.verify( signature, message.encode(), padding.PSS( mgf=padding.MGF1(hash_algorithm), salt_length=padding.PSS.MAX_LENGTH ), hash_algorithm ) return True except Exception as e: return False # 生成密钥对 private_key, public_key = generate_rsa_key_pair() # 消息 message = \"26221013_Daaihang_Wong\" # 使用的哈希算法 hash_algorithm = hashes.SHA256() # 生成签名 signature = sign_message(private_key, message, hash_algorithm) print(f\"消息: {message}\") print(f\"签名: {signature.hex()}\") # 验证签名 is_valid = verify_signature(public_key, message, signature, hash_algorithm) print(f\"签名验证结果: {'有效' if is_valid else '无效'}\") # 模拟篡改消息后的签名验证 tampered_message = \"26221013_D@a1han9_W0ng\" is_valid_tampered = verify_signature(public_key, tampered_message, signature, hash_algorithm) print(f\"篡改后消息的签名验证结果: {'有效' if is_valid_tampered else '无效'}\") ElGamal数字签名算法 编写ElGamal签名算法（包含密钥生成、签名和验证过程） 利用此算法对消息（学号+姓名）进行签名；并在接收方进行验证 ► 代码 3-3_Certification_ElGamal\rimport hashlib import random from math import gcd from sympy import mod_inverse, randprime, isprime # 确保生成元是模p的一个原根 def find_primitive_root(p): \"\"\" 找到模 p 的一个原根。 参数： p -- 模数，应为素数 返回： g -- 模 p 的一个原根 \"\"\" if not isprime(p): raise ValueError(\"p must be a prime number\") phi = p - 1 prime_factors = set() n = phi i = 2 while i * i \u003c= n: if n % i == 0: prime_factors.add(i) while n % i == 0: n //= i i += 1 if n \u003e 1: prime_factors.add(n) for g in range(2, p): if all(pow(g, phi // factor, p) != 1 for factor in prime_factors): return g return None # ElGamal签名算法类 class ElGamalSignature: def __init__(self, p=None, g=None, x=None, bits=256): \"\"\" 初始化 ElGamal 签名算法对象。 参数： p -- 大素数，模数 g -- 模 p 的原根 x -- 私钥 bits -- 素数 p 的位数，默认为 256 如果未提供 p、g、x，则随机生成。 \"\"\" if p is None or g is None or x is None: self.p = randprime(2 ** (bits - 1), 2 ** bits) self.g = find_primitive_root(self.p) self.x = random.randint(1, self.p - 2) else: self.p = p self.g = g self.x = x self.y = pow(self.g, self.x, self.p) # 签名函数 def sign(self, message): \"\"\" 对消息进行签名。 参数： message -- 要签名的消息 返回： (r, s) -- 签名结果 \"\"\" h = hashlib.sha256(message.encode()).digest() h_int = int.from_bytes(h, byteorder='big') while True: k = random.randint(1, self.p - 2) if gcd(k, self.p - 1) == 1: # 确保 k 和 p-1 互质 break r = pow(self.g, k, self.p) k_inv = mod_inverse(k, self.p - 1) s = (h_int - self.x * r) * k_inv % (self.p - 1) return (r, s) # 验证函数 def verify(self, message, signature): \"\"\" 验证消息的签名是否有效。 参数： message -- 原始消息 signature -- 签名元组 (r, s) 返回： valid -- 签名是否有效，True 或 False \"\"\" r, s = signature if not (0 \u003c r \u003c self.p and 0 \u003c s \u003c self.p - 1): # 检查 r 和 s 的范围 return False h = hashlib.sha256(message.encode()).digest() h_int = int.from_bytes(h, byteorder='big') v1 = pow(self.y, r, self.p) * pow(r, s, self.p) % self.p v2 = pow(self.g, h_int, self.p) return v1 == v2 # 测试代码 if __name__ == '__main__': # 大素数和生成元 p = 97380703184954711490740892696023412334547368592870793188226395165275008037663 g = 2 # 使用find_primitive_root找出的原根，若已知则直接赋值 x = 123456789 # 私钥 # 初始化ElGamal签名对象 elgamal = ElGamalSignature(p, g, x) # 消息 student_info = \"26221013_Daaihang_Wong\" # 签名 signature = elgamal.sign(student_info) print(\"签名：\", signature) # 验证 if elgamal.verify(student_info, signature): print(\"签名有效\") else: print(\"签名无效\") 实验四：密钥管理 DH密钥交换协议 DH密钥交换协议（包含密钥生成、加密和解密） 双方利用此协议生成的密钥，结合已编写的AES算法来加密消息（学号+姓名），得密文；解密密文，检验能否正确解密 ► 代码 4-1_Key_Management_DH\rfrom cryptography.hazmat.primitives import serialization from cryptography.hazmat.primitives.asymmetric import x25519 from cryptography.hazmat.primitives.kdf.hkdf import HKDF from cryptography.hazmat.primitives import hashes from cryptography.hazmat.backends import default_backend from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes import os # 函数：执行Diffie-Hellman密钥交换 def diffie_hellman(): # 生成Alice的私钥和公钥 alice_private_key = x25519.X25519PrivateKey.generate() alice_public_key = alice_private_key.public_key() # 生成Bob的私钥和公钥 bob_private_key = x25519.X25519PrivateKey.generate() bob_public_key = bob_private_key.public_key() # Alice计算共享密钥 alice_shared_key = alice_private_key.exchange(bob_public_key) # Bob计算共享密钥 bob_shared_key = bob_private_key.exchange(alice_public_key) # 确保双方计算得到的共享密钥相同 assert alice_shared_key == bob_shared_key return alice_shared_key # 函数：使用AES加密消息 def encrypt_message(message, key): backend = default_backend() iv = os.urandom(16) # 生成随机IV cipher = Cipher(algorithms.AES(key), modes.CFB(iv), backend=backend) encryptor = cipher.encryptor() ciphertext = encryptor.update(message) + encryptor.finalize() return (iv, ciphertext) # 函数：使用AES解密消息 def decrypt_message(ciphertext, key, iv): backend = default_backend() cipher = Cipher(algorithms.AES(key), modes.CFB(iv), backend=backend) decryptor = cipher.decryptor() plaintext = decryptor.update(ciphertext) + decryptor.finalize() return plaintext # 主函数：演示过程 def main(): # 执行Diffie-Hellman密钥交换 shared_key = diffie_hellman() print(f\"共享密钥 (Hex): {shared_key.hex()}\") # 使用HKDF从共享密钥派生AES密钥 derived_key = HKDF( algorithm=hashes.SHA256(), length=32, # 256位密钥长度 salt=None, info=b'Qw3rTyQw3rTyQw3rTy', backend=default_backend() ).derive(shared_key) # 加密和解密消息 message = b\"26221013_Daaihang_Wong\" print(f\"原始消息: {message.decode()}\") # 加密消息 iv, ciphertext = encrypt_message(message, derived_key) print(f\"加密后的消息 (Hex): {ciphertext.hex()}\") # 解密消息 decrypted_message = decrypt_message(ciphertext, derived_key, iv) print(f\"解密后的消息: {decrypted_message.decode()}\") if __name__ == \"__main__\": main() Shamir秘密共享方案 编写一个(n, t) Shamir秘密共享方案（包含秘密的分片和基于Lagrange插值方法恢复秘密） 实例化(n, t) =(5, 3)，而秘密信息为你的“学号+姓名”，演示秘密分片和恢复秘密的过程。 ► 代码 4-2_Key_Management_Shamir\rimport random from sympy import nextprime def generate_shares(secret, n, t, prime): \"\"\" 使用Shamir的秘密共享方案生成n个分享，阈值为t。 参数： - secret: 要共享的秘密（以数值形式）。 - n: 要生成的分享总数。 - t: 恢复秘密所需的分享阈值。 - prime: 有限域素数，用于计算。 返回： - 一个包含分享的元组列表 (x, y)。 \"\"\" coefficients = [secret] + [random.randrange(prime) for _ in range(t - 1)] def polynomial(x): return sum([coeff * pow(x, i, prime) % prime for i, coeff in enumerate(coefficients)]) % prime shares = [] for i in range(1, n + 1): x = i y = polynomial(x) shares.append((x, y)) return shares def recover_secret(shares, prime): \"\"\" 使用Shamir的秘密共享方案恢复秘密，给定足够数量的分享。 参数： - shares: 一个分享的元组列表 (x, y)。 - prime: 有限域素数，用于计算。 返回： - 恢复的秘密（以数值形式）。 \"\"\" def lagrange_interpolation(x, shares): total = 0 n = len(shares) for i in range(n): xi, yi = shares[i] term = yi for j in range(n): if i != j: xj, _ = shares[j] term = term * (x - xj) * pow(xi - xj, -1, prime) % prime total = (total + term) % prime return total return lagrange_interpolation(0, shares) # 示例：使用学号和姓名作为秘密 secret = \"26221013_Daaihang_Wong\" secret_numeric = int.from_bytes(secret.encode(), \"big\") # 转换为数值形式 n = 5 # 总分享数 t = 3 # 恢复秘密所需的分享阈值 # 选择一个足够大的素数作为有限域的模数 prime = nextprime(secret_numeric) # 生成分享 shares = generate_shares(secret_numeric, n, t, prime) print(\"分享：\") for share in shares: print(share) # 选择任意 t 个分享来恢复秘密 selected_shares = random.sample(shares, t) # 恢复秘密 recovered_numeric = recover_secret(selected_shares, prime) # 将数值形式的秘密转换为字节数据 recovered_secret_bytes = recovered_numeric.to_bytes((recovered_numeric.bit_length() + 7) // 8, \"big\") # 比较恢复的秘密与原始秘密 if recovered_secret_bytes == secret.encode(): print(\"\\n成功恢复秘密：\", secret) else: print(\"\\n恢复的秘密与原始秘密不匹配\") ","wordCount":"9342","inLanguage":"zh","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-06-21T18:54:10+08:00","dateModified":"2024-06-21T18:54:10+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/docs/crypto/"},"publisher":{"@type":"Organization","name":"Daaihang's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Daaihang's Blog (Alt + H)"><img src=http://localhost:1313/favicon.svg alt aria-label=logo height=35>Daaihang's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/daily/ title=🎈日常><span>🎈日常</span></a></li><li><a href=http://localhost:1313/docs/ title=🧑‍💻开发><span>🧑‍💻开发</span></a></li><li><a href=http://localhost:1313/tags/ title=🏷️标签><span>🏷️标签</span></a></li><li><a href=http://localhost:1313/categories/ title=📌分类><span>📌分类</span></a></li><li><a href=http://localhost:1313/search/ title=🔍搜索><span>🔍搜索</span></a></li><li><a href=http://localhost:1313/friend/ title=🧑‍🤝‍🧑朋友><span>🧑‍🤝‍🧑朋友</span></a></li><li><a href=http://localhost:1313/about/ title=🫰关于><span>🫰关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>主页</a>&nbsp;»&nbsp;<a href=http://localhost:1313/docs/>开发</a></div><h1 class=post-title>信息安全密码学基础 - 实验代码</h1><div class=post-meta>2024-06-21·9342 字&nbsp;|&nbsp;<a href=https://github.com/daaihang/myWebsite/tree/main/content/docs/crypto.md rel="noopener noreferrer" target=_blank>源代码</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e5%ae%9e%e9%aa%8c%e4%b8%80-%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label="实验一 对称加密">实验一 对称加密</a><ul><li><a href=#%e5%8f%a4%e5%85%b8%e5%af%86%e7%a0%81hill%e5%af%86%e7%a0%81 aria-label=古典密码Hill密码>古典密码Hill密码</a></li><li><a href=#%e7%bd%ae%e6%8d%a2%e5%af%86%e7%a0%81 aria-label=置换密码>置换密码</a></li><li><a href=#%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95aes%e5%92%8c%e5%b7%a5%e4%bd%9c%e6%a8%a1%e5%bc%8f aria-label=对称加密算法AES和工作模式>对称加密算法AES和工作模式</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e4%ba%8c-%e9%9d%9e%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label="实验二 非对称加密">实验二 非对称加密</a><ul><li><a href=#%e5%85%ac%e9%92%a5%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95rsa aria-label=公钥加密算法RSA>公钥加密算法RSA</a></li><li><a href=#%e5%85%ac%e9%92%a5%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95elgamal aria-label=公钥加密算法ElGamal>公钥加密算法ElGamal</a></li><li><a href=#%e6%b7%b7%e5%90%88%e5%8a%a0%e5%af%86%e7%94%b5%e5%ad%90%e4%bf%a1%e5%b0%81 aria-label=混合加密（电子信封）>混合加密（电子信封）</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e4%b8%89-%e8%ae%a4%e8%af%81%e6%8a%80%e6%9c%af aria-label="实验三 认证技术">实验三 认证技术</a><ul><li><a href=#%e6%b6%88%e6%81%af%e8%ae%a4%e8%af%81%e7%a0%81mac aria-label=消息认证码（MAC）>消息认证码（MAC）</a></li><li><a href=#rsa%e6%95%b0%e5%ad%97%e7%ad%be%e5%90%8d%e7%ae%97%e6%b3%95 aria-label=RSA数字签名算法>RSA数字签名算法</a></li><li><a href=#elgamal%e6%95%b0%e5%ad%97%e7%ad%be%e5%90%8d%e7%ae%97%e6%b3%95 aria-label=ElGamal数字签名算法>ElGamal数字签名算法</a></li></ul></li><li><a href=#%e5%ae%9e%e9%aa%8c%e5%9b%9b%e5%af%86%e9%92%a5%e7%ae%a1%e7%90%86 aria-label=实验四：密钥管理>实验四：密钥管理</a><ul><li><a href=#dh%e5%af%86%e9%92%a5%e4%ba%a4%e6%8d%a2%e5%8d%8f%e8%ae%ae aria-label=DH密钥交换协议>DH密钥交换协议</a></li><li><a href=#shamir%e7%a7%98%e5%af%86%e5%85%b1%e4%ba%ab%e6%96%b9%e6%a1%88 aria-label=Shamir秘密共享方案>Shamir秘密共享方案</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><blockquote><p>造福下一届，人人有责。</p></blockquote><p>所属实验：西安邮电大学 - 网络空间安全学院 - 密码学基础 - 课程设计实验**</p><p><strong>实验时间：2024年上半年</strong></p><p>文中所用第三方库使用 pip 自行安装。</p><p>另外还有👉<a href=./crypto-experimental-principles><strong>信息安全密码学基础 - 实验原理</strong></a>，这里有各个实验的实验原理。</p><p><em>免责声明：实验代码仅供参考，请自行设计实现。</em></p><h2 id=实验一-对称加密>实验一 对称加密<a hidden class=anchor aria-hidden=true href=#实验一-对称加密>#</a></h2><h3 id=古典密码hill密码>古典密码Hill密码<a hidden class=anchor aria-hidden=true href=#古典密码hill密码>#</a></h3><p>随机生成一个2×2和一个3×3的可逆的密钥矩阵，矩阵元素取自Z26。</p><ol><li>求这两个矩阵的逆矩阵</li><li>分别用这两个密钥矩阵加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 1-1_Symmetric_Hill</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>Matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义可见 ASCII 字符的范围</span>
</span></span><span class=line><span class=cl><span class=n>MIN_ASCII</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=n>MAX_ASCII</span> <span class=o>=</span> <span class=mi>126</span>
</span></span><span class=line><span class=cl><span class=n>Z</span> <span class=o>=</span> <span class=n>MAX_ASCII</span> <span class=o>-</span> <span class=n>MIN_ASCII</span> <span class=o>+</span> <span class=mi>1</span>  <span class=c1># 字符集大小</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成一个随机的 n x n 可逆矩阵，元素取自 Z</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_invertible_matrix</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>matrix</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># 检查矩阵行列式与 Z 是否互质，只有互质时矩阵才是可逆的</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>np</span><span class=o>.</span><span class=n>gcd</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>det</span><span class=p>(</span><span class=n>matrix</span><span class=p>))),</span> <span class=n>Z</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>matrix</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算矩阵在模 Z 下的逆矩阵</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>modular_inverse</span><span class=p>(</span><span class=n>matrix</span><span class=p>,</span> <span class=n>mod</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mat</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>(</span><span class=n>matrix</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 使用 sympy 库计算矩阵的模逆</span>
</span></span><span class=line><span class=cl>    <span class=n>inv_mat</span> <span class=o>=</span> <span class=n>mat</span><span class=o>.</span><span class=n>inv_mod</span><span class=p>(</span><span class=n>mod</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>inv_mat</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成 2x2 和 3x3 可逆矩阵</span>
</span></span><span class=line><span class=cl><span class=n>matrix_2x2</span> <span class=o>=</span> <span class=n>generate_invertible_matrix</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>matrix_3x3</span> <span class=o>=</span> <span class=n>generate_invertible_matrix</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算矩阵的逆矩阵</span>
</span></span><span class=line><span class=cl><span class=n>inverse_2x2</span> <span class=o>=</span> <span class=n>modular_inverse</span><span class=p>(</span><span class=n>matrix_2x2</span><span class=p>,</span> <span class=n>Z</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>inverse_3x3</span> <span class=o>=</span> <span class=n>modular_inverse</span><span class=p>(</span><span class=n>matrix_3x3</span><span class=p>,</span> <span class=n>Z</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将文本转换为数字列表</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>text_to_numbers</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 将字符的 ASCII 码减去 MIN_ASCII</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=o>-</span> <span class=n>MIN_ASCII</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>text</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将数字列表转换为文本</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>numbers_to_text</span><span class=p>(</span><span class=n>numbers</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 将数字加上 MIN_ASCII 转换回字符</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>num</span> <span class=o>+</span> <span class=n>MIN_ASCII</span><span class=p>)</span> <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hill 加密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hill_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key_matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>key_matrix</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>message_numbers</span> <span class=o>=</span> <span class=n>text_to_numbers</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>message_numbers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># 使用最小的可见 ASCII 字符进行填充</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_numbers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>),</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>message_numbers</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>n</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># 矩阵乘法并取模 Z</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>key_matrix</span><span class=p>,</span> <span class=n>block</span><span class=p>)</span> <span class=o>%</span> <span class=n>Z</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_numbers</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>encrypted_block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>numbers_to_text</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Hill 解密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_key_matrix</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>inverse_key_matrix</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_numbers</span> <span class=o>=</span> <span class=n>text_to_numbers</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_numbers</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>),</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>encrypted_numbers</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>n</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># 使用逆矩阵进行矩阵乘法并取模 Z</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_block</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>dot</span><span class=p>(</span><span class=n>inverse_key_matrix</span><span class=p>,</span> <span class=n>block</span><span class=p>)</span> <span class=o>%</span> <span class=n>Z</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_numbers</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>decrypted_block</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>numbers_to_text</span><span class=p>(</span><span class=n>decrypted_numbers</span><span class=p>)</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=mi>0</span><span class=p>))</span>  <span class=c1># 移除填充</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实验 ①: 打印生成的矩阵及其逆矩阵</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;实验 ①: 生成的矩阵及其逆矩阵&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2x2 矩阵:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>matrix_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2x2 逆矩阵:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inverse_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>3x3 矩阵:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>matrix_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;3x3 逆矩阵:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>inverse_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实验 ②: 加密和解密消息</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 仅保留消息中的可见字符</span>
</span></span><span class=line><span class=cl><span class=n>filtered_message</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>MIN_ASCII</span> <span class=o>&lt;=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>MAX_ASCII</span><span class=p>,</span> <span class=n>message</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encrypted_message_2x2</span> <span class=o>=</span> <span class=n>hill_encrypt</span><span class=p>(</span><span class=n>filtered_message</span><span class=p>,</span> <span class=n>matrix_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message_2x2</span> <span class=o>=</span> <span class=n>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message_2x2</span><span class=p>,</span> <span class=n>inverse_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>encrypted_message_3x3</span> <span class=o>=</span> <span class=n>hill_encrypt</span><span class=p>(</span><span class=n>filtered_message</span><span class=p>,</span> <span class=n>matrix_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message_3x3</span> <span class=o>=</span> <span class=n>hill_decrypt</span><span class=p>(</span><span class=n>encrypted_message_3x3</span><span class=p>,</span> <span class=n>inverse_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>实验 ②: 加密和解密结果&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;原始消息:&#34;</span><span class=p>,</span> <span class=n>filtered_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>使用 2x2 矩阵&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;加密消息:&#34;</span><span class=p>,</span> <span class=n>encrypted_message_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密消息:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_2x2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>使用 3x3 矩阵&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;加密消息:&#34;</span><span class=p>,</span> <span class=n>encrypted_message_3x3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密消息:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_3x3</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=置换密码>置换密码<a hidden class=anchor aria-hidden=true href=#置换密码>#</a></h3><p>随机生成一个置换表（置换表长度可设置）</p><ol><li>求逆置换</li><li>用此置换表加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 1-2_Symmetric_Permutation</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义可见 ASCII 字符的范围</span>
</span></span><span class=line><span class=cl><span class=n>MIN_ASCII</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=n>MAX_ASCII</span> <span class=o>=</span> <span class=mi>126</span>
</span></span><span class=line><span class=cl><span class=n>CHARS</span> <span class=o>=</span> <span class=p>[</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>MIN_ASCII</span><span class=p>,</span> <span class=n>MAX_ASCII</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>LENGTH</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>CHARS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成随机置换表</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_permutation_table</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>table</span> <span class=o>=</span> <span class=n>CHARS</span><span class=p>[:</span><span class=n>length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>  <span class=c1># 随机打乱字符列表，形成置换表</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>table</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成逆置换表</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_inverse_permutation_table</span><span class=p>(</span><span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>inverse_table</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>inverse_table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=o>=</span> <span class=n>CHARS</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>  <span class=c1># 找到字符在原字符集中的位置，并在逆置换表中记录相应的原字符</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>inverse_table</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 置换加密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>permutation_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 用置换表替换消息中的每个字符</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=k>if</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>CHARS</span> <span class=k>else</span> <span class=n>char</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 置换解密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>permutation_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_table</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 用逆置换表还原消息中的每个字符</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>inverse_table</span><span class=p>[</span><span class=n>CHARS</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>char</span><span class=p>)]</span> <span class=k>if</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>CHARS</span> <span class=k>else</span> <span class=n>char</span> <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实验 ①: 打印生成的置换表及其逆置换表</span>
</span></span><span class=line><span class=cl><span class=n>table</span> <span class=o>=</span> <span class=n>generate_permutation_table</span><span class=p>(</span><span class=n>LENGTH</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>inverse_table</span> <span class=o>=</span> <span class=n>generate_inverse_permutation_table</span><span class=p>(</span><span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;实验 ①: 生成的置换表及其逆置换表&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;置换表:&#34;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;逆置换表:&#34;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>inverse_table</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实验 ②: 加密和解密消息</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>permutation_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>table</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>permutation_decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>,</span> <span class=n>inverse_table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>实验 ②: 加密和解密结果&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;原始消息:&#34;</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;加密消息:&#34;</span><span class=p>,</span> <span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密消息:&#34;</span><span class=p>,</span> <span class=n>decrypted_message</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=对称加密算法aes和工作模式>对称加密算法AES和工作模式<a hidden class=anchor aria-hidden=true href=#对称加密算法aes和工作模式>#</a></h3><ol><li>编写AES加密和解密算法</li><li>分别结合CBC和OFB工作模式，加密消息（学号+姓名），得密文；解密密文，检验是否正确解密了？</li></ol><p><strong>我给出了4种方式实现。优先使用第4个。其他的或多或少使用第三方的非基础密码库，可能不符合实验要求。</strong></p><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 - 实现一 1-3_Symmetric_AES_1</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.ciphers</span> <span class=kn>import</span> <span class=n>Cipher</span><span class=p>,</span> <span class=n>algorithms</span><span class=p>,</span> <span class=n>modes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.backends</span> <span class=kn>import</span> <span class=n>default_backend</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成随机密钥和初始化向量（IV）</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_key_iv</span><span class=p>(</span><span class=n>key_size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>  <span class=c1># IV 大小应为块大小（16 字节）</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES 加密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># PKCS7填充</span>
</span></span><span class=line><span class=cl>    <span class=n>padder</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>PKCS7</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span><span class=o>.</span><span class=n>padder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>padder</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span> <span class=o>+</span> <span class=n>padder</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 创建AES加密器</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>mode</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>encryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 加密数据</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span> <span class=o>+</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES 解密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>mode</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 创建AES解密器</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>mode</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>decryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解密数据</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>+</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 去除PKCS7填充</span>
</span></span><span class=line><span class=cl>    <span class=n>unpadder</span> <span class=o>=</span> <span class=n>padding</span><span class=o>.</span><span class=n>PKCS7</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span><span class=o>.</span><span class=n>unpadder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_data</span> <span class=o>=</span> <span class=n>unpadder</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span> <span class=o>+</span> <span class=n>unpadder</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted_data</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 设置密钥长度（128, 192, 或 256 位）</span>
</span></span><span class=line><span class=cl>    <span class=n>key_size</span> <span class=o>=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 生成密钥和 IV</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span><span class=p>,</span> <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_key_iv</span><span class=p>(</span><span class=n>key_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 打印密钥和 IV</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;实验 ①: 密钥和 IV&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;密钥:&#34;</span><span class=p>,</span> <span class=n>key</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;IV:&#34;</span><span class=p>,</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 定义消息</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 实验 ②: CBC 模式加密和解密</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>实验 ②: CBC 模式&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_cbc</span> <span class=o>=</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>CBC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBC 加密消息:&#34;</span><span class=p>,</span> <span class=n>ciphertext_cbc</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext_cbc</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>CBC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBC 解密消息:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 实验 ②: OFB 模式加密和解密</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>实验 ②: OFB 模式&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_ofb</span> <span class=o>=</span> <span class=n>aes_encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>OFB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;OFB 加密消息:&#34;</span><span class=p>,</span> <span class=n>ciphertext_ofb</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_decrypt</span><span class=p>(</span><span class=n>ciphertext_ofb</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>modes</span><span class=o>.</span><span class=n>OFB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;OFB 解密消息:&#34;</span><span class=p>,</span> <span class=n>decrypted_message_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 运行主函数</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 - 实现二 1-3_Symmetric_AES_2</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pyaes</span> <span class=kn>import</span> <span class=n>pyaes</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding_needed</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>padding_needed</span><span class=p>)</span> <span class=o>*</span> <span class=n>padding_needed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>split_blocks</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>block_size</span><span class=o>=</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>block_size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>block_size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationCBC</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>padded_data</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>blocks</span> <span class=o>=</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>padded_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>aes</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>block</span><span class=p>)</span> <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>padding</span> <span class=o>=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=n>padding</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationCBC</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>blocks</span> <span class=o>=</span> <span class=n>split_blocks</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>aes</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>block</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationOFB</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>pyaes</span><span class=o>.</span><span class=n>AESModeOfOperationOFB</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=o>=</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>aes</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>iv</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Using CBC mode</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_cbc</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_cbc</span> <span class=o>=</span> <span class=n>encrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>plaintext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>ciphertext_cbc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_cbc</span> <span class=o>=</span> <span class=n>decrypt_cbc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_cbc</span> <span class=o>==</span> <span class=n>plaintext_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Using OFB mode</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_ofb</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_ofb</span> <span class=o>=</span> <span class=n>encrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>plaintext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=nb>repr</span><span class=p>(</span><span class=n>ciphertext_ofb</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_ofb</span> <span class=o>=</span> <span class=n>decrypt_ofb</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decrypted_ofb</span> <span class=o>==</span> <span class=n>plaintext_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 - 实现三 1-3_Symmetric_AES_3</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 一个简单的 AES-128-ECB，其中 128 指采用 128 位密钥块，</span>
</span></span><span class=line><span class=cl><span class=c1># ECB 模式，为长度不足 128 位的数据块填充 0x00。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s_box_inv</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rc</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>inv</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>inv</span><span class=p>:</span>  <span class=c1># for decryption</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box_inv</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>inv</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>inv</span><span class=p>:</span>  <span class=c1># for decryption</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][</span><span class=o>-</span><span class=n>i</span><span class=p>:]</span> <span class=o>+</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][:</span><span class=o>-</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][</span><span class=n>i</span><span class=p>:]</span> <span class=o>+</span> <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>::</span><span class=mi>4</span><span class=p>][:</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mul_by_2</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>n</span> <span class=o>&lt;&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>n</span> <span class=o>&amp;</span> <span class=mi>128</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>^=</span> <span class=mh>0x1b</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mul_by_3</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>n</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mix_column</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># [2 3 1 1]</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>  <span class=c1># [1 2 3 1]</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>^</span> <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>]),</span>  <span class=c1># [1 1 2 3]</span>
</span></span><span class=line><span class=cl>            <span class=n>mul_by_3</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>c</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>mul_by_2</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>3</span><span class=p>]),</span>  <span class=c1># [3 1 1 2]</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>mix_column</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>key_expansion</span><span class=p>(</span><span class=n>grid</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span> <span class=o>*</span> <span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=o>-</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># 对上一轮最后4字节自循环、S-box置换、轮常数异或，从而计算出当前新一轮最前4字节</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span> <span class=o>+</span> <span class=n>r</span><span class=p>[:</span><span class=mi>1</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>s_box</span><span class=p>[</span><span class=n>v</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>][</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xf</span><span class=p>]</span> <span class=o>^</span> <span class=p>(</span><span class=n>rc</span><span class=p>[</span><span class=n>i</span> <span class=o>//</span> <span class=mi>4</span><span class=p>]</span> <span class=k>if</span> <span class=n>j</span> <span class=o>==</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>grid</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>]</span> <span class=o>^</span> <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>grid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>grid</span><span class=p>,</span> <span class=n>round_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>grid</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^=</span> <span class=n>round_key</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># First round</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_columns</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Final round</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># First round</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=o>-</span><span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>16</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>mix_columns</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Final round</span>
</span></span><span class=line><span class=cl>    <span class=n>shift_rows</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add_round_key</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>expanded_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes</span><span class=p>(</span><span class=n>typ</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>expanded</span> <span class=o>=</span> <span class=n>key_expansion</span><span class=p>(</span><span class=nb>bytearray</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Pad the message to a multiple of 16 bytes</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># only for encryption</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>msg</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=p>(</span><span class=mi>16</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Encrypt/decrypt the message</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>),</span> <span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>typ</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>],</span> <span class=n>expanded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>16</span><span class=p>],</span> <span class=n>expanded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Qw3rTyQw3rTyQw3r&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>enc</span> <span class=o>=</span> <span class=n>aes</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;Daaihang_Wong_26221013&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>dec</span> <span class=o>=</span> <span class=n>aes</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;加密：&#39;</span><span class=p>,</span> <span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;解密：&#39;</span><span class=p>,</span> <span class=n>dec</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 - 实现四 1-3_Symmetric_AES_4（推荐参考）</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES块大小</span>
</span></span><span class=line><span class=cl><span class=n>BLOCK_SIZE</span> <span class=o>=</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成随机字节</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_random_bytes</span><span class=p>(</span><span class=n>length</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填充函数：PKCS#7</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pad_length</span> <span class=o>=</span> <span class=n>BLOCK_SIZE</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)</span> <span class=o>%</span> <span class=n>BLOCK_SIZE</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span> <span class=o>+</span> <span class=nb>bytes</span><span class=p>([</span><span class=n>pad_length</span><span class=p>]</span> <span class=o>*</span> <span class=n>pad_length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 去填充函数：PKCS#7</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unpad</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>pad_length</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=n>pad_length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义S盒和逆S盒</span>
</span></span><span class=line><span class=cl><span class=n>s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>inv_s_box</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span> <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 字节替换</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 字节替换的逆操作</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>inv_s_box</span><span class=p>[</span><span class=n>b</span><span class=p>]</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 行移位</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>12</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 行移位的逆操作</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>13</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>10</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>14</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>11</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>8</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>15</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span><span class=p>[</span><span class=mi>12</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>9</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span> <span class=n>state</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># GF(2^8)中的乘法</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gmul</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>b</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>p</span> <span class=o>^=</span> <span class=n>a</span>
</span></span><span class=line><span class=cl>        <span class=n>hi_bit_set</span> <span class=o>=</span> <span class=n>a</span> <span class=o>&amp;</span> <span class=mh>0x80</span>
</span></span><span class=line><span class=cl>        <span class=n>a</span> <span class=o>&lt;&lt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>hi_bit_set</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>a</span> <span class=o>^=</span> <span class=mh>0x1b</span>
</span></span><span class=line><span class=cl>        <span class=n>b</span> <span class=o>&gt;&gt;=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>p</span> <span class=o>&amp;</span> <span class=mh>0xff</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列混合</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mixed</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>3</span><span class=p>)</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>mixed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 列混合的逆操作</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>inv_mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>mixed</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>mixed</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>0</span><span class=p>],</span> <span class=mi>11</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>1</span><span class=p>],</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>9</span><span class=p>)</span> <span class=o>^</span> <span class=n>gmul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>state</span><span class=p>[</span><span class=n>i</span> <span class=o>*</span> <span class=mi>4</span> <span class=o>+</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>mixed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 轮密钥加</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>round_key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>round_key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES块加密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_encrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># AES块解密函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_decrypt_block</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>9</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_mix_columns</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_shift_rows</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>state</span> <span class=o>=</span> <span class=n>inv_sub_bytes</span><span class=p>(</span><span class=n>state</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>state</span> <span class=o>=</span> <span class=n>add_round_key</span><span class=p>(</span><span class=n>state</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CBC模式加密</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_encrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>  <span class=c1># 生成随机初始化向量（IV）</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_padded</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>plaintext</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext_padded</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=n>plaintext_padded</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>xor_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>plaintext_block</span><span class=p>,</span> <span class=n>previous_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>xor_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CBC模式解密</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_cbc_decrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=n>BLOCK_SIZE</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_padded</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>actual_ciphertext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_block</span> <span class=o>=</span> <span class=n>aes_decrypt_block</span><span class=p>(</span><span class=n>ciphertext_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>decrypted_block</span><span class=p>,</span> <span class=n>previous_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_padded</span> <span class=o>+=</span> <span class=n>plaintext_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>ciphertext_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>plaintext_padded</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OFB模式加密</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ofb_encrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>  <span class=c1># 生成随机初始化向量（IV）</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_bytes</span> <span class=o>=</span> <span class=n>plaintext</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>plaintext_bytes</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>block</span> <span class=o>=</span> <span class=n>plaintext_bytes</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>previous_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>encrypted_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>cipher_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># OFB模式解密</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ofb_decrypt</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[:</span><span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>actual_ciphertext</span> <span class=o>=</span> <span class=n>ciphertext</span><span class=p>[</span><span class=n>BLOCK_SIZE</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    <span class=n>previous_block</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext_bytes</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>actual_ciphertext</span><span class=p>),</span> <span class=n>BLOCK_SIZE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext_block</span> <span class=o>=</span> <span class=n>actual_ciphertext</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>BLOCK_SIZE</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_block</span> <span class=o>=</span> <span class=n>aes_encrypt_block</span><span class=p>(</span><span class=n>previous_block</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_block</span> <span class=o>=</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>a</span> <span class=o>^</span> <span class=n>b</span> <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>ciphertext_block</span><span class=p>,</span> <span class=n>encrypted_block</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext_bytes</span> <span class=o>+=</span> <span class=n>plaintext_block</span>
</span></span><span class=line><span class=cl>        <span class=n>previous_block</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成AES密钥</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_aes_key</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>generate_random_bytes</span><span class=p>(</span><span class=n>BLOCK_SIZE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>  <span class=c1># 学号+姓名</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;原始消息: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 生成AES密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>aes_key</span> <span class=o>=</span> <span class=n>generate_aes_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># CBC模式</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_cbc_encrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;CBC模式加密后的消息: </span><span class=si>{</span><span class=n>encrypted_message_cbc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_cbc</span> <span class=o>=</span> <span class=n>aes_cbc_decrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>encrypted_message_cbc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;CBC模式解密后的消息: </span><span class=si>{</span><span class=n>decrypted_message_cbc</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># OFB模式</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_ofb_encrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;OFB模式加密后的消息: </span><span class=si>{</span><span class=n>encrypted_message_ofb</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message_ofb</span> <span class=o>=</span> <span class=n>aes_ofb_decrypt</span><span class=p>(</span><span class=n>aes_key</span><span class=p>,</span> <span class=n>encrypted_message_ofb</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;OFB模式解密后的消息: </span><span class=si>{</span><span class=n>decrypted_message_ofb</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 检查解密后的消息是否正确</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>message</span> <span class=o>==</span> <span class=n>decrypted_message_cbc</span><span class=p>,</span> <span class=s2>&#34;CBC模式解密失败！&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>message</span> <span class=o>==</span> <span class=n>decrypted_message_ofb</span><span class=p>,</span> <span class=s2>&#34;OFB模式解密失败！&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CBC和OFB模式解密成功！&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=实验二-非对称加密>实验二 非对称加密<a hidden class=anchor aria-hidden=true href=#实验二-非对称加密>#</a></h2><h3 id=公钥加密算法rsa>公钥加密算法RSA<a hidden class=anchor aria-hidden=true href=#公钥加密算法rsa>#</a></h3><ol><li>编写RSA密码算法（包含密钥生成、加密和解密）</li><li>利用此算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 2-1_Asymmetric_RSA</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>isprime</span><span class=p>,</span> <span class=n>mod_inverse</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RSAEncryption</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>=</span> <span class=n>key_size</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>public_key</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_keys</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n_bits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        生成一个具有指定位数的素数
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>num</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>getrandbits</span><span class=p>(</span><span class=n>n_bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>isprime</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_keys</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        生成RSA公钥和私钥
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 选择两个不同的大素数 p 和 q</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>q</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_prime</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 计算 n = p * q</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 计算 φ(n) = (p-1)(q-1)，其中φ(n)为n的欧拉函数</span>
</span></span><span class=line><span class=cl>        <span class=n>phi</span> <span class=o>=</span> <span class=p>(</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=n>q</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 选择一个整数 e，使得 1 &lt; e &lt; φ(n) 并且 e 与 φ(n) 互质</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span> <span class=o>=</span> <span class=mi>65537</span>  <span class=c1># 常用的 e 值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 计算 d 使得 d * e ≡ 1 (mod φ(n))，即 d 是 e 模 φ(n) 的乘法逆元</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>phi</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 公钥: (e, n)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 私钥: (d, n)</span>
</span></span><span class=line><span class=cl>        <span class=n>public_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>private_key</span> <span class=o>=</span> <span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>public_key</span><span class=p>,</span> <span class=n>private_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        使用公钥加密消息。将消息转换为整数 m，计算密文 c = m^e mod n。
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>public_key</span>
</span></span><span class=line><span class=cl>        <span class=c1># 将消息转换为字节，再转换为整数</span>
</span></span><span class=line><span class=cl>        <span class=n>message_bytes</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>message_bytes</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 使用公钥加密消息</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_message_int</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>message_int</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>encrypted_message_int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>encrypted_message_int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        使用私钥解密消息。计算原文 m = c^d mod n，将整数 m 转换为字节，再转换为字符串。
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>d</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>private_key</span>
</span></span><span class=line><span class=cl>        <span class=c1># 使用私钥解密消息</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_message_int</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>encrypted_message_int</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 将整数转换为字节，再转换为字符串</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_message_bytes</span> <span class=o>=</span> <span class=n>decrypted_message_int</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>decrypted_message_int</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                 <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>decrypted_message_bytes</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实例化RSAEncryption类</span>
</span></span><span class=line><span class=cl><span class=n>rsa_encryption</span> <span class=o>=</span> <span class=n>RSAEncryption</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义要加密的消息</span>
</span></span><span class=line><span class=cl><span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 加密消息</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>rsa_encryption</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;加密消息：</span><span class=si>{</span><span class=n>encrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解密消息</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>rsa_encryption</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;解密消息：</span><span class=si>{</span><span class=n>decrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证解密是否正确</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>student_info</span> <span class=o>==</span> <span class=n>decrypted_message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密成功，消息正确&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密失败，消息不正确&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=公钥加密算法elgamal>公钥加密算法ElGamal<a hidden class=anchor aria-hidden=true href=#公钥加密算法elgamal>#</a></h3><ol><li>编写ElGamal加密算法（包含密钥生成、加密和解密过程）</li><li>利用此算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 2-2_Asymmetric_ElGamal</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>mod_inverse</span><span class=p>,</span> <span class=n>isprime</span><span class=p>,</span> <span class=n>randprime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ElGamal</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>=</span> <span class=n>key_size</span>
</span></span><span class=line><span class=cl>        <span class=c1># 生成一个大素数 p</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_large_prime</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># 生成一个随机整数 g，满足 2 &lt;= g &lt;= p-1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 生成私钥 x，满足 1 &lt;= x &lt;= p-2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 计算公钥 h = g^x mod p</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>h</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_large_prime</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;生成一个大素数&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 在指定范围内生成一个随机素数</span>
</span></span><span class=line><span class=cl>            <span class=n>prime_candidate</span> <span class=o>=</span> <span class=n>randprime</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key_size</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>2</span> <span class=o>**</span> <span class=bp>self</span><span class=o>.</span><span class=n>key_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>isprime</span><span class=p>(</span><span class=n>prime_candidate</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>prime_candidate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        使用公钥加密消息
</span></span></span><span class=line><span class=cl><span class=s2>        步骤：
</span></span></span><span class=line><span class=cl><span class=s2>        1. 生成一个随机整数 y，满足 1 &lt;= y &lt;= p-2
</span></span></span><span class=line><span class=cl><span class=s2>        2. 计算 c1 = g^y mod p
</span></span></span><span class=line><span class=cl><span class=s2>        3. 计算 s = h^y mod p
</span></span></span><span class=line><span class=cl><span class=s2>        4. 将消息转换为整数 m
</span></span></span><span class=line><span class=cl><span class=s2>        5. 计算 c2 = (m * s) mod p
</span></span></span><span class=line><span class=cl><span class=s2>        返回密文对 (c1, c2)
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>h</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>),</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>c2</span> <span class=o>=</span> <span class=p>(</span><span class=n>m</span> <span class=o>*</span> <span class=n>s</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        使用私钥解密消息
</span></span></span><span class=line><span class=cl><span class=s2>        步骤：
</span></span></span><span class=line><span class=cl><span class=s2>        1. 提取密文对 (c1, c2)
</span></span></span><span class=line><span class=cl><span class=s2>        2. 计算 s = c1^x mod p
</span></span></span><span class=line><span class=cl><span class=s2>        3. 计算 s 的乘法逆元 s_inv = s^-1 mod p
</span></span></span><span class=line><span class=cl><span class=s2>        4. 计算 m = (c2 * s_inv) mod p
</span></span></span><span class=line><span class=cl><span class=s2>        5. 将整数 m 转换为字节，再转换为字符串
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>c1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s_inv</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=p>(</span><span class=n>c2</span> <span class=o>*</span> <span class=n>s_inv</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>m</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 实例化ElGamal类</span>
</span></span><span class=line><span class=cl><span class=n>elgamal</span> <span class=o>=</span> <span class=n>ElGamal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义要加密的消息</span>
</span></span><span class=line><span class=cl><span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 加密消息</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_message</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;加密消息：</span><span class=si>{</span><span class=n>encrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解密消息</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>encrypted_message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;解密消息：</span><span class=si>{</span><span class=n>decrypted_message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证解密是否正确</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>student_info</span> <span class=o>==</span> <span class=n>decrypted_message</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密成功，消息正确&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;解密失败，消息不正确&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=混合加密电子信封>混合加密（电子信封）<a hidden class=anchor aria-hidden=true href=#混合加密电子信封>#</a></h3><ol><li>基于已编写的AES和RSA（或ElGamal）密码算法，实现混合加密</li><li>利用混合算法加密消息（学号+姓名），得密文；解密密文，检验能否正确解密</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># todo: 还没实现，先等着吧，太久了就在评论区滴滴我。</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=实验三-认证技术>实验三 认证技术<a hidden class=anchor aria-hidden=true href=#实验三-认证技术>#</a></h2><blockquote><p>注：过程中可以利用密码库中的Hash算法（如SHA2，SM3，SHA3等）</p></blockquote><h3 id=消息认证码mac>消息认证码（MAC）<a hidden class=anchor aria-hidden=true href=#消息认证码mac>#</a></h3><ol><li>编写基于Hash算法的消息认证码</li><li>利用此算法对消息（学号+姓名）进行完整性和真实性认证</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 3-1_Certification_MAC</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor_bytes</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;对两个字节序列进行按位异或操作&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>x</span> <span class=o>^</span> <span class=n>y</span> <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hmac_hash</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    实现 HMAC 算法
</span></span></span><span class=line><span class=cl><span class=s2>    1. 如果密钥长度大于哈希块大小，则对密钥进行哈希处理
</span></span></span><span class=line><span class=cl><span class=s2>    2. 如果密钥长度小于哈希块大小，则在密钥末尾补零至块大小
</span></span></span><span class=line><span class=cl><span class=s2>    3. 生成内层和外层填充密钥
</span></span></span><span class=line><span class=cl><span class=s2>    4. 使用填充后的密钥和消息进行两次哈希计算
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>block_size</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>()</span><span class=o>.</span><span class=n>block_size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 如果密钥长度大于块大小，则对密钥进行哈希处理</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>block_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 如果密钥长度小于块大小，则在密钥末尾补零至块大小</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>block_size</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>key</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=n>block_size</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 生成内层和外层填充密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>o_key_pad</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x5c</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i_key_pad</span> <span class=o>=</span> <span class=n>xor_bytes</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x36</span><span class=s1>&#39;</span> <span class=o>*</span> <span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 内层哈希</span>
</span></span><span class=line><span class=cl>    <span class=n>inner_hash</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>i_key_pad</span> <span class=o>+</span> <span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># 外层哈希</span>
</span></span><span class=line><span class=cl>    <span class=n>final_hash</span> <span class=o>=</span> <span class=n>hash_func</span><span class=p>(</span><span class=n>o_key_pad</span> <span class=o>+</span> <span class=n>inner_hash</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>final_hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    生成消息认证码（MAC）
</span></span></span><span class=line><span class=cl><span class=s2>    使用给定的密钥和消息生成 HMAC
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>message_bytes</span> <span class=o>=</span> <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hmac_hash</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message_bytes</span><span class=p>,</span> <span class=n>hash_func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>mac_to_verify</span><span class=p>,</span> <span class=n>hash_func</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    验证消息认证码（MAC）
</span></span></span><span class=line><span class=cl><span class=s2>    比较生成的 MAC 和提供的 MAC 是否相同
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>generated_mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_func</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>compare_digest</span><span class=p>(</span><span class=n>generated_mac</span><span class=p>,</span> <span class=n>mac_to_verify</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>compare_digest</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;比较两个哈希值，防止时间攻击&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=o>!=</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>|=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 消息</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用的密钥</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;Qw3rTyQw3rTy&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成消息认证码</span>
</span></span><span class=line><span class=cl><span class=n>mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;消息: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;生成的MAC: </span><span class=si>{</span><span class=n>mac</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证消息认证码</span>
</span></span><span class=line><span class=cl><span class=n>is_valid</span> <span class=o>=</span> <span class=n>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;MAC验证结果: </span><span class=si>{</span><span class=s1>&#39;有效&#39;</span> <span class=k>if</span> <span class=n>is_valid</span> <span class=k>else</span> <span class=s1>&#39;无效&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模拟篡改消息后的MAC验证</span>
</span></span><span class=line><span class=cl><span class=n>tampered_message</span> <span class=o>=</span> <span class=s2>&#34;26221013_D@a1han9_W0ng&#34;</span>
</span></span><span class=line><span class=cl><span class=n>tampered_mac</span> <span class=o>=</span> <span class=n>generate_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>)</span> <span class=c1># 篡改后的消息的MAC</span>
</span></span><span class=line><span class=cl><span class=n>is_valid_tampered</span> <span class=o>=</span> <span class=n>verify_mac</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>,</span> <span class=n>mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;篡改后的消息 与 原消息的MAC 验证的结果: </span><span class=si>{</span><span class=s1>&#39;有效&#39;</span> <span class=k>if</span> <span class=n>is_valid_tampered</span> <span class=k>else</span> <span class=s1>&#39;无效&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=rsa数字签名算法>RSA数字签名算法<a hidden class=anchor aria-hidden=true href=#rsa数字签名算法>#</a></h3><ol><li>编写RSA签名算法（包含密钥生成、签名和验证过程）</li><li>利用此算法对消息（学号+姓名）进行签名；并在接收方进行验证</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 3-2_Certification_RSA</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># RSA数字签名算法（利用密码库中的Hash算法）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.asymmetric</span> <span class=kn>import</span> <span class=n>rsa</span><span class=p>,</span> <span class=n>padding</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>hashes</span><span class=p>,</span> <span class=n>serialization</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_rsa_key_pair</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>generate_private_key</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>public_exponent</span><span class=o>=</span><span class=mi>65537</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>key_size</span><span class=o>=</span><span class=mi>2048</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>private_key</span><span class=p>,</span> <span class=n>public_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sign_message</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>private_key</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>mgf</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>MGF1</span><span class=p>(</span><span class=n>hash_algorithm</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>salt_length</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=o>.</span><span class=n>MAX_LENGTH</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>hash_algorithm</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>signature</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>public_key</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>signature</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>mgf</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>MGF1</span><span class=p>(</span><span class=n>hash_algorithm</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=n>salt_length</span><span class=o>=</span><span class=n>padding</span><span class=o>.</span><span class=n>PSS</span><span class=o>.</span><span class=n>MAX_LENGTH</span>
</span></span><span class=line><span class=cl>            <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>hash_algorithm</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成密钥对</span>
</span></span><span class=line><span class=cl><span class=n>private_key</span><span class=p>,</span> <span class=n>public_key</span> <span class=o>=</span> <span class=n>generate_rsa_key_pair</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 消息</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用的哈希算法</span>
</span></span><span class=line><span class=cl><span class=n>hash_algorithm</span> <span class=o>=</span> <span class=n>hashes</span><span class=o>.</span><span class=n>SHA256</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成签名</span>
</span></span><span class=line><span class=cl><span class=n>signature</span> <span class=o>=</span> <span class=n>sign_message</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;消息: </span><span class=si>{</span><span class=n>message</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;签名: </span><span class=si>{</span><span class=n>signature</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 验证签名</span>
</span></span><span class=line><span class=cl><span class=n>is_valid</span> <span class=o>=</span> <span class=n>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;签名验证结果: </span><span class=si>{</span><span class=s1>&#39;有效&#39;</span> <span class=k>if</span> <span class=n>is_valid</span> <span class=k>else</span> <span class=s1>&#39;无效&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 模拟篡改消息后的签名验证</span>
</span></span><span class=line><span class=cl><span class=n>tampered_message</span> <span class=o>=</span> <span class=s2>&#34;26221013_D@a1han9_W0ng&#34;</span>
</span></span><span class=line><span class=cl><span class=n>is_valid_tampered</span> <span class=o>=</span> <span class=n>verify_signature</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>tampered_message</span><span class=p>,</span> <span class=n>signature</span><span class=p>,</span> <span class=n>hash_algorithm</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;篡改后消息的签名验证结果: </span><span class=si>{</span><span class=s1>&#39;有效&#39;</span> <span class=k>if</span> <span class=n>is_valid_tampered</span> <span class=k>else</span> <span class=s1>&#39;无效&#39;</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=elgamal数字签名算法>ElGamal数字签名算法<a hidden class=anchor aria-hidden=true href=#elgamal数字签名算法>#</a></h3><ol><li>编写ElGamal签名算法（包含密钥生成、签名和验证过程）</li><li>利用此算法对消息（学号+姓名）进行签名；并在接收方进行验证</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 3-3_Certification_ElGamal</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>gcd</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>mod_inverse</span><span class=p>,</span> <span class=n>randprime</span><span class=p>,</span> <span class=n>isprime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 确保生成元是模p的一个原根</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>find_primitive_root</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    找到模 p 的一个原根。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    参数：
</span></span></span><span class=line><span class=cl><span class=s2>    p -- 模数，应为素数
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    返回：
</span></span></span><span class=line><span class=cl><span class=s2>    g -- 模 p 的一个原根
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>isprime</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;p must be a prime number&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>phi</span> <span class=o>=</span> <span class=n>p</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>prime_factors</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>phi</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>*</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>n</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>prime_factors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>n</span> <span class=o>//=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>n</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>prime_factors</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>all</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>g</span><span class=p>,</span> <span class=n>phi</span> <span class=o>//</span> <span class=n>factor</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>factor</span> <span class=ow>in</span> <span class=n>prime_factors</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ElGamal签名算法类</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ElGamalSignature</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>p</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>g</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>bits</span><span class=o>=</span><span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        初始化 ElGamal 签名算法对象。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        参数：
</span></span></span><span class=line><span class=cl><span class=s2>        p -- 大素数，模数
</span></span></span><span class=line><span class=cl><span class=s2>        g -- 模 p 的原根
</span></span></span><span class=line><span class=cl><span class=s2>        x -- 私钥
</span></span></span><span class=line><span class=cl><span class=s2>        bits -- 素数 p 的位数，默认为 256
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        如果未提供 p、g、x，则随机生成。
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>p</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>g</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>randprime</span><span class=p>(</span><span class=mi>2</span> <span class=o>**</span> <span class=p>(</span><span class=n>bits</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=mi>2</span> <span class=o>**</span> <span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>find_primitive_root</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 签名函数</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        对消息进行签名。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        参数：
</span></span></span><span class=line><span class=cl><span class=s2>        message -- 要签名的消息
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        返回：
</span></span></span><span class=line><span class=cl><span class=s2>        (r, s) -- 签名结果
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>h_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>k</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>gcd</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>  <span class=c1># 确保 k 和 p-1 互质</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>k_inv</span> <span class=o>=</span> <span class=n>mod_inverse</span><span class=p>(</span><span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>h_int</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>r</span><span class=p>)</span> <span class=o>*</span> <span class=n>k_inv</span> <span class=o>%</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 验证函数</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>verify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        验证消息的签名是否有效。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        参数：
</span></span></span><span class=line><span class=cl><span class=s2>        message -- 原始消息
</span></span></span><span class=line><span class=cl><span class=s2>        signature -- 签名元组 (r, s)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        返回：
</span></span></span><span class=line><span class=cl><span class=s2>        valid -- 签名是否有效，True 或 False
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>signature</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;</span> <span class=n>r</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=ow>and</span> <span class=mi>0</span> <span class=o>&lt;</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>  <span class=c1># 检查 r 和 s 的范围</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>h_int</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>byteorder</span><span class=o>=</span><span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>h_int</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>v1</span> <span class=o>==</span> <span class=n>v2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 测试代码</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 大素数和生成元</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>97380703184954711490740892696023412334547368592870793188226395165275008037663</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=mi>2</span>  <span class=c1># 使用find_primitive_root找出的原根，若已知则直接赋值</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=mi>123456789</span>  <span class=c1># 私钥</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 初始化ElGamal签名对象</span>
</span></span><span class=line><span class=cl>    <span class=n>elgamal</span> <span class=o>=</span> <span class=n>ElGamalSignature</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 消息</span>
</span></span><span class=line><span class=cl>    <span class=n>student_info</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 签名</span>
</span></span><span class=line><span class=cl>    <span class=n>signature</span> <span class=o>=</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>student_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;签名：&#34;</span><span class=p>,</span> <span class=n>signature</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 验证</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>elgamal</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>student_info</span><span class=p>,</span> <span class=n>signature</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;签名有效&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;签名无效&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h2 id=实验四密钥管理>实验四：密钥管理<a hidden class=anchor aria-hidden=true href=#实验四密钥管理>#</a></h2><h3 id=dh密钥交换协议>DH密钥交换协议<a hidden class=anchor aria-hidden=true href=#dh密钥交换协议>#</a></h3><ol><li>DH密钥交换协议（包含密钥生成、加密和解密）</li><li>双方利用此协议生成的密钥，结合已编写的AES算法来加密消息（学号+姓名），得密文；解密密文，检验能否正确解密</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 4-1_Key_Management_DH</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>serialization</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.asymmetric</span> <span class=kn>import</span> <span class=n>x25519</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.kdf.hkdf</span> <span class=kn>import</span> <span class=n>HKDF</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives</span> <span class=kn>import</span> <span class=n>hashes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.backends</span> <span class=kn>import</span> <span class=n>default_backend</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>cryptography.hazmat.primitives.ciphers</span> <span class=kn>import</span> <span class=n>Cipher</span><span class=p>,</span> <span class=n>algorithms</span><span class=p>,</span> <span class=n>modes</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 函数：执行Diffie-Hellman密钥交换</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>diffie_hellman</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 生成Alice的私钥和公钥</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_private_key</span> <span class=o>=</span> <span class=n>x25519</span><span class=o>.</span><span class=n>X25519PrivateKey</span><span class=o>.</span><span class=n>generate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_public_key</span> <span class=o>=</span> <span class=n>alice_private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 生成Bob的私钥和公钥</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_private_key</span> <span class=o>=</span> <span class=n>x25519</span><span class=o>.</span><span class=n>X25519PrivateKey</span><span class=o>.</span><span class=n>generate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_public_key</span> <span class=o>=</span> <span class=n>bob_private_key</span><span class=o>.</span><span class=n>public_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Alice计算共享密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_shared_key</span> <span class=o>=</span> <span class=n>alice_private_key</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span><span class=n>bob_public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Bob计算共享密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>bob_shared_key</span> <span class=o>=</span> <span class=n>bob_private_key</span><span class=o>.</span><span class=n>exchange</span><span class=p>(</span><span class=n>alice_public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 确保双方计算得到的共享密钥相同</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>alice_shared_key</span> <span class=o>==</span> <span class=n>bob_shared_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>alice_shared_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 函数：使用AES加密消息</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span> <span class=o>=</span> <span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>  <span class=c1># 生成随机IV</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>modes</span><span class=o>.</span><span class=n>CFB</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>backend</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>+</span> <span class=n>encryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 函数：使用AES解密消息</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_message</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>backend</span> <span class=o>=</span> <span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=n>algorithms</span><span class=o>.</span><span class=n>AES</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>modes</span><span class=o>.</span><span class=n>CFB</span><span class=p>(</span><span class=n>iv</span><span class=p>),</span> <span class=n>backend</span><span class=o>=</span><span class=n>backend</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decryptor</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>decryptor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>+</span> <span class=n>decryptor</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plaintext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 主函数：演示过程</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># 执行Diffie-Hellman密钥交换</span>
</span></span><span class=line><span class=cl>    <span class=n>shared_key</span> <span class=o>=</span> <span class=n>diffie_hellman</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;共享密钥 (Hex): </span><span class=si>{</span><span class=n>shared_key</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 使用HKDF从共享密钥派生AES密钥</span>
</span></span><span class=line><span class=cl>    <span class=n>derived_key</span> <span class=o>=</span> <span class=n>HKDF</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>algorithm</span><span class=o>=</span><span class=n>hashes</span><span class=o>.</span><span class=n>SHA256</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>length</span><span class=o>=</span><span class=mi>32</span><span class=p>,</span>  <span class=c1># 256位密钥长度</span>
</span></span><span class=line><span class=cl>        <span class=n>salt</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>info</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;Qw3rTyQw3rTyQw3rTy&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>backend</span><span class=o>=</span><span class=n>default_backend</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>derive</span><span class=p>(</span><span class=n>shared_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 加密和解密消息</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;原始消息: </span><span class=si>{</span><span class=n>message</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 加密消息</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>derived_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;加密后的消息 (Hex): </span><span class=si>{</span><span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 解密消息</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_message</span> <span class=o>=</span> <span class=n>decrypt_message</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>derived_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;解密后的消息: </span><span class=si>{</span><span class=n>decrypted_message</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script><h3 id=shamir秘密共享方案>Shamir秘密共享方案<a hidden class=anchor aria-hidden=true href=#shamir秘密共享方案>#</a></h3><ol><li>编写一个(n, t) Shamir秘密共享方案（包含秘密的分片和基于Lagrange插值方法恢复秘密）</li><li>实例化(n, t) =(5, 3)，而秘密信息为你的“学号+姓名”，演示秘密分片和恢复秘密的过程。</li></ol><div class=collapse-block><div class=collapse-header onclick=toggleCollapse(this)><span class=collapse-arrow>►</span> <strong>代码 4-2_Key_Management_Shamir</strong></div><div class=collapse-content><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy</span> <span class=kn>import</span> <span class=n>nextprime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_shares</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>prime</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    使用Shamir的秘密共享方案生成n个分享，阈值为t。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    参数：
</span></span></span><span class=line><span class=cl><span class=s2>    - secret: 要共享的秘密（以数值形式）。
</span></span></span><span class=line><span class=cl><span class=s2>    - n: 要生成的分享总数。
</span></span></span><span class=line><span class=cl><span class=s2>    - t: 恢复秘密所需的分享阈值。
</span></span></span><span class=line><span class=cl><span class=s2>    - prime: 有限域素数，用于计算。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    返回：
</span></span></span><span class=line><span class=cl><span class=s2>    - 一个包含分享的元组列表 (x, y)。
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>coefficients</span> <span class=o>=</span> <span class=p>[</span><span class=n>secret</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=n>random</span><span class=o>.</span><span class=n>randrange</span><span class=p>(</span><span class=n>prime</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>t</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>polynomial</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>sum</span><span class=p>([</span><span class=n>coeff</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>coeff</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>coefficients</span><span class=p>)])</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>shares</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=n>i</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>polynomial</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shares</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>shares</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>recover_secret</span><span class=p>(</span><span class=n>shares</span><span class=p>,</span> <span class=n>prime</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    使用Shamir的秘密共享方案恢复秘密，给定足够数量的分享。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    参数：
</span></span></span><span class=line><span class=cl><span class=s2>    - shares: 一个分享的元组列表 (x, y)。
</span></span></span><span class=line><span class=cl><span class=s2>    - prime: 有限域素数，用于计算。
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    返回：
</span></span></span><span class=line><span class=cl><span class=s2>    - 恢复的秘密（以数值形式）。
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>lagrange_interpolation</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>shares</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>shares</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>xi</span><span class=p>,</span> <span class=n>yi</span> <span class=o>=</span> <span class=n>shares</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>term</span> <span class=o>=</span> <span class=n>yi</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>i</span> <span class=o>!=</span> <span class=n>j</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>xj</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>shares</span><span class=p>[</span><span class=n>j</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>term</span> <span class=o>=</span> <span class=n>term</span> <span class=o>*</span> <span class=p>(</span><span class=n>x</span> <span class=o>-</span> <span class=n>xj</span><span class=p>)</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=n>xi</span> <span class=o>-</span> <span class=n>xj</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>            <span class=n>total</span> <span class=o>=</span> <span class=p>(</span><span class=n>total</span> <span class=o>+</span> <span class=n>term</span><span class=p>)</span> <span class=o>%</span> <span class=n>prime</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>total</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>lagrange_interpolation</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>shares</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 示例：使用学号和姓名作为秘密</span>
</span></span><span class=line><span class=cl><span class=n>secret</span> <span class=o>=</span> <span class=s2>&#34;26221013_Daaihang_Wong&#34;</span>
</span></span><span class=line><span class=cl><span class=n>secret_numeric</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>secret</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>  <span class=c1># 转换为数值形式</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>5</span>  <span class=c1># 总分享数</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>=</span> <span class=mi>3</span>  <span class=c1># 恢复秘密所需的分享阈值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 选择一个足够大的素数作为有限域的模数</span>
</span></span><span class=line><span class=cl><span class=n>prime</span> <span class=o>=</span> <span class=n>nextprime</span><span class=p>(</span><span class=n>secret_numeric</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 生成分享</span>
</span></span><span class=line><span class=cl><span class=n>shares</span> <span class=o>=</span> <span class=n>generate_shares</span><span class=p>(</span><span class=n>secret_numeric</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>t</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;分享：&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>share</span> <span class=ow>in</span> <span class=n>shares</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>share</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 选择任意 t 个分享来恢复秘密</span>
</span></span><span class=line><span class=cl><span class=n>selected_shares</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>shares</span><span class=p>,</span> <span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 恢复秘密</span>
</span></span><span class=line><span class=cl><span class=n>recovered_numeric</span> <span class=o>=</span> <span class=n>recover_secret</span><span class=p>(</span><span class=n>selected_shares</span><span class=p>,</span> <span class=n>prime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 将数值形式的秘密转换为字节数据</span>
</span></span><span class=line><span class=cl><span class=n>recovered_secret_bytes</span> <span class=o>=</span> <span class=n>recovered_numeric</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>((</span><span class=n>recovered_numeric</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>+</span> <span class=mi>7</span><span class=p>)</span> <span class=o>//</span> <span class=mi>8</span><span class=p>,</span> <span class=s2>&#34;big&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 比较恢复的秘密与原始秘密</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>recovered_secret_bytes</span> <span class=o>==</span> <span class=n>secret</span><span class=o>.</span><span class=n>encode</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>成功恢复秘密：&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>恢复的秘密与原始秘密不匹配&#34;</span><span class=p>)</span>
</span></span></code></pre></div></div><style>.collapse-block{margin-top:12px;margin-bottom:24px;overflow:hidden}.collapse-header{padding:8px;cursor:pointer;transition:background-color .3s ease;color:var(--header-text-color);background-color:var(--header-bg-color);border:1px solid #ccc;border-radius:.5rem;padding-top:.5rem;padding-bottom:.5rem;padding-left:.75rem;padding-right:.75rem}.collapse-header:hover{background-color:var(--header-bg-hover);color:var(--header-text-hover)}.collapse-arrow{float:left;margin-right:8px;transition:transform .3s ease}.collapse-content{padding:0 8px;height:0;overflow:hidden;background-color:rgba(255,255,255,0);transition:height .5s ease-out,padding .3s ease-out}.collapse-content.show{height:auto;padding:8px;overflow:visible}@media(prefers-color-scheme:light){.collapse-header{color:#fff;background-color:#000}.collapse-header:hover{background-color:#80808020}}@media(prefers-color-scheme:dark){.collapse-header:hover{background-color:#80808020}}</style><script>function toggleCollapse(e){var t=e.nextElementSibling,n=e.querySelector(".collapse-arrow");t.classList.contains("show")?(t.style.height="0",t.classList.remove("show"),n.style.transform="rotate(0deg)"):(t.style.height=t.scrollHeight+"px",t.classList.add("show"),n.style.transform="rotate(90deg)")}</script></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/docs/short-code/><span class=title>« 上一页</span><br><span>Short Code Hugo 短代码</span>
</a><a class=next href=http://localhost:1313/docs/license-app/><span class=title>下一页 »</span><br><span>License App</span></a></nav></footer></article></main><footer class=footer><span>© <a href=https://wdh.hk>Daaihang Wong</a> <a href="https://icp.gov.moe/?keyword=20252019">萌ICP备20252019号</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/sherlcok314159/MyPaperMod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(e,t){var s=document,o="script",n=s.createElement(o),i=s.getElementsByTagName(o)[0];n.src=e,t&&n.addEventListener("load",function(e){t(e)}),i.parentNode.insertBefore(n,i)})("/js/pangu.min.js",function(){pangu.spacingPage()})</script><script>(function(){var e,t,n,s=document.getElementsByTagName("code");for(n=0;n<s.length;){if(t=s[n],t.parentNode.tagName!=="PRE"&&t.childElementCount===0&&(e=t.textContent,/^\$[^$]/.test(e)&&/[^$]\$$/.test(e)&&(e=e.replace(/^\$/,"\\(").replace(/\$$/,"\\)"),t.textContent=e),/^\\\((.|\s)+\\\)$/.test(e)||/^\\\[(.|\s)+\\\]$/.test(e)||/^\$(.|\s)+\$$/.test(e)||/^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(e))){t.outerHTML=t.innerHTML;continue}n++}})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function s(){t.innerHTML="Done",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>